# ============================================================================
# CANNACONVERT - PRODUCTION ENVIRONMENT CONFIGURATION
# ============================================================================
# Version: 1.0.0
# Last Updated: 2024-12-05
# Environment: PRODUCTION
# 
# IMPORTANT: This file contains PLACEHOLDERS for production values.
# Replace ALL values marked with <CHANGE_ME> before deploying.
# Never commit actual secrets to version control.
# ============================================================================

# ----------------------------------------------------------------------------
# 1. APPLICATION SETTINGS
# ----------------------------------------------------------------------------

# Application environment - DO NOT CHANGE
NODE_ENV=production

# Application name
APP_NAME=CannaConvert

# Application version (auto-updated by CI/CD)
APP_VERSION=1.0.0

# ----------------------------------------------------------------------------
# 2. URLS & ENDPOINTS
# ----------------------------------------------------------------------------

# Production domain (your actual domain)
# Example: https://cannaconvert.com.br
NEXT_PUBLIC_APP_URL=<CHANGE_ME_PRODUCTION_DOMAIN>

# Frontend URL (same as APP_URL for monorepo)
FRONTEND_URL=<CHANGE_ME_PRODUCTION_DOMAIN>

# Backend API URL (internal service)
BACKEND_URL=http://localhost:3001

# MPP Converter service URL (internal)
MPP_CONVERTER_URL=http://localhost:8080

# ----------------------------------------------------------------------------
# 3. AUTHENTICATION (NextAuth.js)
# ----------------------------------------------------------------------------

# NextAuth URL - MUST match your production domain
NEXTAUTH_URL=<CHANGE_ME_PRODUCTION_DOMAIN>

# NextAuth Secret - CRITICAL SECURITY
# Generate with: openssl rand -base64 32
# NEVER use the same secret across environments
NEXTAUTH_SECRET=<CHANGE_ME_GENERATE_NEW_SECRET>

# Session configuration
NEXTAUTH_SESSION_MAX_AGE=2592000
NEXTAUTH_SESSION_UPDATE_AGE=86400

# ----------------------------------------------------------------------------
# 4. DATABASE (PostgreSQL)
# ----------------------------------------------------------------------------

# PostgreSQL connection string
# Format: postgresql://USER:PASSWORD@HOST:PORT/DATABASE?schema=public
# 
# For managed databases (recommended):
# - Use SSL mode: ?sslmode=require
# - Use connection pooling for high traffic
#
DATABASE_URL=postgresql://<USER>:<PASSWORD>@<HOST>:5432/<DATABASE>?schema=public&sslmode=require

# Direct connection URL (for migrations)
DIRECT_URL=postgresql://<USER>:<PASSWORD>@<HOST>:5432/<DATABASE>?schema=public&sslmode=require

# Connection pool settings (for Prisma)
DATABASE_POOL_MIN=2
DATABASE_POOL_MAX=10
DATABASE_CONNECTION_TIMEOUT=30000

# ----------------------------------------------------------------------------
# 5. PAYMENT GATEWAY (Mercado Pago - PRIMARY)
# ----------------------------------------------------------------------------

# Mercado Pago Access Token (PRODUCTION)
# Get from: https://www.mercadopago.com.br/developers/panel/credentials
# IMPORTANT: Use PRODUCTION credentials, not sandbox
MERCADO_PAGO_ACCESS_TOKEN=<CHANGE_ME_MP_PRODUCTION_ACCESS_TOKEN>

# Mercado Pago Public Key (for frontend)
NEXT_PUBLIC_MERCADO_PAGO_PUBLIC_KEY=<CHANGE_ME_MP_PRODUCTION_PUBLIC_KEY>

# Mercado Pago Webhook Secret
# Configure webhook URL at: https://www.mercadopago.com.br/developers/panel/webhooks
# Webhook URL should be: https://your-domain.com/api/webhooks/mercadopago
MERCADO_PAGO_WEBHOOK_SECRET=<CHANGE_ME_MP_WEBHOOK_SECRET>

# Mercado Pago Notification URL (where MP sends payment notifications)
MERCADO_PAGO_NOTIFICATION_URL=<CHANGE_ME_PRODUCTION_DOMAIN>/api/webhooks/mercadopago

# Default PIX price in BRL cents (R$ 10.00 = 1000)
PIX_PRICE_CENTS=1000

# ----------------------------------------------------------------------------
# 6. PAYMENT GATEWAY (Stripe - Optional)
# ----------------------------------------------------------------------------

# Stripe Secret Key (PRODUCTION)
# Get from: https://dashboard.stripe.com/apikeys
STRIPE_SECRET_KEY=<CHANGE_ME_STRIPE_SECRET_KEY>

# Stripe Publishable Key (for frontend)
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=<CHANGE_ME_STRIPE_PUBLISHABLE_KEY>

# Stripe Webhook Secret
# Get from: https://dashboard.stripe.com/webhooks
STRIPE_WEBHOOK_SECRET=<CHANGE_ME_STRIPE_WEBHOOK_SECRET>

# ----------------------------------------------------------------------------
# 7. INTERNAL API SECURITY
# ----------------------------------------------------------------------------

# Secret API Key for internal service communication
# Generate with: openssl rand -hex 32
SECRET_API_KEY=<CHANGE_ME_GENERATE_SECRET_API_KEY>

# Admin API Key for administrative operations
ADMIN_API_KEY=<CHANGE_ME_GENERATE_ADMIN_API_KEY>

# JWT Secret for internal tokens
JWT_SECRET=<CHANGE_ME_GENERATE_JWT_SECRET>

# ----------------------------------------------------------------------------
# 8. REDIS (Caching & Rate Limiting)
# ----------------------------------------------------------------------------

# Redis connection URL
# For managed Redis: redis://:PASSWORD@HOST:PORT
# For local Redis: redis://localhost:6379
REDIS_URL=redis://:${REDIS_PASSWORD}@${REDIS_HOST}:${REDIS_PORT}

# Redis connection details (if not using URL)
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=<CHANGE_ME_REDIS_PASSWORD>

# Redis database index (0-15)
REDIS_DB=0

# Redis key prefix (for namespacing)
REDIS_KEY_PREFIX=cannaconvert:prod:

# ----------------------------------------------------------------------------
# 9. RATE LIMITING
# ----------------------------------------------------------------------------

# Enable rate limiting (recommended for production)
RATE_LIMIT_ENABLED=true

# Global rate limit (requests per window)
RATE_LIMIT_MAX_REQUESTS=100
RATE_LIMIT_WINDOW_MS=60000

# API rate limit (stricter)
RATE_LIMIT_API_MAX=50
RATE_LIMIT_API_WINDOW_MS=60000

# Auth rate limit (very strict to prevent brute force)
RATE_LIMIT_AUTH_MAX=5
RATE_LIMIT_AUTH_WINDOW_MS=300000

# Conversion rate limit (per user)
RATE_LIMIT_CONVERSION_MAX=10
RATE_LIMIT_CONVERSION_WINDOW_MS=3600000

# ----------------------------------------------------------------------------
# 10. SECURITY HEADERS
# ----------------------------------------------------------------------------

# Content Security Policy - adjust according to your needs
CSP_DIRECTIVES="default-src 'self'; script-src 'self' 'unsafe-inline' https://www.googletagmanager.com https://pagead2.googlesyndication.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https: blob:; connect-src 'self' https://api.mercadopago.com https://www.google-analytics.com; frame-src 'self' https://www.mercadopago.com.br https://pagead2.googlesyndication.com"

# HSTS (HTTP Strict Transport Security)
HSTS_MAX_AGE=31536000
HSTS_INCLUDE_SUBDOMAINS=true
HSTS_PRELOAD=true

# CORS allowed origins (comma-separated)
CORS_ALLOWED_ORIGINS=<CHANGE_ME_PRODUCTION_DOMAIN>

# Cookie settings
COOKIE_SECURE=true
COOKIE_SAME_SITE=lax
COOKIE_DOMAIN=<CHANGE_ME_DOMAIN_WITHOUT_PROTOCOL>

# ----------------------------------------------------------------------------
# 11. FILE UPLOAD & STORAGE
# ----------------------------------------------------------------------------

# Maximum file size (in bytes) - 50MB
MAX_FILE_SIZE=52428800

# Allowed file extensions (comma-separated)
ALLOWED_EXTENSIONS=.mpp,.xml,.pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png,.webp,.mp4,.mov

# Upload directory (relative to project root)
UPLOAD_DIR=./uploads

# Temp directory for processing
TEMP_DIR=./temp

# Storage type: local | s3 | gcs
STORAGE_TYPE=local

# S3 Configuration (if STORAGE_TYPE=s3)
AWS_ACCESS_KEY_ID=<CHANGE_ME_IF_USING_S3>
AWS_SECRET_ACCESS_KEY=<CHANGE_ME_IF_USING_S3>
AWS_REGION=sa-east-1
AWS_S3_BUCKET=<CHANGE_ME_IF_USING_S3>

# ----------------------------------------------------------------------------
# 12. LOGGING & MONITORING
# ----------------------------------------------------------------------------

# Log level: error | warn | info | debug
LOG_LEVEL=info

# Log format: json | pretty
LOG_FORMAT=json

# Log destination: console | file | both
LOG_DESTINATION=both

# Log file path
LOG_FILE_PATH=./logs/app.log

# Log rotation
LOG_MAX_SIZE=10m
LOG_MAX_FILES=14

# Enable request logging
LOG_REQUESTS=true

# Sentry DSN for error tracking (optional but recommended)
SENTRY_DSN=<CHANGE_ME_SENTRY_DSN>

# Sentry environment
SENTRY_ENVIRONMENT=production

# Sentry traces sample rate (0.0 to 1.0)
SENTRY_TRACES_SAMPLE_RATE=0.1

# ----------------------------------------------------------------------------
# 13. EMAIL CONFIGURATION (Optional)
# ----------------------------------------------------------------------------

# SMTP Configuration
SMTP_HOST=<CHANGE_ME_SMTP_HOST>
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USER=<CHANGE_ME_SMTP_USER>
SMTP_PASSWORD=<CHANGE_ME_SMTP_PASSWORD>

# Email sender
EMAIL_FROM=noreply@<CHANGE_ME_DOMAIN>
EMAIL_FROM_NAME=CannaConvert

# ----------------------------------------------------------------------------
# 14. GOOGLE ADS / ANALYTICS (Optional)
# ----------------------------------------------------------------------------

# Google Analytics 4 Measurement ID
NEXT_PUBLIC_GA4_MEASUREMENT_ID=<CHANGE_ME_GA4_ID>

# Google AdSense Publisher ID
NEXT_PUBLIC_ADSENSE_PUBLISHER_ID=<CHANGE_ME_ADSENSE_ID>

# Enable/disable ads globally
NEXT_PUBLIC_ADS_ENABLED=true

# ----------------------------------------------------------------------------
# 15. FEATURE FLAGS
# ----------------------------------------------------------------------------

# Enable demo mode (for testing without real payments)
ENABLE_DEMO_MODE=false

# Enable maintenance mode
ENABLE_MAINTENANCE_MODE=false

# Maintenance message (when maintenance mode is on)
MAINTENANCE_MESSAGE="Sistema em manutenção. Voltamos em breve!"

# Enable new user registration
ENABLE_REGISTRATION=true

# Enable social login
ENABLE_SOCIAL_LOGIN=false

# ----------------------------------------------------------------------------
# 16. DOCKER & DEPLOYMENT
# ----------------------------------------------------------------------------

# Container port (internal)
PORT=3000

# Backend container port
BACKEND_PORT=3001

# MPP Converter port
MPP_CONVERTER_PORT=8080

# Health check endpoint
HEALTH_CHECK_PATH=/api/health

# Graceful shutdown timeout (ms)
SHUTDOWN_TIMEOUT=30000

# ----------------------------------------------------------------------------
# 17. BACKUP CONFIGURATION
# ----------------------------------------------------------------------------

# Database backup schedule (cron format)
BACKUP_SCHEDULE="0 2 * * *"

# Backup retention days
BACKUP_RETENTION_DAYS=30

# Backup storage path
BACKUP_PATH=/backups

# ----------------------------------------------------------------------------
# END OF CONFIGURATION
# ----------------------------------------------------------------------------
# 
# CHECKLIST BEFORE DEPLOY:
# [ ] All <CHANGE_ME> values replaced with actual values
# [ ] Database migrated and seeded
# [ ] SSL certificate configured
# [ ] DNS pointing to server
# [ ] Firewall configured (ports 80, 443 only)
# [ ] Mercado Pago webhook configured
# [ ] Monitoring and alerting set up
# [ ] Backup strategy in place
# [ ] Rollback plan documented
# [ ] Load testing completed
#
# ============================================================================
