[{"filePath":"C:\\Users\\rafae\\Desktop\\PROJETOS DE ESTUDOS\\CONVERSOR MPP XML\\api\\secure-auth.js","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'fs' is assigned a value but never used.","line":8,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":9,"suggestions":[{"messageId":"removeVar","data":{"varName":"fs"},"fix":{"range":[176,201],"text":""},"desc":"Remove unused variable 'fs'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'path' is assigned a value but never used.","line":9,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":11,"suggestions":[{"messageId":"removeVar","data":{"varName":"path"},"fix":{"range":[203,232],"text":""},"desc":"Remove unused variable 'path'."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":27,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":27,"endColumn":20,"suggestions":[{"fix":{"range":[1017,1082],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":28,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":28,"endColumn":20,"suggestions":[{"fix":{"range":[1092,1149],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":51,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":51,"endColumn":23},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":52,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":52,"endColumn":26,"suggestions":[{"fix":{"range":[1849,1897],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":79,"column":17,"nodeType":"MemberExpression","messageId":"unexpected","endLine":79,"endColumn":28,"suggestions":[{"fix":{"range":[2739,2792],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":82,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":82,"endColumn":24,"suggestions":[{"fix":{"range":[2853,2916],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":97,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":97,"endColumn":20,"suggestions":[{"fix":{"range":[3349,3407],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":148,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":148,"endColumn":20,"suggestions":[{"fix":{"range":[5294,5365],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":160,"column":17,"nodeType":"MemberExpression","messageId":"unexpected","endLine":160,"endColumn":28,"suggestions":[{"fix":{"range":[5643,5700],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":166,"column":17,"nodeType":"MemberExpression","messageId":"unexpected","endLine":166,"endColumn":28,"suggestions":[{"fix":{"range":[5866,5933],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":173,"column":17,"nodeType":"MemberExpression","messageId":"unexpected","endLine":173,"endColumn":28,"suggestions":[{"fix":{"range":[6191,6241],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":183,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":183,"endColumn":26,"suggestions":[{"fix":{"range":[6525,6589],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":216,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":216,"endColumn":24,"suggestions":[{"fix":{"range":[7724,7777],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":217,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":217,"endColumn":24,"suggestions":[{"fix":{"range":[7791,7855],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":218,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":218,"endColumn":24,"suggestions":[{"fix":{"range":[7869,7926],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":219,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":219,"endColumn":24,"suggestions":[{"fix":{"range":[7940,7980],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":220,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":220,"endColumn":24,"suggestions":[{"fix":{"range":[7994,8037],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":232,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":232,"endColumn":24,"suggestions":[{"fix":{"range":[8404,8454],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":233,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":233,"endColumn":24,"suggestions":[{"fix":{"range":[8468,8496],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":234,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":234,"endColumn":24,"suggestions":[{"fix":{"range":[8510,8569],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":235,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":235,"endColumn":24,"suggestions":[{"fix":{"range":[8583,8648],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":236,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":236,"endColumn":24,"suggestions":[{"fix":{"range":[8662,8730],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":252,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":252,"endColumn":24,"suggestions":[{"fix":{"range":[9132,9180],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":22,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Sistema de AutenticaÃ§Ã£o Ultra-Seguro\r\n * Desenvolvido especialmente para Rafael Cannalonga\r\n * Zero exposiÃ§Ã£o de credenciais\r\n */\r\n\r\nconst crypto = require('crypto');\r\nconst fs = require('fs');\r\nconst path = require('path');\r\n\r\nclass SecureAuthSystem {\r\n    constructor() {\r\n        this.failedAttempts = new Map();\r\n        this.blockedIPs = new Set();\r\n        this.activeSessions = new Map();\r\n        \r\n        // Credenciais ultra-seguras (hash real da senha)\r\n        this.secureCredentials = {\r\n            // Username sem criptografia para simplicidade e seguranÃ§a\r\n            username: 'Alcap0ne',\r\n            // Hash real da senha \"C@rolin@36932025\" com salt\r\n            passwordHash: '57f8da593da6ea97241d00da304f56aad4e9e32c54bff74e19ba817c9b55f009859e519ad5ef57cebfc4274edb5b6acedb31fb6e7fd2c051525368f7de7bcf26',\r\n            passwordSalt: '3f8e2a9d7c4b6f1a8d5c2e9b7f0a3d6c1e4b7a0d9c5f2a8e1b4c7f0a3d6c9e2b5',\r\n            email: 'rafaelcannalonga2@hotmail.com'\r\n        };\r\n        \r\n        console.log('ðŸ›¡ï¸ Sistema de autenticaÃ§Ã£o ultra-seguro iniciado');\r\n        console.log('ðŸ” Credenciais protegidas por hash PBKDF2');\r\n    }\r\n    \r\n    /**\r\n     * Verificar senha com hash ultra-seguro\r\n     */\r\n    verifyPassword(inputPassword) {\r\n        try {\r\n            const { passwordHash, passwordSalt } = this.secureCredentials;\r\n            \r\n            const hash = crypto.pbkdf2Sync(\r\n                inputPassword, \r\n                passwordSalt, \r\n                100000, // 100k iteraÃ§Ãµes\r\n                64, \r\n                'sha512'\r\n            ).toString('hex');\r\n            \r\n            // ComparaÃ§Ã£o timing-safe\r\n            return crypto.timingSafeEqual(\r\n                Buffer.from(hash, 'hex'), \r\n                Buffer.from(passwordHash, 'hex')\r\n            );\r\n        } catch (error) {\r\n            console.error('âŒ ERRO NA VERIFICAÃ‡ÃƒO DE SENHA');\r\n            return false;\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Verificar rate limiting por IP\r\n     */\r\n    checkRateLimit(ip) {\r\n        const now = Date.now();\r\n        const windowMs = 15 * 60 * 1000; // 15 minutos\r\n        const maxAttempts = 3;\r\n        \r\n        // Verificar se IP estÃ¡ bloqueado\r\n        if (this.blockedIPs.has(ip)) {\r\n            return { allowed: false, reason: 'IP_BLOCKED' };\r\n        }\r\n        \r\n        // Obter tentativas do IP\r\n        const attempts = this.failedAttempts.get(ip) || [];\r\n        const recentAttempts = attempts.filter(time => now - time < windowMs);\r\n        \r\n        if (recentAttempts.length >= maxAttempts) {\r\n            // Bloquear IP por 1 hora\r\n            this.blockedIPs.add(ip);\r\n            setTimeout(() => {\r\n                this.blockedIPs.delete(ip);\r\n                console.log(`ðŸ”“ IP ${ip} desbloqueado apÃ³s timeout`);\r\n            }, 60 * 60 * 1000);\r\n            \r\n            console.log(`ðŸš¨ IP ${ip} BLOQUEADO por excesso de tentativas`);\r\n            return { allowed: false, reason: 'RATE_LIMITED' };\r\n        }\r\n        \r\n        return { allowed: true, remaining: maxAttempts - recentAttempts.length };\r\n    }\r\n    \r\n    /**\r\n     * Registrar tentativa falhada\r\n     */\r\n    registerFailedAttempt(ip) {\r\n        const attempts = this.failedAttempts.get(ip) || [];\r\n        attempts.push(Date.now());\r\n        this.failedAttempts.set(ip, attempts);\r\n        \r\n        console.log(`âš ï¸ Tentativa de login falhada do IP: ${ip}`);\r\n        \r\n        // Limpar tentativas antigas (mais de 1 hora)\r\n        setTimeout(() => {\r\n            const oldAttempts = this.failedAttempts.get(ip) || [];\r\n            const validAttempts = oldAttempts.filter(time => \r\n                Date.now() - time < 60 * 60 * 1000\r\n            );\r\n            \r\n            if (validAttempts.length === 0) {\r\n                this.failedAttempts.delete(ip);\r\n            } else {\r\n                this.failedAttempts.set(ip, validAttempts);\r\n            }\r\n        }, 60 * 60 * 1000);\r\n    }\r\n    \r\n    /**\r\n     * Gerar token JWT ultra-seguro\r\n     */\r\n    generateSecureToken(ip) {\r\n        const payload = {\r\n            sub: 'admin_rafael_cannalonga',\r\n            iat: Math.floor(Date.now() / 1000),\r\n            exp: Math.floor(Date.now() / 1000) + (24 * 60 * 60), // 24 horas\r\n            iss: 'mpp-converter-secure',\r\n            aud: 'admin-panel',\r\n            ip: crypto.createHash('sha256').update(ip).digest('hex'), // IP hash para seguranÃ§a\r\n            nonce: crypto.randomBytes(16).toString('hex')\r\n        };\r\n        \r\n        const secret = process.env.JWT_SECRET || crypto.randomBytes(64).toString('hex');\r\n        \r\n        // Criar assinatura manual para mÃ¡xima seguranÃ§a\r\n        const header = Buffer.from(JSON.stringify({ alg: 'HS512', typ: 'JWT' })).toString('base64url');\r\n        const payloadB64 = Buffer.from(JSON.stringify(payload)).toString('base64url');\r\n        \r\n        const signature = crypto\r\n            .createHmac('sha512', secret)\r\n            .update(`${header}.${payloadB64}`)\r\n            .digest('base64url');\r\n        \r\n        const token = `${header}.${payloadB64}.${signature}`;\r\n        \r\n        // Armazenar sessÃ£o ativa\r\n        this.activeSessions.set(token, {\r\n            created: Date.now(),\r\n            ip: ip,\r\n            lastActivity: Date.now()\r\n        });\r\n        \r\n        console.log(`âœ… Token seguro gerado para IP: ${ip.substring(0, 8)}***`);\r\n        return token;\r\n    }\r\n    \r\n    /**\r\n     * Verificar token JWT\r\n     */\r\n    verifyToken(token, ip) {\r\n        try {\r\n            // Verificar se sessÃ£o existe\r\n            const session = this.activeSessions.get(token);\r\n            if (!session) {\r\n                console.log('âŒ Token nÃ£o encontrado nas sessÃµes ativas');\r\n                return false;\r\n            }\r\n            \r\n            // Verificar IP (proteÃ§Ã£o adicional)\r\n            if (session.ip !== ip) {\r\n                console.log(`ðŸš¨ TENTATIVA DE USO DE TOKEN DE IP DIFERENTE: ${ip}`);\r\n                this.activeSessions.delete(token);\r\n                return false;\r\n            }\r\n            \r\n            // Verificar expiraÃ§Ã£o da sessÃ£o (24 horas)\r\n            if (Date.now() - session.created > 24 * 60 * 60 * 1000) {\r\n                console.log('â° Token expirado, removendo sessÃ£o');\r\n                this.activeSessions.delete(token);\r\n                return false;\r\n            }\r\n            \r\n            // Atualizar Ãºltima atividade\r\n            session.lastActivity = Date.now();\r\n            \r\n            return true;\r\n        } catch (error) {\r\n            console.error('âŒ Erro na verificaÃ§Ã£o de token:', error.message);\r\n            return false;\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Autenticar usuÃ¡rio principal - RAFAEL CANNALONGA\r\n     */\r\n    authenticate(username, password, ip) {\r\n        // Verificar rate limiting\r\n        const rateCheck = this.checkRateLimit(ip);\r\n        if (!rateCheck.allowed) {\r\n            return { \r\n                success: false, \r\n                reason: rateCheck.reason,\r\n                message: 'Muitas tentativas. Acesso temporariamente bloqueado.'\r\n            };\r\n        }\r\n        \r\n        // Verificar credenciais diretas (mais seguro que descriptografia)\r\n        const validUsername = this.secureCredentials.username;\r\n        \r\n        // Verificar credenciais com timing-safe comparison\r\n        const usernameValid = username === validUsername;\r\n        const passwordValid = this.verifyPassword(password);\r\n        \r\n        if (usernameValid && passwordValid) {\r\n            // Limpar tentativas falhadas para este IP\r\n            this.failedAttempts.delete(ip);\r\n            \r\n            // Gerar token seguro\r\n            const token = this.generateSecureToken(ip);\r\n            \r\n            console.log(`ðŸŽ‰ AUTENTICAÃ‡ÃƒO REALIZADA COM SUCESSO`);\r\n            console.log(`ðŸ‘¤ UsuÃ¡rio: Rafael Cannalonga (${validUsername})`);\r\n            console.log(`ðŸ“§ Email: ${this.secureCredentials.email}`);\r\n            console.log(`ðŸ“± IP autenticado: ${ip}`);\r\n            console.log(`â° Token vÃ¡lido por 24 horas`);\r\n            \r\n            return {\r\n                success: true,\r\n                token: token,\r\n                user: 'Rafael Cannalonga',\r\n                email: this.secureCredentials.email,\r\n                message: 'AutenticaÃ§Ã£o realizada com sucesso'\r\n            };\r\n        } else {\r\n            this.registerFailedAttempt(ip);\r\n            \r\n            console.log(`âŒ TENTATIVA DE AUTENTICAÃ‡ÃƒO FALHOU`);\r\n            console.log(`ðŸ” IP: ${ip}`);\r\n            console.log(`ðŸ“ Username tentado: ${username || 'VAZIO'}`);\r\n            console.log(`ðŸ”’ Senha vÃ¡lida: ${passwordValid ? 'SIM' : 'NÃƒO'}`);\r\n            console.log(`ðŸ‘¤ Username vÃ¡lido: ${usernameValid ? 'SIM' : 'NÃƒO'}`);\r\n            \r\n            return { \r\n                success: false, \r\n                reason: 'INVALID_CREDENTIALS',\r\n                message: 'Credenciais invÃ¡lidas'\r\n            };\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Invalidar sessÃ£o (logout)\r\n     */\r\n    invalidateSession(token) {\r\n        if (this.activeSessions.has(token)) {\r\n            this.activeSessions.delete(token);\r\n            console.log('ðŸšª SessÃ£o invalidada com sucesso');\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n    \r\n    /**\r\n     * Obter estatÃ­sticas de seguranÃ§a\r\n     */\r\n    getSecurityStats() {\r\n        return {\r\n            activeSessions: this.activeSessions.size,\r\n            blockedIPs: this.blockedIPs.size,\r\n            failedAttemptsCount: Array.from(this.failedAttempts.values())\r\n                .reduce((total, attempts) => total + attempts.length, 0),\r\n            systemStatus: 'SECURE'\r\n        };\r\n    }\r\n}\r\n\r\nmodule.exports = SecureAuthSystem;","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rafae\\Desktop\\PROJETOS DE ESTUDOS\\CONVERSOR MPP XML\\api\\security.js","messages":[{"ruleId":null,"nodeType":null,"fatal":true,"severity":2,"message":"Parsing error: Unexpected token :","line":89,"column":24}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * MÃ³dulo de SeguranÃ§a AvanÃ§ada - MPP Converter\r\n * ProteÃ§Ã£o total de credenciais e dados sensÃ­veis\r\n */\r\n\r\nconst crypto = require('crypto');\r\n\r\n// ConfiguraÃ§Ãµes de seguranÃ§a ultra-robustas\r\nconst SECURITY_CONFIG = {\r\n    algorithm: 'aes-256-gcm',\r\n    keyLength: 32,\r\n    ivLength: 16,\r\n    tagLength: 16,\r\n    iterations: 100000,\r\n    hashAlgorithm: 'sha512',\r\n    saltLength: 32\r\n};\r\n\r\n/**\r\n * Gerar hash super seguro de senha com salt\r\n */\r\nfunction hashPassword(password, salt = null) {\r\n    if (!salt) {\r\n        salt = crypto.randomBytes(SECURITY_CONFIG.saltLength).toString('hex');\r\n    }\r\n    \r\n    const hash = crypto.pbkdf2Sync(\r\n        password, \r\n        salt, \r\n        SECURITY_CONFIG.iterations, \r\n        64, \r\n        SECURITY_CONFIG.hashAlgorithm\r\n    ).toString('hex');\r\n    \r\n    return { hash, salt };\r\n}\r\n\r\n/**\r\n * Verificar senha com timing-safe comparison\r\n */\r\nfunction verifyPassword(password, hash, salt) {\r\n    const { hash: computedHash } = hashPassword(password, salt);\r\n    return crypto.timingSafeEqual(Buffer.from(hash, 'hex'), Buffer.from(computedHash, 'hex'));\r\n}\r\n\r\n/**\r\n * Criptografar dados ultra-sensÃ­veis\r\n */\r\nfunction encryptSensitiveData(data, masterKey) {\r\n    const iv = crypto.randomBytes(SECURITY_CONFIG.ivLength);\r\n    const cipher = crypto.createCipherGCM(SECURITY_CONFIG.algorithm, Buffer.from(masterKey, 'hex'));\r\n    cipher.setAAD(Buffer.from('mpp-converter-auth'));\r\n    \r\n    let encrypted = cipher.update(data, 'utf8', 'hex');\r\n    encrypted += cipher.final('hex');\r\n    \r\n    const tag = cipher.getAuthTag();\r\n    \r\n    return {\r\n        encrypted,\r\n        iv: iv.toString('hex'),\r\n        tag: tag.toString('hex')\r\n    };\r\n}\r\n\r\n/**\r\n * Descriptografar dados sensÃ­veis\r\n */\r\nfunction decryptSensitiveData(encryptedData, masterKey) {\r\n    try {\r\n        const { encrypted, iv, tag } = encryptedData;\r\n        const decipher = crypto.createDecipherGCM(\r\n            SECURITY_CONFIG.algorithm, \r\n            Buffer.from(masterKey, 'hex')\r\n        );\r\n        decipher.setAAD(Buffer.from('mpp-converter-auth'));\r\n        decipher.setAuthTag(Buffer.from(tag, 'hex'));\r\n        \r\n        let decrypted = decipher.update(encrypted, 'hex', 'utf8');\r\n        decrypted += decipher.final('utf8');\r\n        \r\n        return decrypted;\r\n    } catch (error) {\r\n        console.error('âŒ TENTATIVA DE DESCRIPTOGRAFIA NÃƒO AUTORIZADA');\r\n        return null;\r\n    }\r\n}\r\n    ENCRYPTION_KEY: process.env.ENCRYPTION_KEY || crypto.randomBytes(32),\r\n    ADMIN_PASSWORD_HASH: process.env.ADMIN_PASSWORD_HASH || '$2b$12$example_hash',\r\n    \r\n    // ConfiguraÃ§Ãµes de rate limiting por funcionalidade\r\n    rateLimits: {\r\n        general: { windowMs: 15 * 60 * 1000, max: 100 },\r\n        upload: { windowMs: 5 * 60 * 1000, max: 5 },\r\n        payment: { windowMs: 10 * 60 * 1000, max: 10 },\r\n        admin: { windowMs: 15 * 60 * 1000, max: 20 }\r\n    }\r\n};\r\n\r\n// Helmet com configuraÃ§Ãµes rigorosas de seguranÃ§a\r\napp.use(helmet({\r\n    contentSecurityPolicy: {\r\n        directives: {\r\n            defaultSrc: [\"'self'\"],\r\n            scriptSrc: [\"'self'\", \"'unsafe-inline'\", \"https://cdnjs.cloudflare.com\"],\r\n            styleSrc: [\"'self'\", \"'unsafe-inline'\", \"https://fonts.googleapis.com\", \"https://cdnjs.cloudflare.com\"],\r\n            fontSrc: [\"'self'\", \"https://fonts.gstatic.com\"],\r\n            imgSrc: [\"'self'\", \"data:\", \"https:\"],\r\n            connectSrc: [\"'self'\"]\r\n        }\r\n    },\r\n    hsts: {\r\n        maxAge: 31536000,\r\n        includeSubDomains: true,\r\n        preload: true\r\n    },\r\n    noSniff: true,\r\n    xssFilter: true,\r\n    referrerPolicy: { policy: \"same-origin\" }\r\n}));\r\n\r\n// CORS restritivo\r\nconst corsOptions = {\r\n    origin: function (origin, callback) {\r\n        const allowedOrigins = [\r\n            'http://localhost:3000',\r\n            'https://seu-dominio.com',\r\n            // Adicionar domÃ­nios permitidos em produÃ§Ã£o\r\n        ];\r\n        \r\n        // Permitir requisiÃ§Ãµes sem origin (mobile apps, etc.)\r\n        if (!origin) return callback(null, true);\r\n        \r\n        if (allowedOrigins.indexOf(origin) !== -1) {\r\n            callback(null, true);\r\n        } else {\r\n            callback(new Error('NÃ£o permitido pelo CORS'));\r\n        }\r\n    },\r\n    credentials: true,\r\n    optionsSuccessStatus: 200\r\n};\r\napp.use(cors(corsOptions));\r\n\r\napp.use(express.json({ limit: '10mb' }));\r\napp.use(express.urlencoded({ extended: true, limit: '10mb' }));\r\n\r\n// Rate limiting diferenciado por rota\r\nconst generalLimiter = rateLimit(securityConfig.rateLimits.general);\r\nconst uploadLimiter = rateLimit({\r\n    ...securityConfig.rateLimits.upload,\r\n    message: 'Muitos uploads. Tente novamente em 5 minutos.',\r\n    standardHeaders: true,\r\n    legacyHeaders: false,\r\n});\r\nconst paymentLimiter = rateLimit({\r\n    ...securityConfig.rateLimits.payment,\r\n    message: 'Muitas tentativas de pagamento. Tente novamente em 10 minutos.',\r\n});\r\nconst adminLimiter = rateLimit({\r\n    ...securityConfig.rateLimits.admin,\r\n    message: 'Muitas tentativas de acesso admin.',\r\n});\r\n\r\n// Aplicar rate limiting\r\napp.use('/api', generalLimiter);\r\napp.use('/api/upload', uploadLimiter);\r\napp.use('/api/payment', paymentLimiter);\r\napp.use('/api/admin', adminLimiter);\r\n\r\n// Middleware de sanitizaÃ§Ã£o de entrada\r\nconst sanitizeInput = (req, res, next) => {\r\n    const sanitizeRecursive = (obj) => {\r\n        for (const key in obj) {\r\n            if (typeof obj[key] === 'string') {\r\n                // Sanitizar XSS\r\n                obj[key] = xss(obj[key]);\r\n                // Limitar tamanho de strings\r\n                if (obj[key].length > 1000) {\r\n                    obj[key] = obj[key].substring(0, 1000);\r\n                }\r\n            } else if (typeof obj[key] === 'object' && obj[key] !== null) {\r\n                sanitizeRecursive(obj[key]);\r\n            }\r\n        }\r\n    };\r\n    \r\n    if (req.body) sanitizeRecursive(req.body);\r\n    if (req.query) sanitizeRecursive(req.query);\r\n    if (req.params) sanitizeRecursive(req.params);\r\n    \r\n    next();\r\n};\r\n\r\napp.use(sanitizeInput);\r\n\r\n// Middleware de logging de seguranÃ§a\r\nconst securityLogger = (req, res, next) => {\r\n    const clientIP = getClientIP(req);\r\n    const userAgent = req.get('User-Agent') || 'Unknown';\r\n    const timestamp = new Date().toISOString();\r\n    \r\n    // Log de tentativas suspeitas\r\n    const suspiciousPatterns = [\r\n        /\\.\\./,  // Path traversal\r\n        /<script/i,  // XSS\r\n        /union.*select/i,  // SQL injection\r\n        /javascript:/i,  // JavaScript injection\r\n        /on\\w+\\s*=/i,  // Event handlers\r\n    ];\r\n    \r\n    const requestData = JSON.stringify({\r\n        url: req.originalUrl,\r\n        body: req.body,\r\n        query: req.query,\r\n        headers: req.headers\r\n    });\r\n    \r\n    const isSuspicious = suspiciousPatterns.some(pattern => \r\n        pattern.test(requestData)\r\n    );\r\n    \r\n    if (isSuspicious) {\r\n        console.warn(`ðŸš¨ TENTATIVA SUSPEITA: ${timestamp} | IP: ${clientIP} | URL: ${req.originalUrl} | UA: ${userAgent}`);\r\n        // Em produÃ§Ã£o, enviar alerta para sistema de monitoramento\r\n    }\r\n    \r\n    next();\r\n};\r\n\r\napp.use(securityLogger);\r\n\r\n// ConfiguraÃ§Ã£o segura do multer\r\nconst storage = multer.diskStorage({\r\n    destination: (req, file, cb) => {\r\n        // Criar diretÃ³rio seguro se nÃ£o existir\r\n        const uploadDir = path.join(__dirname, '..', 'uploads');\r\n        cb(null, uploadDir);\r\n    },\r\n    filename: (req, file, cb) => {\r\n        // Nome de arquivo seguro com hash\r\n        const timestamp = Date.now();\r\n        const random = crypto.randomBytes(6).toString('hex');\r\n        const safeName = file.originalname.replace(/[^a-zA-Z0-9.-]/g, '_');\r\n        cb(null, `${timestamp}-${random}-${safeName}`);\r\n    }\r\n});\r\n\r\n// ValidaÃ§Ã£o rigorosa de arquivos\r\nconst fileFilter = (req, file, cb) => {\r\n    try {\r\n        const allowedExtensions = ['.mpp'];\r\n        const allowedMimeTypes = [\r\n            'application/octet-stream',\r\n            'application/vnd.ms-project'\r\n        ];\r\n        \r\n        const ext = path.extname(file.originalname).toLowerCase();\r\n        const mimeType = file.mimetype.toLowerCase();\r\n        \r\n        // Verificar extensÃ£o\r\n        if (!allowedExtensions.includes(ext)) {\r\n            return cb(new Error('INVALID_FILE_TYPE'));\r\n        }\r\n        \r\n        // Verificar MIME type (dupla validaÃ§Ã£o)\r\n        if (!allowedMimeTypes.includes(mimeType)) {\r\n            return cb(new Error('INVALID_MIME_TYPE'));\r\n        }\r\n        \r\n        // Validar nome do arquivo\r\n        if (file.originalname.length > 255) {\r\n            return cb(new Error('FILENAME_TOO_LONG'));\r\n        }\r\n        \r\n        // Verificar caracteres maliciosos no nome\r\n        const dangerousPatterns = [\r\n            /\\.\\./,  // Path traversal\r\n            /[<>:\"|?*\\x00-\\x1F]/,  // Caracteres perigosos\r\n            /\\.(exe|bat|cmd|scr|pif|vbs|js)$/i  // ExecutÃ¡veis\r\n        ];\r\n        \r\n        if (dangerousPatterns.some(pattern => pattern.test(file.originalname))) {\r\n            return cb(new Error('DANGEROUS_FILENAME'));\r\n        }\r\n        \r\n        cb(null, true);\r\n    } catch (error) {\r\n        cb(new Error('FILE_VALIDATION_ERROR'));\r\n    }\r\n};\r\n\r\nconst upload = multer({\r\n    storage: storage,\r\n    limits: {\r\n        fileSize: 50 * 1024 * 1024, // 50MB\r\n        files: 1, // Apenas 1 arquivo por vez\r\n        fields: 5, // Limite de campos\r\n        fieldNameSize: 100, // Limite nome dos campos\r\n        fieldSize: 1024 * 1024 // 1MB por campo\r\n    },\r\n    fileFilter: fileFilter\r\n});\r\n\r\n// Middleware de autenticaÃ§Ã£o para admin\r\nconst authenticateAdmin = async (req, res, next) => {\r\n    try {\r\n        const authHeader = req.headers.authorization;\r\n        \r\n        if (!authHeader || !authHeader.startsWith('Bearer ')) {\r\n            return res.status(401).json({ error: 'Token de acesso necessÃ¡rio' });\r\n        }\r\n        \r\n        const token = authHeader.substring(7);\r\n        const decoded = jwt.verify(token, securityConfig.JWT_SECRET);\r\n        \r\n        if (decoded.role !== 'admin') {\r\n            return res.status(403).json({ error: 'Acesso negado' });\r\n        }\r\n        \r\n        req.admin = decoded;\r\n        next();\r\n    } catch (error) {\r\n        return res.status(401).json({ error: 'Token invÃ¡lido' });\r\n    }\r\n};\r\n\r\n// FunÃ§Ã£o para obter IP do cliente de forma segura\r\nfunction getClientIP(req) {\r\n    const xForwardedFor = req.headers['x-forwarded-for'];\r\n    const xRealIP = req.headers['x-real-ip'];\r\n    const connectionRemoteAddr = req.connection?.remoteAddress;\r\n    const socketRemoteAddr = req.socket?.remoteAddress;\r\n    const connectionSocketRemoteAddr = req.connection?.socket?.remoteAddress;\r\n    \r\n    let clientIP = xForwardedFor || xRealIP || connectionRemoteAddr || \r\n                   socketRemoteAddr || connectionSocketRemoteAddr || '127.0.0.1';\r\n    \r\n    // Se houver mÃºltiplos IPs, pegar o primeiro (cliente real)\r\n    if (clientIP.includes(',')) {\r\n        clientIP = clientIP.split(',')[0].trim();\r\n    }\r\n    \r\n    // Validar formato do IP\r\n    if (!validator.isIP(clientIP)) {\r\n        clientIP = '127.0.0.1';\r\n    }\r\n    \r\n    return clientIP;\r\n}\r\n\r\n// Criptografia de dados sensÃ­veis\r\nclass SecurityUtils {\r\n    static encrypt(text) {\r\n        const iv = crypto.randomBytes(16);\r\n        const cipher = crypto.createCipher('aes-256-gcm', securityConfig.ENCRYPTION_KEY);\r\n        let encrypted = cipher.update(text, 'utf8', 'hex');\r\n        encrypted += cipher.final('hex');\r\n        const authTag = cipher.getAuthTag();\r\n        return {\r\n            encrypted: encrypted,\r\n            iv: iv.toString('hex'),\r\n            authTag: authTag.toString('hex')\r\n        };\r\n    }\r\n    \r\n    static decrypt(encryptedData) {\r\n        const decipher = crypto.createDecipher('aes-256-gcm', securityConfig.ENCRYPTION_KEY);\r\n        decipher.setAuthTag(Buffer.from(encryptedData.authTag, 'hex'));\r\n        let decrypted = decipher.update(encryptedData.encrypted, 'hex', 'utf8');\r\n        decrypted += decipher.final('utf8');\r\n        return decrypted;\r\n    }\r\n    \r\n    static generateSecureToken() {\r\n        return crypto.randomBytes(32).toString('hex');\r\n    }\r\n    \r\n    static hashPassword(password) {\r\n        return bcrypt.hashSync(password, 12);\r\n    }\r\n    \r\n    static verifyPassword(password, hash) {\r\n        return bcrypt.compareSync(password, hash);\r\n    }\r\n}\r\n\r\n// Headers de seguranÃ§a adicionais\r\napp.use((req, res, next) => {\r\n    // Prevent clickjacking\r\n    res.setHeader('X-Frame-Options', 'DENY');\r\n    \r\n    // Prevent MIME type sniffing\r\n    res.setHeader('X-Content-Type-Options', 'nosniff');\r\n    \r\n    // Enable XSS protection\r\n    res.setHeader('X-XSS-Protection', '1; mode=block');\r\n    \r\n    // Strict transport security\r\n    res.setHeader('Strict-Transport-Security', 'max-age=31536000; includeSubDomains');\r\n    \r\n    // Remove server information\r\n    res.removeHeader('X-Powered-By');\r\n    \r\n    next();\r\n});\r\n\r\nmodule.exports = {\r\n    app,\r\n    SecurityUtils,\r\n    securityConfig,\r\n    authenticateAdmin,\r\n    getClientIP\r\n};","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rafae\\Desktop\\PROJETOS DE ESTUDOS\\CONVERSOR MPP XML\\api\\server-2fa.js","messages":[{"ruleId":"security/detect-non-literal-fs-filename","severity":1,"message":"Found existsSync from package \"fs\" with non literal argument at index 0","line":16,"column":14,"nodeType":"CallExpression","endLine":16,"endColumn":32},{"ruleId":"security/detect-non-literal-fs-filename","severity":1,"message":"Found mkdirSync from package \"fs\" with non literal argument at index 0","line":17,"column":13,"nodeType":"CallExpression","endLine":17,"endColumn":51},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":27,"column":1,"nodeType":"MemberExpression","messageId":"unexpected","endLine":27,"endColumn":12,"suggestions":[{"fix":{"range":[671,719],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"prefer-const","severity":2,"message":"'pendingCodes' is never reassigned. Use 'const' instead.","line":30,"column":5,"nodeType":"Identifier","messageId":"useConst","endLine":30,"endColumn":17,"fix":{"range":[750,779],"text":"const pendingCodes = new Map();"}},{"ruleId":"no-unused-vars","severity":2,"message":"'success' is defined but never used.","line":42,"column":33,"nodeType":"Identifier","messageId":"unusedVar","endLine":42,"endColumn":40,"suggestions":[{"messageId":"removeVar","data":{"varName":"success"},"fix":{"range":[1187,1196],"text":""},"desc":"Remove unused variable 'success'."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":44,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":44,"endColumn":20,"suggestions":[{"fix":{"range":[1230,1307],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":45,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":45,"endColumn":20,"suggestions":[{"fix":{"range":[1317,1390],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":47,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":47,"endColumn":20,"suggestions":[{"fix":{"range":[1414,1470],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":56,"column":1,"nodeType":"MemberExpression","messageId":"unexpected","endLine":56,"endColumn":12,"suggestions":[{"fix":{"range":[1619,1661],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":64,"column":1,"nodeType":"MemberExpression","messageId":"unexpected","endLine":64,"endColumn":12,"suggestions":[{"fix":{"range":[1793,1829],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":145,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":145,"endColumn":20,"suggestions":[{"fix":{"range":[5906,5956],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":148,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":148,"endColumn":22,"suggestions":[{"fix":{"range":[6011,6071],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"security/detect-object-injection","severity":2,"message":"Generic Object Injection Sink","line":168,"column":10,"nodeType":"MemberExpression","endLine":168,"endColumn":41},{"ruleId":"security/detect-object-injection","severity":2,"message":"Generic Object Injection Sink","line":169,"column":9,"nodeType":"MemberExpression","endLine":169,"endColumn":40},{"ruleId":"security/detect-object-injection","severity":2,"message":"Generic Object Injection Sink","line":171,"column":5,"nodeType":"MemberExpression","endLine":171,"endColumn":36},{"ruleId":"security/detect-object-injection","severity":2,"message":"Generic Object Injection Sink","line":172,"column":5,"nodeType":"MemberExpression","endLine":172,"endColumn":36},{"ruleId":"security/detect-object-injection","severity":2,"message":"Generic Object Injection Sink","line":175,"column":10,"nodeType":"MemberExpression","endLine":175,"endColumn":46},{"ruleId":"security/detect-object-injection","severity":2,"message":"Generic Object Injection Sink","line":176,"column":9,"nodeType":"MemberExpression","endLine":176,"endColumn":45},{"ruleId":"security/detect-object-injection","severity":2,"message":"Generic Object Injection Sink","line":178,"column":5,"nodeType":"MemberExpression","endLine":178,"endColumn":41},{"ruleId":"security/detect-object-injection","severity":2,"message":"Generic Object Injection Sink","line":179,"column":5,"nodeType":"MemberExpression","endLine":179,"endColumn":41},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":181,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":181,"endColumn":16,"suggestions":[{"fix":{"range":[7163,7230],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":185,"column":1,"nodeType":"MemberExpression","messageId":"unexpected","endLine":185,"endColumn":12,"suggestions":[{"fix":{"range":[7263,7311],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":191,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":191,"endColumn":16,"suggestions":[{"fix":{"range":[7399,7442],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":202,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":202,"endColumn":16,"suggestions":[{"fix":{"range":[7721,7809],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":205,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":205,"endColumn":20,"suggestions":[{"fix":{"range":[7847,7889],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"security/detect-non-literal-fs-filename","severity":1,"message":"Found writeFileSync from package \"fs\" with non literal argument at index 0","line":221,"column":5,"nodeType":"CallExpression","endLine":221,"endColumn":42},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":225,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":225,"endColumn":16,"suggestions":[{"fix":{"range":[8499,8545],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":242,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":242,"endColumn":16,"suggestions":[{"fix":{"range":[8995,9055],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"security/detect-non-literal-fs-filename","severity":1,"message":"Found existsSync from package \"fs\" with non literal argument at index 0","line":246,"column":9,"nodeType":"CallExpression","endLine":246,"endColumn":32},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":259,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":259,"endColumn":16,"suggestions":[{"fix":{"range":[9528,9704],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":282,"column":17,"nodeType":"MemberExpression","messageId":"unexpected","endLine":282,"endColumn":28,"suggestions":[{"fix":{"range":[10362,10412],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":286,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":286,"endColumn":20,"suggestions":[{"fix":{"range":[10488,10548],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":287,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":287,"endColumn":20,"suggestions":[{"fix":{"range":[10558,10598],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":301,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":301,"endColumn":24,"suggestions":[{"fix":{"range":[11072,11128],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":302,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":302,"endColumn":24,"suggestions":[{"fix":{"range":[11142,11211],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":313,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":313,"endColumn":20,"suggestions":[{"fix":{"range":[11557,11617],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":317,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":317,"endColumn":24,"suggestions":[{"fix":{"range":[11709,11783],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":331,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":331,"endColumn":16,"suggestions":[{"fix":{"range":[12098,12291],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":340,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":340,"endColumn":20,"suggestions":[{"fix":{"range":[12386,12437],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":351,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":351,"endColumn":20,"suggestions":[{"fix":{"range":[12808,12841],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":361,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":361,"endColumn":20,"suggestions":[{"fix":{"range":[13125,13179],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":375,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":375,"endColumn":20,"suggestions":[{"fix":{"range":[13626,13704],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":376,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":376,"endColumn":20,"suggestions":[{"fix":{"range":[13714,13761],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":389,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":389,"endColumn":20,"suggestions":[{"fix":{"range":[14142,14212],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"security/detect-object-injection","severity":2,"message":"Generic Object Injection Sink","line":428,"column":24,"nodeType":"MemberExpression","endLine":428,"endColumn":55},{"ruleId":"security/detect-object-injection","severity":2,"message":"Generic Object Injection Sink","line":450,"column":23,"nodeType":"MemberExpression","endLine":450,"endColumn":54},{"ruleId":"security/detect-object-injection","severity":2,"message":"Generic Object Injection Sink","line":451,"column":27,"nodeType":"MemberExpression","endLine":451,"endColumn":58},{"ruleId":"security/detect-object-injection","severity":2,"message":"Generic Object Injection Sink","line":452,"column":25,"nodeType":"MemberExpression","endLine":452,"endColumn":62},{"ruleId":"security/detect-object-injection","severity":2,"message":"Generic Object Injection Sink","line":453,"column":29,"nodeType":"MemberExpression","endLine":453,"endColumn":66},{"ruleId":"security/detect-non-literal-fs-filename","severity":1,"message":"Found existsSync from package \"fs\" with non literal argument at index 0","line":499,"column":13,"nodeType":"CallExpression","endLine":499,"endColumn":35},{"ruleId":"security/detect-non-literal-fs-filename","severity":1,"message":"Found readdirSync from package \"fs\" with non literal argument at index 0","line":500,"column":27,"nodeType":"CallExpression","endLine":500,"endColumn":50},{"ruleId":"security/detect-non-literal-fs-filename","severity":1,"message":"Found statSync from package \"fs\" with non literal argument at index 0","line":501,"column":31,"nodeType":"CallExpression","endLine":501,"endColumn":68},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":513,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":513,"endColumn":22,"suggestions":[{"fix":{"range":[18765,18814],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":520,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":520,"endColumn":16,"suggestions":[{"fix":{"range":[18926,18942],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":521,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":521,"endColumn":16,"suggestions":[{"fix":{"range":[18948,18986],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":522,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":522,"endColumn":16,"suggestions":[{"fix":{"range":[18992,19028],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":523,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":523,"endColumn":16,"suggestions":[{"fix":{"range":[19034,19066],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":524,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":524,"endColumn":16,"suggestions":[{"fix":{"range":[19072,19120],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":525,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":525,"endColumn":16,"suggestions":[{"fix":{"range":[19126,19182],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":526,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":526,"endColumn":16,"suggestions":[{"fix":{"range":[19188,19250],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":527,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":527,"endColumn":16,"suggestions":[{"fix":{"range":[19256,19272],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":528,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":528,"endColumn":16,"suggestions":[{"fix":{"range":[19278,19322],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":529,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":529,"endColumn":16,"suggestions":[{"fix":{"range":[19328,19383],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":530,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":530,"endColumn":16,"suggestions":[{"fix":{"range":[19389,19459],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":531,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":531,"endColumn":16,"suggestions":[{"fix":{"range":[19465,19481],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":532,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":532,"endColumn":16,"suggestions":[{"fix":{"range":[19487,19538],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":537,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":537,"endColumn":18,"suggestions":[{"fix":{"range":[19605,19649],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":541,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":541,"endColumn":18,"suggestions":[{"fix":{"range":[19708,19757],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":542,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":542,"endColumn":16,"suggestions":[{"fix":{"range":[19763,19812],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'promise' is defined but never used.","line":545,"column":43,"nodeType":"Identifier","messageId":"unusedVar","endLine":545,"endColumn":50,"suggestions":[{"messageId":"removeVar","data":{"varName":"promise"},"fix":{"range":[19861,19870],"text":""},"desc":"Remove unused variable 'promise'."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":546,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":546,"endColumn":18,"suggestions":[{"fix":{"range":[19882,19932],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":547,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":547,"endColumn":16,"suggestions":[{"fix":{"range":[19938,19987],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":551,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":551,"endColumn":16,"suggestions":[{"fix":{"range":[20031,20096],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":556,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":556,"endColumn":16,"suggestions":[{"fix":{"range":[20161,20225],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":16,"fatalErrorCount":0,"warningCount":58,"fixableErrorCount":1,"fixableWarningCount":0,"source":"/**\r\n * Servidor com 2FA Real - Sistema de CÃ³digos por Email\r\n */\r\n\r\nconst express = require('express');\r\nconst multer = require('multer');\r\nconst path = require('path');\r\nconst fs = require('fs');\r\nconst crypto = require('crypto');\r\nconst nodemailer = require('nodemailer');\r\n\r\n// Garantir diretÃ³rios essenciais\r\nconst ensureDirectories = () => {\r\n    const dirs = ['uploads/incoming', 'uploads/converted', 'uploads/processing', 'uploads/expired', 'logs'];\r\n    dirs.forEach(dir => {\r\n        if (!fs.existsSync(dir)) {\r\n            fs.mkdirSync(dir, { recursive: true });\r\n        }\r\n    });\r\n};\r\n\r\nensureDirectories();\r\n\r\nconst app = express();\r\nconst PORT = 3000;\r\n\r\nconsole.log('ðŸ”§ Iniciando servidor com 2FA...');\r\n\r\n// Sistema de cÃ³digos 2FA\r\nlet pendingCodes = new Map(); // Store: email -> {code, timestamp, attempts, username}\r\n\r\n// ConfiguraÃ§Ã£o do email para 2FA\r\nconst emailTransporter = nodemailer.createTransporter({\r\n    service: 'hotmail',\r\n    auth: {\r\n        user: 'rafaelcannalonga2@hotmail.com',\r\n        pass: process.env.EMAIL_PASSWORD || 'SUA_SENHA_EMAIL_AQUI' // Configurar no .env\r\n    }\r\n});\r\n\r\n// Teste da configuraÃ§Ã£o de email\r\nemailTransporter.verify((error, success) => {\r\n    if (error) {\r\n        console.log('âš ï¸ ConfiguraÃ§Ã£o de email precisa ser ajustada:', error.message);\r\n        console.log('ðŸ“§ CÃ³digos serÃ£o exibidos no console para desenvolvimento');\r\n    } else {\r\n        console.log('âœ… Servidor de email configurado e pronto');\r\n    }\r\n});\r\n\r\n// Middlewares bÃ¡sicos\r\napp.use(express.json());\r\napp.use(express.static('public'));\r\napp.use('/admin', express.static('admin'));\r\n\r\nconsole.log('âœ… Middlewares configurados');\r\n\r\n// Upload simples\r\nconst upload = multer({ \r\n    dest: 'uploads/incoming/',\r\n    limits: { fileSize: 10 * 1024 * 1024 }\r\n});\r\n\r\nconsole.log('âœ… Upload configurado');\r\n\r\n// Dados financeiros\r\nconst financialData = {\r\n    conversionsCount: 0,\r\n    totalRevenue: 0,\r\n    pricePerConversion: 10.00,\r\n    transactions: [],\r\n    dailyStats: {},\r\n    monthlyStats: {}\r\n};\r\n\r\n// FunÃ§Ã£o para gerar cÃ³digo 2FA\r\nfunction generateTwoFactorCode() {\r\n    return Math.floor(100000 + Math.random() * 900000).toString(); // 6 dÃ­gitos\r\n}\r\n\r\n// FunÃ§Ã£o para enviar email com cÃ³digo 2FA\r\nasync function sendTwoFactorCode(email, code, username) {\r\n    const mailOptions = {\r\n        from: 'rafaelcannalonga2@hotmail.com',\r\n        to: email,\r\n        subject: 'ðŸ” CÃ³digo de VerificaÃ§Ã£o - MPP Converter',\r\n        html: `\r\n            <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; background: #f8f9fa; padding: 20px;\">\r\n                <div style=\"background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);\">\r\n                    <h2 style=\"color: #2c3e50; text-align: center; margin-bottom: 30px;\">\r\n                        ðŸ” MPP Converter - VerificaÃ§Ã£o de SeguranÃ§a\r\n                    </h2>\r\n                    \r\n                    <p style=\"font-size: 16px; color: #34495e;\">\r\n                        OlÃ¡ <strong>${username}</strong>,\r\n                    </p>\r\n                    \r\n                    <p style=\"font-size: 16px; color: #34495e; line-height: 1.5;\">\r\n                        Detectamos uma tentativa de login no seu painel administrativo do MPP Converter.\r\n                        Para completar o acesso, use o cÃ³digo de verificaÃ§Ã£o abaixo:\r\n                    </p>\r\n                    \r\n                    <div style=\"background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px; text-align: center; margin: 30px 0; border-radius: 10px; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);\">\r\n                        <p style=\"color: white; margin: 0 0 10px 0; font-size: 14px; text-transform: uppercase; letter-spacing: 1px;\">\r\n                            CÃ³digo de VerificaÃ§Ã£o\r\n                        </p>\r\n                        <h1 style=\"color: white; font-size: 42px; margin: 0; letter-spacing: 8px; font-weight: bold;\">\r\n                            ${code}\r\n                        </h1>\r\n                    </div>\r\n                    \r\n                    <div style=\"background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 5px; margin: 20px 0;\">\r\n                        <p style=\"margin: 0; color: #856404; font-size: 14px;\">\r\n                            âš ï¸ <strong>Importante:</strong> Este cÃ³digo expira em 5 minutos e pode ser usado apenas uma vez.\r\n                        </p>\r\n                    </div>\r\n                    \r\n                    <div style=\"background: #f8d7da; border: 1px solid #f5c6cb; padding: 15px; border-radius: 5px; margin: 20px 0;\">\r\n                        <p style=\"margin: 0; color: #721c24; font-size: 14px;\">\r\n                            ðŸ›¡ï¸ <strong>SeguranÃ§a:</strong> Se vocÃª nÃ£o solicitou este acesso, alguÃ©m pode estar tentando acessar sua conta. \r\n                            Entre em contato imediatamente se suspeitar de atividade nÃ£o autorizada.\r\n                        </p>\r\n                    </div>\r\n                    \r\n                    <hr style=\"border: none; border-top: 1px solid #ecf0f1; margin: 30px 0;\">\r\n                    \r\n                    <div style=\"text-align: center; color: #7f8c8d; font-size: 12px;\">\r\n                        <p style=\"margin: 5px 0;\">\r\n                            <strong>MPP Converter</strong> - Sistema de ConversÃ£o de Arquivos\r\n                        </p>\r\n                        <p style=\"margin: 5px 0;\">\r\n                            HorÃ¡rio: ${new Date().toLocaleString('pt-BR')}\r\n                        </p>\r\n                        <p style=\"margin: 5px 0;\">\r\n                            IP: Protegido por seguranÃ§a\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        `\r\n    };\r\n\r\n    try {\r\n        await emailTransporter.sendMail(mailOptions);\r\n        console.log(`âœ… CÃ³digo 2FA enviado para ${email}`);\r\n        return true;\r\n    } catch (error) {\r\n        console.error('âŒ Erro ao enviar email 2FA:', error.message);\r\n        return false;\r\n    }\r\n}\r\n\r\n// FunÃ§Ã£o para registrar conversÃ£o paga\r\nconst registerPaidConversion = (fileName, amount) => {\r\n    const transaction = {\r\n        id: crypto.randomBytes(16).toString('hex'),\r\n        fileName: fileName,\r\n        amount: amount,\r\n        date: new Date().toISOString(),\r\n        status: 'completed'\r\n    };\r\n    \r\n    financialData.transactions.push(transaction);\r\n    financialData.conversionsCount++;\r\n    financialData.totalRevenue += amount;\r\n    \r\n    const today = new Date().toISOString().split('T')[0];\r\n    if (!financialData.dailyStats[today]) {\r\n        financialData.dailyStats[today] = { count: 0, revenue: 0 };\r\n    }\r\n    financialData.dailyStats[today].count++;\r\n    financialData.dailyStats[today].revenue += amount;\r\n    \r\n    const monthKey = new Date().toISOString().slice(0, 7);\r\n    if (!financialData.monthlyStats[monthKey]) {\r\n        financialData.monthlyStats[monthKey] = { count: 0, revenue: 0 };\r\n    }\r\n    financialData.monthlyStats[monthKey].count++;\r\n    financialData.monthlyStats[monthKey].revenue += amount;\r\n    \r\n    console.log(`ðŸ’° ConversÃ£o registrada: ${fileName} - R$ ${amount}`);\r\n    return transaction;\r\n};\r\n\r\nconsole.log('âœ… Sistema financeiro configurado');\r\n\r\n// ROTAS PRINCIPAIS\r\n\r\n// Health check\r\napp.get('/api/health', (req, res) => {\r\n    console.log('ðŸ’š Health check requisitado');\r\n    res.json({ \r\n        status: 'ok', \r\n        timestamp: new Date().toISOString(),\r\n        message: 'Servidor com 2FA funcionando!',\r\n        twoFactorEnabled: true\r\n    });\r\n});\r\n\r\n// Upload e conversÃ£o\r\napp.post('/api/upload', upload.single('file'), (req, res) => {\r\n    console.log('ðŸ“ Upload recebido:', req.file ? req.file.originalname : 'Nenhum arquivo');\r\n    \r\n    if (!req.file) {\r\n        console.log('âŒ Nenhum arquivo no upload');\r\n        return res.status(400).json({\r\n            success: false,\r\n            error: 'Nenhum arquivo enviado'\r\n        });\r\n    }\r\n\r\n    const xmlContent = `<?xml version=\"1.0\"?>\r\n<Project>\r\n    <Title>ConversÃ£o de ${req.file.originalname}</Title>\r\n    <Date>${new Date().toISOString()}</Date>\r\n    <Status>Sucesso</Status>\r\n    <ConvertedBy>MPP Converter Pro</ConvertedBy>\r\n</Project>`;\r\n\r\n    const xmlPath = path.join('uploads', 'converted', req.file.filename + '.xml');\r\n    fs.writeFileSync(xmlPath, xmlContent);\r\n\r\n    const transaction = registerPaidConversion(req.file.originalname, 10.00);\r\n\r\n    console.log('âœ… Arquivo convertido:', xmlPath);\r\n\r\n    res.json({\r\n        success: true,\r\n        message: 'Arquivo convertido com sucesso!',\r\n        xml: xmlContent,\r\n        downloadUrl: '/api/download/' + req.file.filename + '.xml',\r\n        transaction: {\r\n            id: transaction.id,\r\n            amount: transaction.amount,\r\n            status: transaction.status\r\n        }\r\n    });\r\n});\r\n\r\n// Download de arquivos convertidos\r\napp.get('/api/download/:filename', (req, res) => {\r\n    console.log('â¬‡ï¸ Download solicitado:', req.params.filename);\r\n    \r\n    const filePath = path.join(__dirname, '../uploads/converted', req.params.filename);\r\n    \r\n    if (fs.existsSync(filePath)) {\r\n        res.download(filePath);\r\n    } else {\r\n        res.status(404).json({ error: 'Arquivo nÃ£o encontrado' });\r\n    }\r\n});\r\n\r\n// SISTEMA DE AUTENTICAÃ‡ÃƒO 2FA\r\n\r\n// Endpoint de login - Etapa 1: Validar credenciais e enviar cÃ³digo\r\napp.post('/api/login', async (req, res) => {\r\n    const { username, password } = req.body;\r\n    \r\n    console.log(`[${new Date().toISOString()}] Tentativa de login:`, {\r\n        username,\r\n        ip: req.ip,\r\n        userAgent: req.get('User-Agent')?.substring(0, 100)\r\n    });\r\n    \r\n    // Credenciais personalizadas para Rafael Cannalonga\r\n    if (username === 'Alcap0ne' && password === 'C@rolin@36932025') {\r\n        const email = 'rafaelcannalonga2@hotmail.com';\r\n        const code = generateTwoFactorCode();\r\n        \r\n        // Armazenar cÃ³digo temporariamente (5 minutos)\r\n        pendingCodes.set(email, {\r\n            code: code,\r\n            timestamp: Date.now(),\r\n            attempts: 0,\r\n            username: username\r\n        });\r\n        \r\n        // Limpar cÃ³digo apÃ³s 5 minutos\r\n        setTimeout(() => {\r\n            if (pendingCodes.has(email)) {\r\n                pendingCodes.delete(email);\r\n                console.log('ðŸ—‘ï¸ CÃ³digo 2FA expirado e removido');\r\n            }\r\n        }, 5 * 60 * 1000); // 5 minutos\r\n        \r\n        console.log('âœ… Credenciais vÃ¡lidas para Rafael Cannalonga');\r\n        console.log('ðŸ“§ Gerando cÃ³digo 2FA...');\r\n        \r\n        // Tentar enviar email\r\n        const emailSent = await sendTwoFactorCode(email, code, username);\r\n        \r\n        if (emailSent) {\r\n            res.json({ \r\n                success: true, \r\n                message: 'CÃ³digo de verificaÃ§Ã£o enviado para seu email',\r\n                requiresCode: true,\r\n                email: email\r\n            });\r\n        } else {\r\n            // Fallback: mostrar cÃ³digo no console para desenvolvimento\r\n            console.log(`ðŸ” [DESENVOLVIMENTO] CÃ³digo 2FA: ${code}`);\r\n            console.log('ðŸ“§ Configure o EMAIL_PASSWORD no .env para envio real');\r\n            \r\n            res.json({ \r\n                success: true, \r\n                message: 'CÃ³digo gerado (verifique o console do servidor)',\r\n                requiresCode: true,\r\n                email: email,\r\n                devCode: code // Para desenvolvimento - remover em produÃ§Ã£o\r\n            });\r\n        }\r\n    } else {\r\n        console.log('âŒ Tentativa de login invÃ¡lida:', { username });\r\n        \r\n        // Log de tentativa de invasÃ£o\r\n        setTimeout(() => {\r\n            console.log('ðŸš¨ Alerta de seguranÃ§a: tentativa de acesso nÃ£o autorizado');\r\n        }, 1000);\r\n        \r\n        res.status(401).json({ \r\n            success: false, \r\n            message: 'Credenciais invÃ¡lidas' \r\n        });\r\n    }\r\n});\r\n\r\n// Endpoint de login - Etapa 2: Validar cÃ³digo 2FA\r\napp.post('/api/verify-code', (req, res) => {\r\n    const { code, email } = req.body;\r\n    \r\n    console.log(`[${new Date().toISOString()}] Tentativa de validaÃ§Ã£o 2FA:`, {\r\n        email,\r\n        code: code?.substring(0, 3) + '***', // Partial log for security\r\n        ip: req.ip\r\n    });\r\n    \r\n    const storedData = pendingCodes.get(email);\r\n    \r\n    if (!storedData) {\r\n        console.log('âŒ CÃ³digo nÃ£o encontrado ou expirado');\r\n        return res.status(400).json({ \r\n            success: false, \r\n            message: 'CÃ³digo nÃ£o encontrado ou expirado. FaÃ§a login novamente.' \r\n        });\r\n    }\r\n    \r\n    // Verificar se cÃ³digo expirou (5 minutos)\r\n    const isExpired = (Date.now() - storedData.timestamp) > 5 * 60 * 1000;\r\n    if (isExpired) {\r\n        pendingCodes.delete(email);\r\n        console.log('âŒ CÃ³digo expirado');\r\n        return res.status(400).json({ \r\n            success: false, \r\n            message: 'CÃ³digo expirado. FaÃ§a login novamente.' \r\n        });\r\n    }\r\n    \r\n    // Verificar tentativas (mÃ¡ximo 3)\r\n    if (storedData.attempts >= 3) {\r\n        pendingCodes.delete(email);\r\n        console.log('âŒ Muitas tentativas de cÃ³digo invÃ¡lido');\r\n        return res.status(400).json({ \r\n            success: false, \r\n            message: 'Muitas tentativas incorretas. FaÃ§a login novamente.' \r\n        });\r\n    }\r\n    \r\n    // Validar cÃ³digo\r\n    if (code === storedData.code) {\r\n        // CÃ³digo correto - limpar e autenticar\r\n        pendingCodes.delete(email);\r\n        \r\n        const authToken = `admin_token_${crypto.randomBytes(16).toString('hex')}_${Date.now()}`;\r\n        \r\n        console.log('âœ… CÃ³digo 2FA vÃ¡lido - Login completo para', storedData.username);\r\n        console.log('ðŸ” Token de autenticaÃ§Ã£o gerado');\r\n        \r\n        res.json({ \r\n            success: true, \r\n            message: 'AutenticaÃ§Ã£o 2FA completa',\r\n            token: authToken,\r\n            user: storedData.username,\r\n            email: email,\r\n            loginTime: new Date().toISOString()\r\n        });\r\n    } else {\r\n        // CÃ³digo incorreto - incrementar tentativas\r\n        storedData.attempts++;\r\n        console.log(`âŒ CÃ³digo invÃ¡lido - Tentativa ${storedData.attempts}/3`);\r\n        \r\n        res.status(400).json({ \r\n            success: false, \r\n            message: `CÃ³digo incorreto. Tentativas restantes: ${3 - storedData.attempts}` \r\n        });\r\n    }\r\n});\r\n\r\n// Middleware de autenticaÃ§Ã£o para rotas admin\r\nconst authenticateAdmin = (req, res, next) => {\r\n    const authHeader = req.headers.authorization;\r\n    \r\n    if (!authHeader || !authHeader.startsWith('Bearer ')) {\r\n        return res.status(401).json({ error: 'Token de acesso requerido' });\r\n    }\r\n    \r\n    const token = authHeader.substring(7);\r\n    if (token.startsWith('admin_token_')) {\r\n        // Validar se token nÃ£o expirou (24 horas)\r\n        const tokenParts = token.split('_');\r\n        const timestamp = parseInt(tokenParts[tokenParts.length - 1]);\r\n        const isTokenExpired = (Date.now() - timestamp) > 24 * 60 * 60 * 1000;\r\n        \r\n        if (isTokenExpired) {\r\n            return res.status(401).json({ error: 'Token expirado. FaÃ§a login novamente.' });\r\n        }\r\n        \r\n        next();\r\n    } else {\r\n        res.status(401).json({ error: 'Token invÃ¡lido' });\r\n    }\r\n};\r\n\r\n// ROTAS ADMIN PROTEGIDAS\r\n\r\n// EstatÃ­sticas bÃ¡sicas\r\napp.get('/api/stats/conversions-today', authenticateAdmin, (req, res) => {\r\n    const today = new Date().toISOString().split('T')[0];\r\n    const todayStats = financialData.dailyStats[today] || { count: 0 };\r\n    res.json({ count: todayStats.count });\r\n});\r\n\r\napp.get('/api/stats/total-files', authenticateAdmin, (req, res) => {\r\n    res.json({ count: financialData.conversionsCount });\r\n});\r\n\r\napp.get('/api/stats/disk-usage', authenticateAdmin, (req, res) => {\r\n    // Simular uso do disco\r\n    res.json({ usage: Math.floor(Math.random() * 30) + 10 });\r\n});\r\n\r\n// RelatÃ³rios financeiros\r\napp.get('/api/financial/summary', authenticateAdmin, (req, res) => {\r\n    const today = new Date().toISOString().split('T')[0];\r\n    const thisMonth = new Date().toISOString().substring(0, 7);\r\n    \r\n    res.json({\r\n        totalRevenue: financialData.totalRevenue,\r\n        totalConversions: financialData.conversionsCount,\r\n        pricePerConversion: financialData.pricePerConversion,\r\n        todayRevenue: financialData.dailyStats[today]?.revenue || 0,\r\n        todayConversions: financialData.dailyStats[today]?.count || 0,\r\n        monthlyRevenue: financialData.monthlyStats[thisMonth]?.revenue || 0,\r\n        monthlyConversions: financialData.monthlyStats[thisMonth]?.count || 0,\r\n        averageDaily: financialData.totalRevenue / Math.max(Object.keys(financialData.dailyStats).length, 1),\r\n        taxCalculation: {\r\n            grossRevenue: financialData.totalRevenue,\r\n            estimatedTax27_5: financialData.totalRevenue * 0.275,\r\n            estimatedTax22_5: financialData.totalRevenue * 0.225,\r\n            estimatedTax15: financialData.totalRevenue * 0.15\r\n        }\r\n    });\r\n});\r\n\r\napp.get('/api/financial/transactions', authenticateAdmin, (req, res) => {\r\n    const page = parseInt(req.query.page) || 1;\r\n    const limit = parseInt(req.query.limit) || 50;\r\n    const startIndex = (page - 1) * limit;\r\n    const endIndex = startIndex + limit;\r\n    \r\n    const sortedTransactions = financialData.transactions\r\n        .sort((a, b) => new Date(b.date) - new Date(a.date))\r\n        .slice(startIndex, endIndex);\r\n    \r\n    res.json({\r\n        transactions: sortedTransactions,\r\n        pagination: {\r\n            page: page,\r\n            limit: limit,\r\n            total: financialData.transactions.length,\r\n            totalPages: Math.ceil(financialData.transactions.length / limit)\r\n        }\r\n    });\r\n});\r\n\r\napp.get('/api/financial/monthly-report', authenticateAdmin, (req, res) => {\r\n    res.json({\r\n        monthlyStats: financialData.monthlyStats,\r\n        yearlyTotal: Object.values(financialData.monthlyStats)\r\n            .reduce((sum, month) => sum + month.revenue, 0)\r\n    });\r\n});\r\n\r\n// GestÃ£o de arquivos\r\napp.get('/api/files/:directory', authenticateAdmin, (req, res) => {\r\n    const directory = req.params.directory;\r\n    const dirPath = path.join('uploads', directory);\r\n    \r\n    try {\r\n        if (fs.existsSync(dirPath)) {\r\n            const files = fs.readdirSync(dirPath).map(file => {\r\n                const stats = fs.statSync(path.join(dirPath, file));\r\n                return {\r\n                    name: file,\r\n                    size: stats.size,\r\n                    modified: stats.mtime\r\n                };\r\n            });\r\n            res.json({ files });\r\n        } else {\r\n            res.json({ files: [] });\r\n        }\r\n    } catch (error) {\r\n        console.error('Erro ao listar arquivos:', error);\r\n        res.json({ files: [] });\r\n    }\r\n});\r\n\r\n// Iniciar servidor\r\napp.listen(PORT, '0.0.0.0', () => {\r\n    console.log('');\r\n    console.log('ðŸš€ SERVIDOR 2FA ATIVO!');\r\n    console.log('====================');\r\n    console.log(`âœ… Porta: ${PORT}`);\r\n    console.log(`ðŸŒ URL: http://localhost:${PORT}`);\r\n    console.log(`ðŸ” Admin: http://localhost:${PORT}/admin`);\r\n    console.log(`ðŸ’š Health: http://localhost:${PORT}/api/health`);\r\n    console.log('');\r\n    console.log('ðŸ›¡ï¸ Sistema 2FA configurado!');\r\n    console.log('ðŸ“§ Email: rafaelcannalonga2@hotmail.com');\r\n    console.log('âš ï¸  Configure EMAIL_PASSWORD no .env para emails reais');\r\n    console.log('');\r\n    console.log('ðŸŽ¯ Pronto para autenticaÃ§Ã£o segura!');\r\n});\r\n\r\n// Tratamento de erros\r\napp.on('error', (error) => {\r\n    console.error('âŒ Erro no servidor:', error);\r\n});\r\n\r\nprocess.on('uncaughtException', (error) => {\r\n    console.error('âŒ ExceÃ§Ã£o nÃ£o capturada:', error);\r\n    console.log('ðŸ”„ Servidor continuarÃ¡ rodando...');\r\n});\r\n\r\nprocess.on('unhandledRejection', (reason, promise) => {\r\n    console.error('âŒ Rejection nÃ£o tratada:', reason);\r\n    console.log('ðŸ”„ Servidor continuarÃ¡ rodando...');\r\n});\r\n\r\nprocess.on('SIGTERM', () => {\r\n    console.log('ðŸ“´ Recebido SIGTERM, finalizando graciosamente...');\r\n    process.exit(0);\r\n});\r\n\r\nprocess.on('SIGINT', () => {\r\n    console.log('ðŸ“´ Recebido SIGINT, finalizando graciosamente...');\r\n    process.exit(0);\r\n});","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rafae\\Desktop\\PROJETOS DE ESTUDOS\\CONVERSOR MPP XML\\api\\server-minimal.js","messages":[{"ruleId":"security/detect-non-literal-fs-filename","severity":1,"message":"Found existsSync from package \"fs\" with non literal argument at index 0","line":21,"column":14,"nodeType":"CallExpression","endLine":21,"endColumn":32},{"ruleId":"security/detect-non-literal-fs-filename","severity":1,"message":"Found mkdirSync from package \"fs\" with non literal argument at index 0","line":22,"column":13,"nodeType":"CallExpression","endLine":22,"endColumn":51},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":32,"column":1,"nodeType":"MemberExpression","messageId":"unexpected","endLine":32,"endColumn":12,"suggestions":[{"fix":{"range":[877,931],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":33,"column":1,"nodeType":"MemberExpression","messageId":"unexpected","endLine":33,"endColumn":12,"suggestions":[{"fix":{"range":[933,985],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":40,"column":1,"nodeType":"MemberExpression","messageId":"unexpected","endLine":40,"endColumn":12,"suggestions":[{"fix":{"range":[1156,1198],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":48,"column":1,"nodeType":"MemberExpression","messageId":"unexpected","endLine":48,"endColumn":12,"suggestions":[{"fix":{"range":[1330,1366],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"security/detect-object-injection","severity":2,"message":"Generic Object Injection Sink","line":76,"column":10,"nodeType":"MemberExpression","endLine":76,"endColumn":41},{"ruleId":"security/detect-object-injection","severity":2,"message":"Generic Object Injection Sink","line":77,"column":9,"nodeType":"MemberExpression","endLine":77,"endColumn":40},{"ruleId":"security/detect-object-injection","severity":2,"message":"Generic Object Injection Sink","line":79,"column":5,"nodeType":"MemberExpression","endLine":79,"endColumn":36},{"ruleId":"security/detect-object-injection","severity":2,"message":"Generic Object Injection Sink","line":80,"column":5,"nodeType":"MemberExpression","endLine":80,"endColumn":36},{"ruleId":"security/detect-object-injection","severity":2,"message":"Generic Object Injection Sink","line":84,"column":10,"nodeType":"MemberExpression","endLine":84,"endColumn":46},{"ruleId":"security/detect-object-injection","severity":2,"message":"Generic Object Injection Sink","line":85,"column":9,"nodeType":"MemberExpression","endLine":85,"endColumn":45},{"ruleId":"security/detect-object-injection","severity":2,"message":"Generic Object Injection Sink","line":87,"column":5,"nodeType":"MemberExpression","endLine":87,"endColumn":41},{"ruleId":"security/detect-object-injection","severity":2,"message":"Generic Object Injection Sink","line":88,"column":5,"nodeType":"MemberExpression","endLine":88,"endColumn":41},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":90,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":90,"endColumn":16,"suggestions":[{"fix":{"range":[2701,2768],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":94,"column":1,"nodeType":"MemberExpression","messageId":"unexpected","endLine":94,"endColumn":12,"suggestions":[{"fix":{"range":[2801,2849],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":98,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":98,"endColumn":16,"suggestions":[{"fix":{"range":[2907,2950],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":107,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":107,"endColumn":16,"suggestions":[{"fix":{"range":[3165,3253],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":108,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":108,"endColumn":16,"suggestions":[{"fix":{"range":[3259,3439],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":115,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":115,"endColumn":20,"suggestions":[{"fix":{"range":[3477,3519],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"security/detect-non-literal-fs-filename","severity":1,"message":"Found writeFileSync from package \"fs\" with non literal argument at index 0","line":132,"column":5,"nodeType":"CallExpression","endLine":132,"endColumn":42},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":137,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":137,"endColumn":16,"suggestions":[{"fix":{"range":[4185,4231],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":153,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":153,"endColumn":16,"suggestions":[{"fix":{"range":[4632,4692],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"security/detect-non-literal-fs-filename","severity":1,"message":"Found existsSync from package \"fs\" with non literal argument at index 0","line":157,"column":9,"nodeType":"CallExpression","endLine":157,"endColumn":32},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":166,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":166,"endColumn":16,"suggestions":[{"fix":{"range":[5025,5068],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":172,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":172,"endColumn":16,"suggestions":[{"fix":{"range":[5219,5263],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":178,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":178,"endColumn":16,"suggestions":[{"fix":{"range":[5427,5470],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":187,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":187,"endColumn":20,"suggestions":[{"fix":{"range":[5723,5784],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":226,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":226,"endColumn":22,"suggestions":[{"fix":{"range":[7027,7080],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'txId' is assigned a value but never used.","line":236,"column":57,"nodeType":"Identifier","messageId":"unusedVar","endLine":236,"endColumn":61,"suggestions":[{"messageId":"removeVar","data":{"varName":"txId"},"fix":{"range":[7341,7347],"text":""},"desc":"Remove unused variable 'txId'."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":283,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":283,"endColumn":16,"suggestions":[{"fix":{"range":[9236,9463],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":293,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":293,"endColumn":20,"suggestions":[{"fix":{"range":[9645,9704],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":294,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":294,"endColumn":20,"suggestions":[{"fix":{"range":[9714,9762],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":304,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":304,"endColumn":20,"suggestions":[{"fix":{"range":[10011,10072],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":305,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":305,"endColumn":20,"suggestions":[{"fix":{"range":[10082,10127],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":321,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":321,"endColumn":20,"suggestions":[{"fix":{"range":[10656,10723],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":331,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":331,"endColumn":20,"suggestions":[{"fix":{"range":[11008,11083],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":334,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":334,"endColumn":20,"suggestions":[{"fix":{"range":[11124,11194],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":349,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":349,"endColumn":20,"suggestions":[{"fix":{"range":[11685,11748],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":359,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":359,"endColumn":16,"suggestions":[{"fix":{"range":[12104,12160],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"security/detect-object-injection","severity":2,"message":"Generic Object Injection Sink","line":369,"column":24,"nodeType":"MemberExpression","endLine":369,"endColumn":55},{"ruleId":"security/detect-object-injection","severity":2,"message":"Generic Object Injection Sink","line":390,"column":23,"nodeType":"MemberExpression","endLine":390,"endColumn":54},{"ruleId":"security/detect-object-injection","severity":2,"message":"Generic Object Injection Sink","line":391,"column":27,"nodeType":"MemberExpression","endLine":391,"endColumn":58},{"ruleId":"security/detect-object-injection","severity":2,"message":"Generic Object Injection Sink","line":392,"column":25,"nodeType":"MemberExpression","endLine":392,"endColumn":62},{"ruleId":"security/detect-object-injection","severity":2,"message":"Generic Object Injection Sink","line":393,"column":29,"nodeType":"MemberExpression","endLine":393,"endColumn":66},{"ruleId":"security/detect-non-literal-fs-filename","severity":1,"message":"Found existsSync from package \"fs\" with non literal argument at index 0","line":438,"column":13,"nodeType":"CallExpression","endLine":438,"endColumn":35},{"ruleId":"security/detect-non-literal-fs-filename","severity":1,"message":"Found readdirSync from package \"fs\" with non literal argument at index 0","line":439,"column":27,"nodeType":"CallExpression","endLine":439,"endColumn":50},{"ruleId":"security/detect-non-literal-fs-filename","severity":1,"message":"Found statSync from package \"fs\" with non literal argument at index 0","line":440,"column":31,"nodeType":"CallExpression","endLine":440,"endColumn":68},{"ruleId":"no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":450,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":450,"endColumn":19},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":457,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":457,"endColumn":16,"suggestions":[{"fix":{"range":[15677,15693],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":458,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":458,"endColumn":16,"suggestions":[{"fix":{"range":[15699,15733],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":459,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":459,"endColumn":16,"suggestions":[{"fix":{"range":[15739,15771],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":460,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":460,"endColumn":16,"suggestions":[{"fix":{"range":[15777,15809],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":461,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":461,"endColumn":16,"suggestions":[{"fix":{"range":[15815,15863],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":462,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":462,"endColumn":16,"suggestions":[{"fix":{"range":[15869,15931],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":463,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":463,"endColumn":16,"suggestions":[{"fix":{"range":[15937,15953],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":464,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":464,"endColumn":16,"suggestions":[{"fix":{"range":[15959,15996],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":469,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":469,"endColumn":18,"suggestions":[{"fix":{"range":[16056,16100],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":474,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":474,"endColumn":18,"suggestions":[{"fix":{"range":[16208,16257],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":475,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":475,"endColumn":16,"suggestions":[{"fix":{"range":[16263,16312],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'promise' is defined but never used.","line":478,"column":43,"nodeType":"Identifier","messageId":"unusedVar","endLine":478,"endColumn":50,"suggestions":[{"messageId":"removeVar","data":{"varName":"promise"},"fix":{"range":[16361,16370],"text":""},"desc":"Remove unused variable 'promise'."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":479,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":479,"endColumn":18,"suggestions":[{"fix":{"range":[16382,16432],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":480,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":480,"endColumn":16,"suggestions":[{"fix":{"range":[16438,16487],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":485,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":485,"endColumn":16,"suggestions":[{"fix":{"range":[16567,16632],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":490,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":490,"endColumn":16,"suggestions":[{"fix":{"range":[16697,16761],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":16,"fatalErrorCount":0,"warningCount":49,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Servidor Ultra-Seguro - VersÃ£o Funcional\r\n * ProteÃ§Ã£o mÃ¡xima para Rafael Cannalonga\r\n */\r\n\r\nconst express = require('express');\r\nconst multer = require('multer');\r\nconst path = require('path');\r\nconst fs = require('fs');\r\nconst crypto = require('crypto');\r\nconst QRCode = require('qrcode'); // Biblioteca para QR codes PIX\r\nconst SecureAuthSystem = require('./secure-auth');\r\n\r\n// Inicializar sistema de autenticaÃ§Ã£o ultra-seguro\r\nconst secureAuth = new SecureAuthSystem();\r\n\r\n// Garantir diretÃ³rios essenciais\r\nconst ensureDirectories = () => {\r\n    const dirs = ['uploads/incoming', 'uploads/converted', 'uploads/processing', 'uploads/expired', 'logs'];\r\n    dirs.forEach(dir => {\r\n        if (!fs.existsSync(dir)) {\r\n            fs.mkdirSync(dir, { recursive: true });\r\n        }\r\n    });\r\n};\r\n\r\nensureDirectories();\r\n\r\nconst app = express();\r\nconst PORT = 3000;\r\n\r\nconsole.log('ðŸ›¡ï¸ Iniciando servidor ultra-seguro...');\r\nconsole.log('ðŸ” Sistema de autenticaÃ§Ã£o carregado');\r\n\r\n// Middlewares bÃ¡sicos\r\napp.use(express.json());\r\napp.use(express.static('public'));\r\napp.use('/admin', express.static('admin')); // Servir arquivos da pasta admin\r\n\r\nconsole.log('âœ… Middlewares configurados');\r\n\r\n// Upload simples\r\nconst upload = multer({ \r\n    dest: 'uploads/incoming/',\r\n    limits: { fileSize: 10 * 1024 * 1024 }\r\n});\r\n\r\nconsole.log('âœ… Upload configurado');\r\n\r\n// Dados financeiros\r\nconst financialData = {\r\n    conversionsCount: 0,\r\n    totalRevenue: 0,\r\n    transactions: [],\r\n    dailyStats: {},\r\n    monthlyStats: {}\r\n};\r\n\r\n// FunÃ§Ã£o para registrar conversÃ£o paga\r\nconst registerPaidConversion = (fileName, amount) => {\r\n    const transaction = {\r\n        id: crypto.randomBytes(16).toString('hex'),\r\n        fileName: fileName,\r\n        amount: amount,\r\n        date: new Date().toISOString(),\r\n        status: 'completed'\r\n    };\r\n    \r\n    // Adicionar Ã  lista de transaÃ§Ãµes\r\n    financialData.transactions.push(transaction);\r\n    financialData.conversionsCount++;\r\n    financialData.totalRevenue += amount;\r\n    \r\n    // EstatÃ­sticas diÃ¡rias\r\n    const today = new Date().toISOString().split('T')[0];\r\n    if (!financialData.dailyStats[today]) {\r\n        financialData.dailyStats[today] = { count: 0, revenue: 0 };\r\n    }\r\n    financialData.dailyStats[today].count++;\r\n    financialData.dailyStats[today].revenue += amount;\r\n    \r\n    // EstatÃ­sticas mensais\r\n    const monthKey = new Date().toISOString().slice(0, 7); // YYYY-MM\r\n    if (!financialData.monthlyStats[monthKey]) {\r\n        financialData.monthlyStats[monthKey] = { count: 0, revenue: 0 };\r\n    }\r\n    financialData.monthlyStats[monthKey].count++;\r\n    financialData.monthlyStats[monthKey].revenue += amount;\r\n    \r\n    console.log(`ðŸ’° ConversÃ£o registrada: ${fileName} - R$ ${amount}`);\r\n    return transaction;\r\n};\r\n\r\nconsole.log('âœ… Sistema financeiro configurado');\r\n\r\n// Rotas\r\napp.get('/api/health', (req, res) => {\r\n    console.log('ðŸ’š Health check requisitado');\r\n    res.json({ \r\n        status: 'ok', \r\n        timestamp: new Date().toISOString(),\r\n        message: 'Servidor funcionando!'\r\n    });\r\n});\r\n\r\napp.post('/api/upload', upload.single('file'), (req, res) => {\r\n    console.log('ðŸ“ Upload recebido:', req.file ? req.file.originalname : 'Nenhum arquivo');\r\n    console.log('ðŸ” Detalhes do request:', {\r\n        headers: req.headers['content-type'],\r\n        body: Object.keys(req.body || {}),\r\n        file: req.file ? 'SIM' : 'NÃƒO'\r\n    });\r\n    \r\n    if (!req.file) {\r\n        console.log('âŒ Nenhum arquivo no upload');\r\n        return res.status(400).json({\r\n            success: false,\r\n            error: 'Nenhum arquivo enviado'\r\n        });\r\n    }\r\n\r\n    // Gerar XML simples\r\n    const xmlContent = `<?xml version=\"1.0\"?>\r\n<Project>\r\n    <Title>ConversÃ£o de ${req.file.originalname}</Title>\r\n    <Date>${new Date().toISOString()}</Date>\r\n    <Status>Sucesso</Status>\r\n</Project>`;\r\n\r\n    // Salvar XML\r\n    const xmlPath = path.join('uploads', 'converted', req.file.filename + '.xml');\r\n    fs.writeFileSync(xmlPath, xmlContent);\r\n\r\n    // Registrar conversÃ£o paga (simula pagamento aprovado)\r\n    const transaction = registerPaidConversion(req.file.originalname, 10.00);\r\n\r\n    console.log('âœ… Arquivo convertido:', xmlPath);\r\n\r\n    res.json({\r\n        success: true,\r\n        message: 'Arquivo convertido!',\r\n        xml: xmlContent,\r\n        downloadUrl: '/api/download/' + req.file.filename + '.xml',\r\n        transaction: {\r\n            id: transaction.id,\r\n            amount: transaction.amount,\r\n            status: transaction.status\r\n        }\r\n    });\r\n});\r\n\r\napp.get('/api/download/:filename', (req, res) => {\r\n    console.log('â¬‡ï¸ Download solicitado:', req.params.filename);\r\n    \r\n    const filePath = path.join(__dirname, '../uploads/converted', req.params.filename);\r\n    \r\n    if (fs.existsSync(filePath)) {\r\n        res.download(filePath);\r\n    } else {\r\n        res.status(404).json({ error: 'Arquivo nÃ£o encontrado' });\r\n    }\r\n});\r\n\r\n// Admin dashboard route\r\napp.get('/admin', (req, res) => {\r\n    console.log('ðŸ”§ Admin dashboard acessado');\r\n    res.sendFile(path.join(__dirname, '..', 'admin', 'login.html'));\r\n});\r\n\r\n// Admin login page route\r\napp.get('/admin/login', (req, res) => {\r\n    console.log('ðŸ”‘ Admin login page acessada');\r\n    res.sendFile(path.join(__dirname, '..', 'admin', 'login.html'));\r\n});\r\n\r\n// Admin dashboard route (simples)\r\napp.get('/admin/dashboard', (req, res) => {\r\n    console.log('ðŸ“Š Admin dashboard acessado');\r\n    res.sendFile(path.join(__dirname, '..', 'admin', 'index.html'));\r\n});\r\n\r\n// Gerar QR Code PIX para pagamento\r\napp.post('/api/payment/pix', async (req, res) => {\r\n    try {\r\n        const { fileName, amount = 10.00 } = req.body;\r\n        \r\n        console.log('ðŸ’° Gerando QR Code PIX:', { fileName, amount });\r\n        \r\n        // Dados do PIX (use suas configuraÃ§Ãµes reais)\r\n        const pixKey = process.env.PIX_KEY || 'canna.vendasonline@gmail.com';\r\n        const merchantName = process.env.PIX_MERCHANT_NAME || 'Rafael Cannalonga';\r\n        const merchantCity = process.env.PIX_MERCHANT_CITY || 'SÃ£o Paulo';\r\n        \r\n        // Gerar cÃ³digo PIX (formato EMV)\r\n        const txId = crypto.randomUUID().substring(0, 25);\r\n        const pixCode = generatePixEMV({\r\n            pixKey,\r\n            merchantName,\r\n            merchantCity,\r\n            amount,\r\n            txId,\r\n            description: `ConversÃ£o MPP: ${fileName}`\r\n        });\r\n        \r\n        // Gerar QR Code como imagem base64\r\n        const qrCodeImage = await QRCode.toDataURL(pixCode, {\r\n            width: 300,\r\n            margin: 2,\r\n            color: {\r\n                dark: '#000000',\r\n                light: '#FFFFFF'\r\n            }\r\n        });\r\n        \r\n        res.json({\r\n            success: true,\r\n            qrCode: qrCodeImage,\r\n            pixCode: pixCode,\r\n            amount: amount,\r\n            pixKey: pixKey,\r\n            merchantName: merchantName,\r\n            expiresIn: '15 minutos'\r\n        });\r\n        \r\n    } catch (error) {\r\n        console.error('âŒ Erro ao gerar QR Code PIX:', error);\r\n        res.status(500).json({\r\n            success: false,\r\n            error: 'Erro ao gerar cÃ³digo PIX'\r\n        });\r\n    }\r\n});\r\n\r\n// FunÃ§Ã£o para gerar cÃ³digo PIX EMV\r\nfunction generatePixEMV(data) {\r\n    const { pixKey, merchantName, merchantCity, amount, txId, description } = data;\r\n    \r\n    // Formato EMV simplificado para PIX\r\n    let emv = '';\r\n    emv += '00020126'; // Payload Format Indicator\r\n    emv += '26' + (pixKey.length + 22).toString().padStart(2, '0'); // Point of Initiation Method\r\n    emv += '0014BR.GOV.BCB.PIX01'; // GUI\r\n    emv += pixKey.length.toString().padStart(2, '0') + pixKey; // PIX Key\r\n    emv += '5204000052039865'; // Merchant Category Code + Transaction Currency\r\n    emv += '54' + amount.toFixed(2).length.toString().padStart(2, '0') + amount.toFixed(2); // Transaction Amount\r\n    emv += '5802BR'; // Country Code\r\n    emv += '59' + merchantName.length.toString().padStart(2, '0') + merchantName; // Merchant Name\r\n    emv += '60' + merchantCity.length.toString().padStart(2, '0') + merchantCity; // Merchant City\r\n    \r\n    if (description && description.length > 0) {\r\n        emv += '62' + (description.length + 4).toString().padStart(2, '0');\r\n        emv += '05' + description.length.toString().padStart(2, '0') + description;\r\n    }\r\n    \r\n    // CRC16 (simplificado - em produÃ§Ã£o use implementaÃ§Ã£o completa)\r\n    emv += '6304';\r\n    const crc = calculateCRC16(emv);\r\n    emv += crc.toString(16).toUpperCase().padStart(4, '0');\r\n    \r\n    return emv;\r\n}\r\n\r\n// FunÃ§Ã£o simplificada de CRC16\r\nfunction calculateCRC16(data) {\r\n    let crc = 0xFFFF;\r\n    for (let i = 0; i < data.length; i++) {\r\n        crc ^= data.charCodeAt(i) << 8;\r\n        for (let j = 0; j < 8; j++) {\r\n            if ((crc & 0x8000) !== 0) {\r\n                crc = (crc << 1) ^ 0x1021;\r\n            } else {\r\n                crc = crc << 1;\r\n            }\r\n            crc &= 0xFFFF;\r\n        }\r\n    }\r\n    return crc;\r\n}\r\napp.post('/api/admin/login', (req, res) => {\r\n    const { username, password } = req.body;\r\n    const clientIP = req.ip || req.connection.remoteAddress || req.headers['x-forwarded-for'] || 'unknown';\r\n    \r\n    console.log(`[${new Date().toISOString()}] Tentativa de autenticaÃ§Ã£o:`, {\r\n        ip: clientIP,\r\n        userAgent: req.get('User-Agent')?.substring(0, 50) + '...',\r\n        username: username ? 'PRESENTE' : 'AUSENTE'\r\n    });\r\n    \r\n    // Usar sistema de autenticaÃ§Ã£o ultra-seguro\r\n    const authResult = secureAuth.authenticate(username, password, clientIP);\r\n    \r\n    if (authResult.success) {\r\n        console.log('âœ… RAFAEL CANNALONGA AUTENTICADO COM SUCESSO');\r\n        console.log('ðŸ” Token seguro gerado e ativado');\r\n        \r\n        res.json({\r\n            success: true,\r\n            token: authResult.token,\r\n            user: authResult.user,\r\n            message: authResult.message,\r\n            securityLevel: 'MAXIMUM'\r\n        });\r\n    } else {\r\n        console.log(`âŒ FALHA NA AUTENTICAÃ‡ÃƒO: ${authResult.reason}`);\r\n        console.log(`âš ï¸ IP registrado: ${clientIP}`);\r\n        \r\n        // Resposta padronizada para nÃ£o vazar informaÃ§Ãµes\r\n        res.status(401).json({\r\n            success: false,\r\n            message: authResult.message\r\n        });\r\n    }\r\n});\r\n\r\n// Middleware de autenticaÃ§Ã£o ultra-seguro\r\nconst authenticateAdmin = (req, res, next) => {\r\n    const authHeader = req.headers.authorization;\r\n    const clientIP = req.ip || req.connection.remoteAddress || req.headers['x-forwarded-for'] || 'unknown';\r\n    \r\n    if (!authHeader || !authHeader.startsWith('Bearer ')) {\r\n        console.log(`âš ï¸ Tentativa de acesso sem token do IP: ${clientIP}`);\r\n        return res.status(401).json({ \r\n            error: 'Token de acesso requerido',\r\n            securityAlert: 'UNAUTHORIZED_ACCESS_ATTEMPT'\r\n        });\r\n    }\r\n    \r\n    const token = authHeader.substring(7);\r\n    \r\n    if (secureAuth.verifyToken(token, clientIP)) {\r\n        console.log(`âœ… Acesso autorizado para IP: ${clientIP.substring(0, 8)}***`);\r\n        next();\r\n    } else {\r\n        console.log(`ðŸš¨ TENTATIVA DE ACESSO COM TOKEN INVÃLIDO: ${clientIP}`);\r\n        res.status(401).json({ \r\n            error: 'Token invÃ¡lido ou expirado',\r\n            securityAlert: 'INVALID_TOKEN_ATTEMPT'\r\n        });\r\n    }\r\n};\r\n\r\n// Endpoint de logout seguro\r\napp.post('/api/admin/logout', authenticateAdmin, (req, res) => {\r\n    const authHeader = req.headers.authorization;\r\n    const token = authHeader.substring(7);\r\n    const clientIP = req.ip || req.connection.remoteAddress || 'unknown';\r\n    \r\n    if (secureAuth.invalidateSession(token)) {\r\n        console.log(`ðŸšª Logout seguro executado para IP: ${clientIP}`);\r\n        res.json({ success: true, message: 'Logout realizado com sucesso' });\r\n    } else {\r\n        res.status(400).json({ success: false, message: 'Erro no logout' });\r\n    }\r\n});\r\n\r\n// Endpoint de estatÃ­sticas de seguranÃ§a\r\napp.get('/api/admin/security-stats', authenticateAdmin, (req, res) => {\r\n    const stats = secureAuth.getSecurityStats();\r\n    console.log('ðŸ“Š EstatÃ­sticas de seguranÃ§a consultadas');\r\n    \r\n    res.json({\r\n        ...stats,\r\n        timestamp: new Date().toISOString(),\r\n        owner: 'Rafael Cannalonga'\r\n    });\r\n});\r\napp.get('/api/stats/conversions-today', authenticateAdmin, (req, res) => {\r\n    const today = new Date().toISOString().split('T')[0];\r\n    const todayStats = financialData.dailyStats[today] || { count: 0 };\r\n    res.json({ count: todayStats.count });\r\n});\r\n\r\napp.get('/api/stats/total-files', authenticateAdmin, (req, res) => {\r\n    res.json({ count: financialData.conversionsCount });\r\n});\r\n\r\napp.get('/api/stats/disk-usage', authenticateAdmin, (req, res) => {\r\n    res.json({ usage: 15 });\r\n});\r\n\r\n// Novos endpoints financeiros\r\napp.get('/api/financial/summary', authenticateAdmin, (req, res) => {\r\n    const today = new Date().toISOString().split('T')[0];\r\n    const thisMonth = new Date().toISOString().substring(0, 7);\r\n    \r\n    res.json({\r\n        totalRevenue: financialData.totalRevenue,\r\n        totalConversions: financialData.conversionsCount,\r\n        pricePerConversion: financialData.pricePerConversion,\r\n        todayRevenue: financialData.dailyStats[today]?.revenue || 0,\r\n        todayConversions: financialData.dailyStats[today]?.count || 0,\r\n        monthlyRevenue: financialData.monthlyStats[thisMonth]?.revenue || 0,\r\n        monthlyConversions: financialData.monthlyStats[thisMonth]?.count || 0,\r\n        averageDaily: financialData.totalRevenue / Math.max(Object.keys(financialData.dailyStats).length, 1),\r\n        taxCalculation: {\r\n            grossRevenue: financialData.totalRevenue,\r\n            estimatedTax27_5: financialData.totalRevenue * 0.275,\r\n            estimatedTax22_5: financialData.totalRevenue * 0.225,\r\n            estimatedTax15: financialData.totalRevenue * 0.15\r\n        }\r\n    });\r\n});\r\n\r\napp.get('/api/financial/transactions', authenticateAdmin, (req, res) => {\r\n    const page = parseInt(req.query.page) || 1;\r\n    const limit = parseInt(req.query.limit) || 50;\r\n    const startIndex = (page - 1) * limit;\r\n    const endIndex = startIndex + limit;\r\n    \r\n    const sortedTransactions = financialData.transactions\r\n        .sort((a, b) => new Date(b.date) - new Date(a.date))\r\n        .slice(startIndex, endIndex);\r\n    \r\n    res.json({\r\n        transactions: sortedTransactions,\r\n        pagination: {\r\n            page: page,\r\n            limit: limit,\r\n            total: financialData.transactions.length,\r\n            totalPages: Math.ceil(financialData.transactions.length / limit)\r\n        }\r\n    });\r\n});\r\n\r\napp.get('/api/financial/monthly-report', authenticateAdmin, (req, res) => {\r\n    res.json({\r\n        monthlyStats: financialData.monthlyStats,\r\n        yearlyTotal: Object.values(financialData.monthlyStats)\r\n            .reduce((sum, month) => sum + month.revenue, 0)\r\n    });\r\n});\r\n\r\napp.get('/api/files/:directory', authenticateAdmin, (req, res) => {\r\n    const directory = req.params.directory;\r\n    const dirPath = path.join('uploads', directory);\r\n    \r\n    try {\r\n        if (fs.existsSync(dirPath)) {\r\n            const files = fs.readdirSync(dirPath).map(file => {\r\n                const stats = fs.statSync(path.join(dirPath, file));\r\n                return {\r\n                    name: file,\r\n                    size: stats.size\r\n                };\r\n            });\r\n            res.json({ files });\r\n        } else {\r\n            res.json({ files: [] });\r\n        }\r\n    } catch (error) {\r\n        res.json({ files: [] });\r\n    }\r\n});\r\n\r\n// Iniciar servidor\r\napp.listen(PORT, '0.0.0.0', () => {\r\n    console.log('');\r\n    console.log('ðŸš€ SERVIDOR ATIVO!');\r\n    console.log('================');\r\n    console.log(`âœ… Porta: ${PORT}`);\r\n    console.log(`ðŸŒ URL: http://localhost:${PORT}`);\r\n    console.log(`ðŸ’š Health: http://localhost:${PORT}/api/health`);\r\n    console.log('');\r\n    console.log('ðŸŽ¯ Pronto para teste!');\r\n});\r\n\r\n// Log de erros\r\napp.on('error', (error) => {\r\n    console.error('âŒ Erro no servidor:', error);\r\n});\r\n\r\n// Tratamento robusto de exceÃ§Ãµes para produÃ§Ã£o\r\nprocess.on('uncaughtException', (error) => {\r\n    console.error('âŒ ExceÃ§Ã£o nÃ£o capturada:', error);\r\n    console.log('ðŸ”„ Servidor continuarÃ¡ rodando...');\r\n});\r\n\r\nprocess.on('unhandledRejection', (reason, promise) => {\r\n    console.error('âŒ Rejection nÃ£o tratada:', reason);\r\n    console.log('ðŸ”„ Servidor continuarÃ¡ rodando...');\r\n});\r\n\r\n// Graceful shutdown para produÃ§Ã£o\r\nprocess.on('SIGTERM', () => {\r\n    console.log('ðŸ“´ Recebido SIGTERM, finalizando graciosamente...');\r\n    process.exit(0);\r\n});\r\n\r\nprocess.on('SIGINT', () => {\r\n    console.log('ðŸ“´ Recebido SIGINT, finalizando graciosamente...');\r\n    process.exit(0);\r\n});","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rafae\\Desktop\\PROJETOS DE ESTUDOS\\CONVERSOR MPP XML\\api\\server-simple.js","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":102,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":102,"endColumn":20,"suggestions":[{"fix":{"range":[2741,2916],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"security/detect-non-literal-fs-filename","severity":1,"message":"Found writeFileSync from package \"fs\" with non literal argument at index 0","line":113,"column":9,"nodeType":"CallExpression","endLine":113,"endColumn":56},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":126,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":126,"endColumn":22,"suggestions":[{"fix":{"range":[3727,3767],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"security/detect-non-literal-fs-filename","severity":1,"message":"Found existsSync from package \"fs\" with non literal argument at index 0","line":140,"column":14,"nodeType":"CallExpression","endLine":140,"endColumn":37},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":154,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":154,"endColumn":22,"suggestions":[{"fix":{"range":[4585,4627],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'next' is defined but never used.","line":229,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":229,"endColumn":31,"suggestions":[{"messageId":"removeVar","data":{"varName":"next"},"fix":{"range":[6916,6922],"text":""},"desc":"Remove unused variable 'next'."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":230,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":230,"endColumn":18,"suggestions":[{"fix":{"range":[6934,6974],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":249,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":249,"endColumn":16,"suggestions":[{"fix":{"range":[7437,7488],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":250,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":250,"endColumn":16,"suggestions":[{"fix":{"range":[7494,7546],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":251,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":251,"endColumn":16,"suggestions":[{"fix":{"range":[7552,7603],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":252,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":252,"endColumn":16,"suggestions":[{"fix":{"range":[7609,7660],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":253,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":253,"endColumn":16,"suggestions":[{"fix":{"range":[7666,7728],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":254,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":254,"endColumn":16,"suggestions":[{"fix":{"range":[7734,7750],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":255,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":255,"endColumn":16,"suggestions":[{"fix":{"range":[7756,7799],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":256,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":256,"endColumn":16,"suggestions":[{"fix":{"range":[7805,7856],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":257,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":257,"endColumn":16,"suggestions":[{"fix":{"range":[7862,7911],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":258,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":258,"endColumn":16,"suggestions":[{"fix":{"range":[7917,7966],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":259,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":259,"endColumn":16,"suggestions":[{"fix":{"range":[7972,7988],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":260,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":260,"endColumn":16,"suggestions":[{"fix":{"range":[7994,8035],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":261,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":261,"endColumn":16,"suggestions":[{"fix":{"range":[8041,8099],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":262,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":262,"endColumn":16,"suggestions":[{"fix":{"range":[8105,8167],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":263,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":263,"endColumn":16,"suggestions":[{"fix":{"range":[8173,8189],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":264,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":264,"endColumn":16,"suggestions":[{"fix":{"range":[8195,8252],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":265,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":265,"endColumn":16,"suggestions":[{"fix":{"range":[8258,8310],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":23,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Servidor Simplificado para Teste\r\n * Funciona sem Redis para validaÃ§Ã£o bÃ¡sica\r\n */\r\n\r\nconst express = require('express');\r\nconst multer = require('multer');\r\nconst path = require('path');\r\nconst fs = require('fs');\r\nconst helmet = require('helmet');\r\nconst rateLimit = require('express-rate-limit');\r\nconst cors = require('cors');\r\nconst { v4: uuidv4 } = require('uuid');\r\n\r\nconst app = express();\r\nconst PORT = process.env.PORT || 3000;\r\n\r\n// Middlewares de seguranÃ§a\r\napp.use(helmet({\r\n    contentSecurityPolicy: false,\r\n    crossOriginEmbedderPolicy: false\r\n}));\r\n\r\napp.use(cors({\r\n    origin: true,\r\n    credentials: true\r\n}));\r\n\r\napp.use(express.json());\r\napp.use(express.urlencoded({ extended: true }));\r\n\r\n// Rate limiting\r\nconst generalLimiter = rateLimit({\r\n    windowMs: 15 * 60 * 1000, // 15 minutos\r\n    max: 100, // 100 requests por IP\r\n    message: { error: 'Muitas tentativas. Tente novamente em 15 minutos.' }\r\n});\r\n\r\nconst uploadLimiter = rateLimit({\r\n    windowMs: 15 * 60 * 1000, // 15 minutos\r\n    max: 5, // 5 uploads por IP\r\n    message: { error: 'Limite de uploads excedido. Tente novamente em 15 minutos.' }\r\n});\r\n\r\napp.use(generalLimiter);\r\n\r\n// Servir arquivos estÃ¡ticos\r\napp.use(express.static('public'));\r\n\r\n// ConfiguraÃ§Ã£o do multer\r\nconst storage = multer.diskStorage({\r\n    destination: function (req, file, cb) {\r\n        const uploadPath = path.join(__dirname, '../uploads/incoming');\r\n        cb(null, uploadPath);\r\n    },\r\n    filename: function (req, file, cb) {\r\n        const uniqueId = uuidv4();\r\n        const fileExtension = path.extname(file.originalname);\r\n        cb(null, `${uniqueId}${fileExtension}`);\r\n    }\r\n});\r\n\r\nconst upload = multer({\r\n    storage: storage,\r\n    limits: {\r\n        fileSize: 10 * 1024 * 1024 // 10MB\r\n    },\r\n    fileFilter: (req, file, cb) => {\r\n        const allowedExtensions = ['.mpp', '.mpt'];\r\n        const fileExtension = path.extname(file.originalname).toLowerCase();\r\n        \r\n        if (allowedExtensions.includes(fileExtension)) {\r\n            cb(null, true);\r\n        } else {\r\n            cb(new Error('Apenas arquivos .mpp e .mpt sÃ£o permitidos'), false);\r\n        }\r\n    }\r\n});\r\n\r\n// Rotas\r\n\r\n// Health check\r\napp.get('/api/health', (req, res) => {\r\n    res.json({\r\n        status: 'ok',\r\n        timestamp: new Date().toISOString(),\r\n        version: '2.0.0-test',\r\n        mode: 'simplified-no-redis'\r\n    });\r\n});\r\n\r\n// Upload simplificado (sem queue)\r\napp.post('/api/upload', uploadLimiter, upload.single('file'), async (req, res) => {\r\n    try {\r\n        if (!req.file) {\r\n            return res.status(400).json({\r\n                success: false,\r\n                error: 'Nenhum arquivo foi enviado'\r\n            });\r\n        }\r\n\r\n        console.log('ðŸ“ Arquivo recebido:', {\r\n            originalName: req.file.originalname,\r\n            fileName: req.file.filename,\r\n            size: req.file.size\r\n        });\r\n\r\n        // Simular conversÃ£o (sem processamento real para teste)\r\n        const mockXmlContent = generateMockXML(req.file.originalname);\r\n        \r\n        // Salvar XML mockado\r\n        const convertedPath = path.join(__dirname, '../uploads/converted', req.file.filename.replace(path.extname(req.file.filename), '.xml'));\r\n        fs.writeFileSync(convertedPath, mockXmlContent);\r\n\r\n        // Responder com sucesso\r\n        res.json({\r\n            success: true,\r\n            message: 'Arquivo convertido com sucesso!',\r\n            originalName: req.file.originalname,\r\n            fileName: req.file.filename,\r\n            downloadUrl: `/api/download/${req.file.filename.replace(path.extname(req.file.filename), '.xml')}`,\r\n            size: req.file.size\r\n        });\r\n\r\n    } catch (error) {\r\n        console.error('Erro no upload:', error);\r\n        res.status(500).json({\r\n            success: false,\r\n            error: 'Erro interno do servidor'\r\n        });\r\n    }\r\n});\r\n\r\n// Download simplificado\r\napp.get('/api/download/:filename', (req, res) => {\r\n    try {\r\n        const filename = req.params.filename;\r\n        const filePath = path.join(__dirname, '../uploads/converted', filename);\r\n\r\n        if (!fs.existsSync(filePath)) {\r\n            return res.status(404).json({\r\n                error: 'Arquivo nÃ£o encontrado'\r\n            });\r\n        }\r\n\r\n        const originalName = filename.replace('.xml', '.xml');\r\n        \r\n        res.setHeader('Content-Disposition', `attachment; filename=\"${originalName}\"`);\r\n        res.setHeader('Content-Type', 'application/xml');\r\n        \r\n        res.sendFile(filePath);\r\n\r\n    } catch (error) {\r\n        console.error('Erro no download:', error);\r\n        res.status(500).json({\r\n            error: 'Erro interno do servidor'\r\n        });\r\n    }\r\n});\r\n\r\n// FunÃ§Ã£o para gerar XML mockado para teste\r\nfunction generateMockXML(originalFilename) {\r\n    const now = new Date().toISOString();\r\n    return `<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\r\n<Project xmlns=\"http://schemas.microsoft.com/project\">\r\n    <Title>Projeto Convertido de ${originalFilename}</Title>\r\n    <CreationDate>${now}</CreationDate>\r\n    <LastSaved>${now}</LastSaved>\r\n    <Company>Conversor MPP XML</Company>\r\n    <Manager>Sistema AutomÃ¡tico</Manager>\r\n    \r\n    <Tasks>\r\n        <Task>\r\n            <UID>1</UID>\r\n            <ID>1</ID>\r\n            <Name>Tarefa de Exemplo 1</Name>\r\n            <Type>1</Type>\r\n            <IsNull>0</IsNull>\r\n            <CreateDate>${now}</CreateDate>\r\n            <Start>2024-01-01T08:00:00</Start>\r\n            <Finish>2024-01-05T17:00:00</Finish>\r\n            <Duration>PT32H0M0S</Duration>\r\n            <Work>PT32H0M0S</Work>\r\n            <Priority>500</Priority>\r\n        </Task>\r\n        \r\n        <Task>\r\n            <UID>2</UID>\r\n            <ID>2</ID>\r\n            <Name>Tarefa de Exemplo 2</Name>\r\n            <Type>1</Type>\r\n            <IsNull>0</IsNull>\r\n            <CreateDate>${now}</CreateDate>\r\n            <Start>2024-01-06T08:00:00</Start>\r\n            <Finish>2024-01-10T17:00:00</Finish>\r\n            <Duration>PT32H0M0S</Duration>\r\n            <Work>PT32H0M0S</Work>\r\n            <Priority>500</Priority>\r\n        </Task>\r\n    </Tasks>\r\n    \r\n    <Resources>\r\n        <Resource>\r\n            <UID>1</UID>\r\n            <ID>1</ID>\r\n            <Name>Recurso de Exemplo</Name>\r\n            <Type>1</Type>\r\n            <IsNull>0</IsNull>\r\n            <Initials>RE</Initials>\r\n            <StandardRate>50</StandardRate>\r\n            <OvertimeRate>75</OvertimeRate>\r\n        </Resource>\r\n    </Resources>\r\n    \r\n    <Assignments>\r\n        <Assignment>\r\n            <UID>1</UID>\r\n            <TaskUID>1</TaskUID>\r\n            <ResourceUID>1</ResourceUID>\r\n            <Work>PT16H0M0S</Work>\r\n            <Start>2024-01-01T08:00:00</Start>\r\n            <Finish>2024-01-03T17:00:00</Finish>\r\n        </Assignment>\r\n    </Assignments>\r\n</Project>`;\r\n}\r\n\r\n// Middleware de erro\r\napp.use((error, req, res, next) => {\r\n    console.error('Erro capturado:', error);\r\n    \r\n    if (error instanceof multer.MulterError) {\r\n        if (error.code === 'LIMIT_FILE_SIZE') {\r\n            return res.status(400).json({\r\n                success: false,\r\n                error: 'Arquivo muito grande. MÃ¡ximo: 10MB'\r\n            });\r\n        }\r\n    }\r\n    \r\n    res.status(500).json({\r\n        success: false,\r\n        error: error.message || 'Erro interno do servidor'\r\n    });\r\n});\r\n\r\n// Iniciar servidor\r\napp.listen(PORT, () => {\r\n    console.log('ðŸš€ CONVERSOR MPP â†’ XML - MODO TESTE');\r\n    console.log('====================================');\r\n    console.log(`âœ… Servidor rodando na porta ${PORT}`);\r\n    console.log(`ðŸŒ Acesse: http://localhost:${PORT}`);\r\n    console.log(`ðŸ” Health: http://localhost:${PORT}/api/health`);\r\n    console.log('');\r\n    console.log('ðŸ”§ MODO SIMPLIFICADO ATIVO:');\r\n    console.log('   - Sem Redis (queue desabilitado)');\r\n    console.log('   - ConversÃ£o mockada para teste');\r\n    console.log('   - Upload e download funcionais');\r\n    console.log('');\r\n    console.log('ðŸ“ Estrutura de arquivos:');\r\n    console.log('   - uploads/incoming/ (arquivos enviados)');\r\n    console.log('   - uploads/converted/ (arquivos convertidos)');\r\n    console.log('');\r\n    console.log('ðŸŽ¯ Para produÃ§Ã£o complete: instalar Redis');\r\n    console.log('====================================');\r\n});\r\n\r\nmodule.exports = app;","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rafae\\Desktop\\PROJETOS DE ESTUDOS\\CONVERSOR MPP XML\\api\\server.js","messages":[{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":71,"column":13,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":71,"endColumn":14,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2233,2234],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2233,2233],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":80,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":80,"endColumn":20,"suggestions":[{"fix":{"range":[2557,2767],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":110,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":110,"endColumn":24,"suggestions":[{"fix":{"range":[3601,3738],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":112,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":112,"endColumn":26,"suggestions":[{"fix":{"range":[3779,3834],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"security/detect-non-literal-fs-filename","severity":1,"message":"Found writeFile from package \"fs\" with non literal argument at index 0","line":264,"column":15,"nodeType":"CallExpression","endLine":264,"endColumn":59},{"ruleId":"no-unused-vars","severity":2,"message":"'conversionId' is defined but never used.","line":416,"column":28,"nodeType":"Identifier","messageId":"unusedVar","endLine":416,"endColumn":40,"suggestions":[{"messageId":"removeVar","data":{"varName":"conversionId"},"fix":{"range":[14285,14298],"text":""},"desc":"Remove unused variable 'conversionId'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'ip' is defined but never used.","line":416,"column":42,"nodeType":"Identifier","messageId":"unusedVar","endLine":416,"endColumn":44,"suggestions":[{"messageId":"removeVar","data":{"varName":"ip"},"fix":{"range":[14297,14301],"text":""},"desc":"Remove unused variable 'ip'."}]},{"ruleId":"security/detect-non-literal-fs-filename","severity":1,"message":"Found unlink from package \"fs\" with non literal argument at index 0","line":509,"column":23,"nodeType":"CallExpression","endLine":509,"endColumn":47},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":511,"column":17,"nodeType":"MemberExpression","messageId":"unexpected","endLine":511,"endColumn":30,"suggestions":[{"fix":{"range":[17924,17988],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":554,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":554,"endColumn":26,"suggestions":[{"fix":{"range":[19576,19627],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"security/detect-non-literal-fs-filename","severity":1,"message":"Found unlink from package \"fs\" with non literal argument at index 0","line":558,"column":23,"nodeType":"CallExpression","endLine":558,"endColumn":47},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":571,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":571,"endColumn":22,"suggestions":[{"fix":{"range":[20093,20143],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":574,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":574,"endColumn":20,"suggestions":[{"fix":{"range":[20211,20429],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'generateSampleXML' is defined but never used.","line":590,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":590,"endColumn":27,"suggestions":[{"messageId":"removeVar","data":{"varName":"generateSampleXML"},"fix":{"range":[20652,22172],"text":""},"desc":"Remove unused variable 'generateSampleXML'."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":655,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":655,"endColumn":22,"suggestions":[{"fix":{"range":[22862,22902],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":691,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":691,"endColumn":22,"suggestions":[{"fix":{"range":[24123,24170],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":729,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":729,"endColumn":22,"suggestions":[{"fix":{"range":[25553,25616],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'txid' is assigned a value but never used.","line":737,"column":36,"nodeType":"Identifier","messageId":"unusedVar","endLine":737,"endColumn":40,"suggestions":[{"messageId":"removeVar","data":{"varName":"txid"},"fix":{"range":[25858,25864],"text":""},"desc":"Remove unused variable 'txid'."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":756,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":756,"endColumn":22,"suggestions":[{"fix":{"range":[26482,26523],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":793,"column":17,"nodeType":"MemberExpression","messageId":"unexpected","endLine":793,"endColumn":30,"suggestions":[{"fix":{"range":[27915,27955],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":799,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":799,"endColumn":22,"suggestions":[{"fix":{"range":[28102,28144],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":822,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":822,"endColumn":22,"suggestions":[{"fix":{"range":[28852,28911],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":833,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":833,"endColumn":22,"suggestions":[{"fix":{"range":[29235,29284],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":851,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":851,"endColumn":22,"suggestions":[{"fix":{"range":[29937,29985],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'next' is defined but never used.","line":862,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":862,"endColumn":31,"suggestions":[{"messageId":"removeVar","data":{"varName":"next"},"fix":{"range":[30270,30276],"text":""},"desc":"Remove unused variable 'next'."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":863,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":863,"endColumn":18,"suggestions":[{"fix":{"range":[30288,30318],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"security/detect-non-literal-fs-filename","severity":1,"message":"Found unlink from package \"fs\" with non literal argument at index 0","line":884,"column":27,"nodeType":"CallExpression","endLine":884,"endColumn":57},{"ruleId":"security/detect-non-literal-fs-filename","severity":1,"message":"Found unlink from package \"fs\" with non literal argument at index 0","line":886,"column":31,"nodeType":"CallExpression","endLine":886,"endColumn":63},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":889,"column":21,"nodeType":"MemberExpression","messageId":"unexpected","endLine":889,"endColumn":34,"suggestions":[{"fix":{"range":[31235,31280],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":903,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":903,"endColumn":20,"suggestions":[{"fix":{"range":[31657,31710],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":905,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":905,"endColumn":22,"suggestions":[{"fix":{"range":[31743,31784],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":921,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":921,"endColumn":22,"suggestions":[{"fix":{"range":[32186,32241],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":957,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":957,"endColumn":20,"suggestions":[{"fix":{"range":[33253,33342],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":968,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":968,"endColumn":22,"suggestions":[{"fix":{"range":[33722,33766],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":982,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":982,"endColumn":22,"suggestions":[{"fix":{"range":[34122,34176],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":991,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":991,"endColumn":16,"suggestions":[{"fix":{"range":[34348,34397],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":992,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":992,"endColumn":16,"suggestions":[{"fix":{"range":[34403,34451],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":993,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":993,"endColumn":16,"suggestions":[{"fix":{"range":[34457,34518],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":32,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const express = require('express');\r\nconst multer = require('multer');\r\nconst path = require('path');\r\nconst fs = require('fs').promises;\r\nconst crypto = require('crypto');\r\nconst cors = require('cors');\r\nconst helmet = require('helmet');\r\nconst compression = require('compression');\r\nconst rateLimit = require('express-rate-limit');\r\nrequire('dotenv').config();\r\n\r\nconst uploadUtils = require('./upload-utils');\r\nconst downloadToken = require('../utils/downloadToken');\r\nconst fileQueue = require('../queue/queue');\r\n\r\nconst app = express();\r\nconst PORT = process.env.PORT || 3000;\r\n\r\n// ðŸ›¡ï¸ SECURITY HARDENING - ConfiguraÃ§Ã£o direta\r\napp.use(helmet({\r\n    contentSecurityPolicy: {\r\n        directives: {\r\n            defaultSrc: [\"'self'\"],\r\n            scriptSrc: [\"'self'\", \"'unsafe-inline'\", \"'unsafe-hashes'\"],\r\n            scriptSrcAttr: [\"'self'\", \"'unsafe-inline'\"],\r\n            styleSrc: [\"'self'\", \"'unsafe-inline'\", \"https://fonts.googleapis.com\"],\r\n            fontSrc: [\"'self'\", \"https://fonts.gstatic.com\"],\r\n            imgSrc: [\"'self'\", \"data:\", \"https:\"],\r\n            connectSrc: [\"'self'\"],\r\n        },\r\n    },\r\n}));\r\napp.use(cors());\r\n\r\n// Enable compression\r\napp.use(require('compression')());\r\n\r\napp.use(express.json());\r\napp.use(express.static(path.join(__dirname, '../public')));\r\napp.use(compression());\r\n\r\n// ðŸ›¡ï¸ RATE LIMITING - ProteÃ§Ã£o contra ataques\r\nconst apiLimiter = rateLimit({\r\n    windowMs: 15 * 60 * 1000, // 15 minutos\r\n    max: 100, // mÃ¡ximo 100 requests por IP por janela\r\n    message: {\r\n        error: 'Muitas tentativas. Tente novamente em 15 minutos.',\r\n        retryAfter: '15 minutos'\r\n    },\r\n    standardHeaders: true,\r\n    legacyHeaders: false\r\n});\r\n\r\nconst uploadLimiter = rateLimit({\r\n    windowMs: 60 * 1000, // 1 minuto\r\n    max: 5, // mÃ¡ximo 5 uploads por minuto por IP\r\n    message: {\r\n        error: 'Muitos uploads. Aguarde 1 minuto.',\r\n        retryAfter: '1 minuto'\r\n    }\r\n});\r\n\r\napp.use('/api', apiLimiter);\r\napp.use('/api/upload-test', uploadLimiter);\r\n\r\n// ðŸ”’ MIDDLEWARE DE MONITORAMENTO DE SEGURANÃ‡A\r\napp.use((req, res, next) => {\r\n    // Log de requests suspeitos\r\n    const suspiciousPatterns = [\r\n        /\\.\\./,                    // Path traversal\r\n        /[<>\\\"']/,                 // XSS attempts  \r\n        /union.*select/i,          // SQL injection\r\n        /(script|javascript|vbscript)/i // Script injection\r\n    ];\r\n    \r\n    const fullUrl = req.url;\r\n    const isSuspicious = suspiciousPatterns.some(pattern => pattern.test(fullUrl));\r\n    \r\n    if (isSuspicious) {\r\n        console.log('âš ï¸ Tentativa suspeita detectada:', {\r\n            ip: req.ip,\r\n            url: fullUrl,\r\n            userAgent: req.get('User-Agent'),\r\n            timestamp: new Date().toISOString()\r\n        });\r\n        \r\n        return res.status(400).json({\r\n            error: 'Request invÃ¡lido',\r\n            code: 'SUSPICIOUS_ACTIVITY'\r\n        });\r\n    }\r\n    \r\n    next();\r\n});\r\n\r\n// Middleware para rastrear visualizaÃ§Ãµes de pÃ¡gina\r\napp.use((req, res, next) => {\r\n    // Rastrear apenas pÃ¡ginas principais, nÃ£o recursos estÃ¡ticos\r\n    const isPageView = !req.path.startsWith('/api') && \r\n                      !req.path.startsWith('/css') && \r\n                      !req.path.startsWith('/js') && \r\n                      !req.path.includes('favicon') &&\r\n                      !req.path.includes('.png') &&\r\n                      !req.path.includes('.jpg') &&\r\n                      !req.path.includes('.ico');\r\n    \r\n    if (isPageView) {\r\n        try {\r\n            const analytics = AnalyticsManager.trackPageView(req);\r\n            console.log(`ðŸ“Š PÃ¡gina visitada: ${req.path} | IP: ${AnalyticsManager.getClientIP(req)} | Total: ${analytics.totalViews} visualizaÃ§Ãµes`);\r\n        } catch (error) {\r\n            console.error('Erro no tracking de analytics:', error);\r\n        }\r\n    }\r\n    next();\r\n});\r\n\r\n// ðŸ›¡ï¸ CONFIGURAÃ‡ÃƒO SEGURA DE UPLOAD\r\nconst storage = multer.diskStorage({\r\n    destination: async (req, file, cb) => {\r\n        const uploadDir = 'uploads/incoming';\r\n        const success = await uploadUtils.ensureDirectory(uploadDir);\r\n        if (success) {\r\n            cb(null, uploadDir);\r\n        } else {\r\n            cb(new Error('Erro ao preparar diretÃ³rio de upload'));\r\n        }\r\n    },\r\n    filename: (req, file, cb) => {\r\n        try {\r\n            // Gera nome seguro com UUID\r\n            const safeFilename = uploadUtils.generateSafeFilename(file.originalname);\r\n            cb(null, safeFilename);\r\n        } catch (error) {\r\n            cb(error);\r\n        }\r\n    }\r\n});\r\n\r\nconst upload = multer({\r\n    storage: storage,\r\n    limits: {\r\n        fileSize: uploadUtils.MAX_FILE_SIZE,\r\n        files: 1, // Apenas um arquivo por vez\r\n        fieldNameSize: 100,\r\n        fieldSize: 1024\r\n    },\r\n    fileFilter: (req, file, cb) => {\r\n        // ValidaÃ§Ã£o completa usando utilitÃ¡rios seguros\r\n        const validation = uploadUtils.validateUpload(file);\r\n        \r\n        if (validation.valid) {\r\n            cb(null, true);\r\n        } else {\r\n            const errorMsg = validation.errors.join(', ');\r\n            cb(new Error(errorMsg));\r\n        }\r\n    }\r\n});\r\n\r\n// Banco de dados em memÃ³ria (em produÃ§Ã£o, use um banco real)\r\nconst database = {\r\n    conversions: new Map(),\r\n    payments: new Map(),\r\n    analytics: {\r\n        pageViews: 0,\r\n        uniqueVisitors: new Set(),\r\n        dailyStats: new Map(),\r\n        hourlyStats: new Map(),\r\n        visitors: new Map(), // IP -> dados do visitante\r\n        sessions: new Map()  // sessionId -> dados da sessÃ£o\r\n    }\r\n};\r\n\r\n// Classes para gerenciar conversÃµes e pagamentos\r\nclass ConversionManager {\r\n    static async createConversion(fileInfo) {\r\n        const conversionId = crypto.randomUUID();\r\n        const conversion = {\r\n            id: conversionId,\r\n            fileName: fileInfo.originalname,\r\n            filePath: fileInfo.path,\r\n            status: 'uploaded', // uploaded, processing, completed, failed\r\n            createdAt: new Date(),\r\n            updatedAt: new Date(),\r\n            downloadCount: 0\r\n        };\r\n        \r\n        database.conversions.set(conversionId, conversion);\r\n        return conversion;\r\n    }\r\n    \r\n    static async getConversion(conversionId) {\r\n        return database.conversions.get(conversionId);\r\n    }\r\n    \r\n    static async updateConversionStatus(conversionId, status, outputPath = null) {\r\n        const conversion = database.conversions.get(conversionId);\r\n        if (conversion) {\r\n            conversion.status = status;\r\n            conversion.updatedAt = new Date();\r\n            if (outputPath) {\r\n                conversion.outputPath = outputPath;\r\n            }\r\n            return conversion;\r\n        }\r\n        return null;\r\n    }\r\n    \r\n    static async processConversion(conversionId) {\r\n        const conversion = await this.getConversion(conversionId);\r\n        if (!conversion) {\r\n            throw new Error('ConversÃ£o nÃ£o encontrada');\r\n        }\r\n        \r\n        await this.updateConversionStatus(conversionId, 'processing');\r\n        \r\n        try {\r\n            // Simular conversÃ£o (substitua pela implementaÃ§Ã£o real)\r\n            const outputPath = await this.convertMppToXml(conversion.filePath);\r\n            await this.updateConversionStatus(conversionId, 'completed', outputPath);\r\n            return conversion;\r\n        } catch (error) {\r\n            await this.updateConversionStatus(conversionId, 'failed');\r\n            throw error;\r\n        }\r\n    }\r\n    \r\n    static async convertMppToXml(inputPath) {\r\n        // ImplementaÃ§Ã£o simulada da conversÃ£o\r\n        // Em produÃ§Ã£o, use uma biblioteca apropriada como node-mpp ou similar\r\n        \r\n        const outputPath = inputPath.replace('.mpp', '.xml');\r\n        \r\n        // Simular processamento (remova isto em produÃ§Ã£o)\r\n        await new Promise(resolve => setTimeout(resolve, 2000));\r\n        \r\n        // XML bÃ¡sico de exemplo (substitua pela conversÃ£o real)\r\n        const xmlContent = `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<Project>\r\n    <Name>Projeto Convertido</Name>\r\n    <CreatedFrom>Microsoft Project (.mpp)</CreatedFrom>\r\n    <ConversionDate>${new Date().toISOString()}</ConversionDate>\r\n    <Tasks>\r\n        <!-- As tarefas serÃ£o extraÃ­das do arquivo .mpp -->\r\n        <Task>\r\n            <ID>1</ID>\r\n            <Name>Tarefa de Exemplo</Name>\r\n            <Start>2025-01-01</Start>\r\n            <Finish>2025-01-05</Finish>\r\n            <Duration>5 days</Duration>\r\n        </Task>\r\n    </Tasks>\r\n    <Resources>\r\n        <!-- Os recursos serÃ£o extraÃ­dos do arquivo .mpp -->\r\n        <Resource>\r\n            <ID>1</ID>\r\n            <Name>Recurso de Exemplo</Name>\r\n            <Type>Work</Type>\r\n        </Resource>\r\n    </Resources>\r\n</Project>`;\r\n        \r\n        await fs.writeFile(outputPath, xmlContent, 'utf8');\r\n        return outputPath;\r\n    }\r\n}\r\n\r\nclass PaymentManager {\r\n    static async createPayment(conversionId, amount) {\r\n        const paymentId = crypto.randomUUID();\r\n        const payment = {\r\n            id: paymentId,\r\n            conversionId,\r\n            amount,\r\n            status: 'pending', // pending, paid, expired, failed\r\n            pixKey: process.env.PIX_KEY || '02038351740',\r\n            bankName: 'Nubank',\r\n            qrCode: null,\r\n            createdAt: new Date(),\r\n            expiresAt: new Date(Date.now() + 15 * 60 * 1000), // 15 minutos\r\n        };\r\n        \r\n        database.payments.set(paymentId, payment);\r\n        return payment;\r\n    }\r\n    \r\n    static async getPaymentByConversion(conversionId) {\r\n        for (const payment of database.payments.values()) {\r\n            if (payment.conversionId === conversionId) {\r\n                return payment;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n    \r\n    static async updatePaymentStatus(paymentId, status) {\r\n        const payment = database.payments.get(paymentId);\r\n        if (payment) {\r\n            payment.status = status;\r\n            payment.updatedAt = new Date();\r\n            return payment;\r\n        }\r\n        return null;\r\n    }\r\n    \r\n    static async generateQRCode(paymentId) {\r\n        const payment = database.payments.get(paymentId);\r\n        if (!payment) {\r\n            throw new Error('Pagamento nÃ£o encontrado');\r\n        }\r\n        \r\n        // ImplementaÃ§Ã£o simulada do QR Code PIX\r\n        // Em produÃ§Ã£o, use uma biblioteca apropriada ou API do seu banco\r\n        const pixData = {\r\n            pixKey: payment.pixKey,\r\n            amount: payment.amount,\r\n            description: `ConversÃ£o MPP para XML - ${payment.conversionId}`,\r\n            merchantName: 'MPP Converter',\r\n            merchantCity: 'SÃ£o Paulo',\r\n            txid: payment.id.substring(0, 25)\r\n        };\r\n        \r\n        // Gerar string do PIX (EMV) - implementaÃ§Ã£o simplificada\r\n        const pixString = this.generatePixString(pixData);\r\n        \r\n        // Gerar QR Code em base64 (implementaÃ§Ã£o simulada)\r\n        const qrCodeBase64 = await this.generateQRCodeImage(pixString);\r\n        \r\n        payment.qrCode = qrCodeBase64;\r\n        payment.pixString = pixString;\r\n        \r\n        return payment;\r\n    }\r\n    \r\n    static generatePixString(data) {\r\n        // ImplementaÃ§Ã£o simplificada do formato EMV do PIX\r\n        // Em produÃ§Ã£o, use uma biblioteca apropriada\r\n        return `00020126330014BR.GOV.BCB.PIX0111${data.pixKey}520400005303986540${data.amount.toFixed(2)}5802BR5913${data.merchantName}6009${data.merchantCity}62070503***6304`;\r\n    }\r\n    \r\n    static async generateQRCodeImage(text) {\r\n        // ImplementaÃ§Ã£o simulada\r\n        // Em produÃ§Ã£o, use uma biblioteca como 'qrcode' para gerar a imagem\r\n        const QRCode = require('qrcode');\r\n        return await QRCode.toDataURL(text);\r\n    }\r\n}\r\n\r\n// Classe para gerenciar analytics e contadores\r\nclass AnalyticsManager {\r\n    static trackPageView(req) {\r\n        const ip = this.getClientIP(req);\r\n        const userAgent = req.get('User-Agent') || 'Unknown';\r\n        const referer = req.get('Referer') || 'Direct';\r\n        const timestamp = new Date();\r\n        const today = timestamp.toISOString().split('T')[0];\r\n        const hour = timestamp.getHours();\r\n        \r\n        // Incrementar contador geral\r\n        database.analytics.pageViews++;\r\n        \r\n        // Rastrear visitante Ãºnico\r\n        database.analytics.uniqueVisitors.add(ip);\r\n        \r\n        // EstatÃ­sticas diÃ¡rias\r\n        if (!database.analytics.dailyStats.has(today)) {\r\n            database.analytics.dailyStats.set(today, {\r\n                date: today,\r\n                views: 0,\r\n                uniqueVisitors: new Set(),\r\n                conversions: 0,\r\n                revenue: 0\r\n            });\r\n        }\r\n        database.analytics.dailyStats.get(today).views++;\r\n        database.analytics.dailyStats.get(today).uniqueVisitors.add(ip);\r\n        \r\n        // EstatÃ­sticas horÃ¡rias\r\n        const hourKey = `${today}-${hour.toString().padStart(2, '0')}`;\r\n        if (!database.analytics.hourlyStats.has(hourKey)) {\r\n            database.analytics.hourlyStats.set(hourKey, {\r\n                datetime: hourKey,\r\n                views: 0,\r\n                uniqueVisitors: new Set()\r\n            });\r\n        }\r\n        database.analytics.hourlyStats.get(hourKey).views++;\r\n        database.analytics.hourlyStats.get(hourKey).uniqueVisitors.add(ip);\r\n        \r\n        // Dados do visitante\r\n        if (!database.analytics.visitors.has(ip)) {\r\n            database.analytics.visitors.set(ip, {\r\n                ip,\r\n                firstVisit: timestamp,\r\n                lastVisit: timestamp,\r\n                visits: 0,\r\n                userAgent,\r\n                country: 'BR', // Em produÃ§Ã£o, use serviÃ§o de geolocalizaÃ§Ã£o\r\n                city: 'Desconhecida'\r\n            });\r\n        }\r\n        const visitor = database.analytics.visitors.get(ip);\r\n        visitor.lastVisit = timestamp;\r\n        visitor.visits++;\r\n        visitor.lastReferer = referer;\r\n        \r\n        return {\r\n            totalViews: database.analytics.pageViews,\r\n            uniqueVisitors: database.analytics.uniqueVisitors.size,\r\n            todayViews: database.analytics.dailyStats.get(today)?.views || 0,\r\n            visitor: visitor\r\n        };\r\n    }\r\n    \r\n    static trackConversion(conversionId, ip) {\r\n        const today = new Date().toISOString().split('T')[0];\r\n        const dailyStat = database.analytics.dailyStats.get(today);\r\n        if (dailyStat) {\r\n            dailyStat.conversions++;\r\n            dailyStat.revenue += 10.00;\r\n        }\r\n    }\r\n    \r\n    static getClientIP(req) {\r\n        return req.headers['x-forwarded-for'] || \r\n               req.headers['x-real-ip'] || \r\n               req.connection.remoteAddress || \r\n               req.socket.remoteAddress ||\r\n               (req.connection.socket ? req.connection.socket.remoteAddress : null) ||\r\n               '127.0.0.1';\r\n    }\r\n    \r\n    static getDashboardStats() {\r\n        const today = new Date().toISOString().split('T')[0];\r\n        const todayStats = database.analytics.dailyStats.get(today);\r\n        \r\n        // Ãšltimos 7 dias\r\n        const last7Days = [];\r\n        for (let i = 6; i >= 0; i--) {\r\n            const date = new Date();\r\n            date.setDate(date.getDate() - i);\r\n            const dateStr = date.toISOString().split('T')[0];\r\n            const dayStats = database.analytics.dailyStats.get(dateStr);\r\n            last7Days.push({\r\n                date: dateStr,\r\n                views: dayStats?.views || 0,\r\n                uniqueVisitors: dayStats?.uniqueVisitors.size || 0,\r\n                conversions: dayStats?.conversions || 0,\r\n                revenue: dayStats?.revenue || 0\r\n            });\r\n        }\r\n        \r\n        // Top visitantes\r\n        const topVisitors = Array.from(database.analytics.visitors.values())\r\n            .sort((a, b) => b.visits - a.visits)\r\n            .slice(0, 10)\r\n            .map(v => ({\r\n                ip: v.ip.replace(/(\\d+\\.\\d+)\\.\\d+\\.\\d+/, '$1.*.***'), // Anonimizar IP\r\n                visits: v.visits,\r\n                firstVisit: v.firstVisit,\r\n                lastVisit: v.lastVisit,\r\n                country: v.country\r\n            }));\r\n        \r\n        return {\r\n            overview: {\r\n                totalViews: database.analytics.pageViews,\r\n                uniqueVisitors: database.analytics.uniqueVisitors.size,\r\n                todayViews: todayStats?.views || 0,\r\n                todayUniqueVisitors: todayStats?.uniqueVisitors.size || 0,\r\n                conversionRate: database.analytics.pageViews > 0 ? \r\n                    ((database.conversions.size / database.analytics.pageViews) * 100).toFixed(2) + '%' : '0%'\r\n            },\r\n            last7Days,\r\n            topVisitors,\r\n            recentVisitors: Array.from(database.analytics.visitors.values())\r\n                .sort((a, b) => new Date(b.lastVisit) - new Date(a.lastVisit))\r\n                .slice(0, 20)\r\n                .map(v => ({\r\n                    ip: v.ip.replace(/(\\d+\\.\\d+)\\.\\d+\\.\\d+/, '$1.*.***'),\r\n                    lastVisit: v.lastVisit,\r\n                    visits: v.visits,\r\n                    country: v.country\r\n                }))\r\n        };\r\n    }\r\n}\r\n\r\n// Rotas da API\r\n\r\n// Rota de teste para upload\r\n// ðŸ›¡ï¸ ROTA SEGURA DE UPLOAD COM FILA\r\napp.post('/api/upload-test', upload.single('file'), async (req, res) => {\r\n    try {\r\n        if (!req.file) {\r\n            return res.status(400).json({ \r\n                success: false, \r\n                error: 'Nenhum arquivo enviado',\r\n                code: 'NO_FILE'\r\n            });\r\n        }\r\n\r\n        // ValidaÃ§Ã£o adicional pÃ³s-upload\r\n        const validation = uploadUtils.validateUpload(req.file);\r\n        if (!validation.valid) {\r\n            // Remove arquivo invÃ¡lido\r\n            try {\r\n                await fs.unlink(req.file.path);\r\n            } catch (unlinkError) {\r\n                console.error('Erro ao remover arquivo invÃ¡lido:', unlinkError);\r\n            }\r\n            \r\n            return res.status(400).json({\r\n                success: false,\r\n                error: validation.errors.join(', '),\r\n                code: 'VALIDATION_FAILED'\r\n            });\r\n        }\r\n\r\n        // Log seguro do upload\r\n        const logData = uploadUtils.logUploadInfo(req.file, req.file.filename);\r\n        \r\n        // Enfileirar para processamento\r\n        try {\r\n            const jobResult = await fileQueue.addConversionJob(req.file.filename, {\r\n                originalName: logData.originalName,\r\n                size: req.file.size,\r\n                userId: req.ip // Usando IP como identificador simples\r\n            });\r\n\r\n            // Gerar token para download futuro\r\n            const downloadTokenString = downloadToken.gerarToken(\r\n                req.file.filename.replace('.mpp', '.xml'),\r\n                {\r\n                    originalName: logData.originalName.replace('.mpp', '_convertido.xml'),\r\n                    jobId: jobResult.jobId\r\n                }\r\n            );\r\n\r\n            res.status(202).json({\r\n                success: true,\r\n                message: 'Arquivo enviado para processamento',\r\n                jobId: jobResult.jobId,\r\n                status: jobResult.status,\r\n                filename: logData.originalName,\r\n                downloadToken: downloadTokenString,\r\n                statusUrl: `/api/status/${jobResult.jobId}`,\r\n                estimatedTime: '2-5 minutos',\r\n                createdAt: jobResult.createdAt\r\n            });\r\n\r\n        } catch (queueError) {\r\n            console.error('âŒ Erro ao enfileirar:', queueError);\r\n            \r\n            // Remove arquivo se falhou ao enfileirar\r\n            try {\r\n                await fs.unlink(req.file.path);\r\n            } catch {\r\n                // Ignorar erro de remoÃ§Ã£o\r\n            }\r\n\r\n            return res.status(500).json({\r\n                success: false,\r\n                error: 'Erro no sistema de processamento',\r\n                code: 'QUEUE_FAILED'\r\n            });\r\n        }\r\n        \r\n    } catch (error) {\r\n        console.error('âŒ Erro crÃ­tico no upload:', error);\r\n        \r\n        // Log de seguranÃ§a para monitoramento\r\n        console.log('ðŸ”’ Tentativa de upload suspeita:', {\r\n            ip: req.ip,\r\n            userAgent: req.get('User-Agent'),\r\n            timestamp: new Date().toISOString(),\r\n            error: error.message\r\n        });\r\n        \r\n        res.status(500).json({ \r\n            success: false, \r\n            error: 'Erro interno do servidor',\r\n            code: 'INTERNAL_ERROR'\r\n        });\r\n    }\r\n});\r\n\r\n// FunÃ§Ã£o para gerar XML de exemplo\r\nfunction generateSampleXML(originalName) {\r\n    const currentDate = new Date().toISOString();\r\n    \r\n    return `<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\r\n<Project xmlns=\"http://schemas.microsoft.com/project\">\r\n    <SaveVersion>14</SaveVersion>\r\n    <Name>Projeto Convertido - ${originalName}</Name>\r\n    <Title>ConversÃ£o MPP para XML</Title>\r\n    <Subject>Arquivo convertido automaticamente</Subject>\r\n    <Author>Conversor MPP-XML</Author>\r\n    <CreationDate>${currentDate}</CreationDate>\r\n    <LastSaved>${currentDate}</LastSaved>\r\n    <StartDate>2024-01-01T08:00:00</StartDate>\r\n    <FinishDate>2024-12-31T17:00:00</FinishDate>\r\n    <CurrencySymbol>R$</CurrencySymbol>\r\n    <CurrencyCode>BRL</CurrencyCode>\r\n    \r\n    <Tasks>\r\n        <Task>\r\n            <UID>1</UID>\r\n            <ID>1</ID>\r\n            <Name>Projeto Principal - ${originalName}</Name>\r\n            <Type>1</Type>\r\n            <Start>2024-01-01T08:00:00</Start>\r\n            <Finish>2024-12-31T17:00:00</Finish>\r\n            <Duration>PT8760H0M0S</Duration>\r\n            <Work>PT2000H0M0S</Work>\r\n            <PercentComplete>0</PercentComplete>\r\n            <Priority>500</Priority>\r\n        </Task>\r\n    </Tasks>\r\n    \r\n    <Resources>\r\n        <Resource>\r\n            <UID>1</UID>\r\n            <ID>1</ID>\r\n            <Name>Gerente de Projeto</Name>\r\n            <Type>1</Type>\r\n            <StandardRate>80.00</StandardRate>\r\n            <OvertimeRate>120.00</OvertimeRate>\r\n        </Resource>\r\n    </Resources>\r\n</Project>`;\r\n}\r\n\r\n// Upload de arquivo\r\napp.post('/api/upload', upload.single('file'), async (req, res) => {\r\n    try {\r\n        if (!req.file) {\r\n            return res.status(400).json({ error: 'Nenhum arquivo enviado' });\r\n        }\r\n        \r\n        const conversion = await ConversionManager.createConversion(req.file);\r\n        \r\n        // Rastrear tentativa de conversÃ£o\r\n        const ip = AnalyticsManager.getClientIP(req);\r\n        AnalyticsManager.trackConversion(conversion.id, ip);\r\n        \r\n        res.json({\r\n            success: true,\r\n            conversionId: conversion.id,\r\n            message: 'Arquivo enviado com sucesso'\r\n        });\r\n        \r\n    } catch (error) {\r\n        console.error('Erro no upload:', error);\r\n        res.status(500).json({ error: 'Erro interno do servidor' });\r\n    }\r\n});\r\n\r\n// Gerar QR Code para pagamento\r\napp.post('/api/payment/qrcode', async (req, res) => {\r\n    try {\r\n        const { conversionId, amount } = req.body;\r\n        \r\n        if (!conversionId || !amount) {\r\n            return res.status(400).json({ error: 'Dados incompletos' });\r\n        }\r\n        \r\n        const conversion = await ConversionManager.getConversion(conversionId);\r\n        if (!conversion) {\r\n            return res.status(404).json({ error: 'ConversÃ£o nÃ£o encontrada' });\r\n        }\r\n        \r\n        let payment = await PaymentManager.getPaymentByConversion(conversionId);\r\n        if (!payment) {\r\n            payment = await PaymentManager.createPayment(conversionId, amount);\r\n        }\r\n        \r\n        await PaymentManager.generateQRCode(payment.id);\r\n        \r\n        res.json({\r\n            success: true,\r\n            paymentId: payment.id,\r\n            qrCodeImage: payment.qrCode.split(',')[1], // Remove data:image/png;base64, prefix\r\n            pixKey: payment.pixKey,\r\n            amount: payment.amount,\r\n            expiresAt: payment.expiresAt\r\n        });\r\n        \r\n    } catch (error) {\r\n        console.error('Erro ao gerar QR Code:', error);\r\n        res.status(500).json({ error: 'Erro interno do servidor' });\r\n    }\r\n});\r\n\r\n// Verificar status do pagamento\r\napp.get('/api/payment/status/:conversionId', async (req, res) => {\r\n    try {\r\n        const { conversionId } = req.params;\r\n        \r\n        const payment = await PaymentManager.getPaymentByConversion(conversionId);\r\n        if (!payment) {\r\n            return res.status(404).json({ error: 'Pagamento nÃ£o encontrado' });\r\n        }\r\n        \r\n        // Verificar se o pagamento expirou\r\n        if (new Date() > payment.expiresAt && payment.status === 'pending') {\r\n            await PaymentManager.updatePaymentStatus(payment.id, 'expired');\r\n            payment.status = 'expired';\r\n        }\r\n        \r\n        // Simular verificaÃ§Ã£o de pagamento (em produÃ§Ã£o, consulte a API do seu banco)\r\n        if (payment.status === 'pending' && Math.random() > 0.95) {\r\n            await PaymentManager.updatePaymentStatus(payment.id, 'paid');\r\n            payment.status = 'paid';\r\n            \r\n            // Iniciar conversÃ£o apÃ³s pagamento confirmado\r\n            setTimeout(async () => {\r\n                await ConversionManager.processConversion(conversionId);\r\n            }, 1000);\r\n        }\r\n        \r\n        res.json({\r\n            status: payment.status,\r\n            expiresAt: payment.expiresAt\r\n        });\r\n        \r\n    } catch (error) {\r\n        console.error('Erro ao verificar status do pagamento:', error);\r\n        res.status(500).json({ error: 'Erro interno do servidor' });\r\n    }\r\n});\r\n\r\n// Simular confirmaÃ§Ã£o de pagamento (webhook do banco)\r\napp.post('/api/payment/webhook', async (req, res) => {\r\n    try {\r\n        const { paymentId, status, txid } = req.body;\r\n        \r\n        // Verificar assinatura do webhook (implementar em produÃ§Ã£o)\r\n        \r\n        const payment = database.payments.get(paymentId);\r\n        if (!payment) {\r\n            return res.status(404).json({ error: 'Pagamento nÃ£o encontrado' });\r\n        }\r\n        \r\n        await PaymentManager.updatePaymentStatus(paymentId, status);\r\n        \r\n        if (status === 'paid') {\r\n            // Iniciar conversÃ£o\r\n            await ConversionManager.processConversion(payment.conversionId);\r\n        }\r\n        \r\n        res.json({ success: true });\r\n        \r\n    } catch (error) {\r\n        console.error('Erro no webhook:', error);\r\n        res.status(500).json({ error: 'Erro interno do servidor' });\r\n    }\r\n});\r\n\r\n// Download do arquivo convertido\r\napp.get('/api/download/:conversionId', async (req, res) => {\r\n    try {\r\n        const { conversionId } = req.params;\r\n        \r\n        const conversion = await ConversionManager.getConversion(conversionId);\r\n        if (!conversion) {\r\n            return res.status(404).json({ error: 'ConversÃ£o nÃ£o encontrada' });\r\n        }\r\n        \r\n        // Verificar se o pagamento foi realizado\r\n        const payment = await PaymentManager.getPaymentByConversion(conversionId);\r\n        if (!payment || payment.status !== 'paid') {\r\n            return res.status(403).json({ error: 'Pagamento nÃ£o confirmado' });\r\n        }\r\n        \r\n        // Verificar se a conversÃ£o foi concluÃ­da\r\n        if (conversion.status !== 'completed') {\r\n            return res.status(400).json({ error: 'ConversÃ£o ainda em processamento' });\r\n        }\r\n        \r\n        if (!conversion.outputPath) {\r\n            return res.status(404).json({ error: 'Arquivo convertido nÃ£o encontrado' });\r\n        }\r\n        \r\n        // Incrementar contador de download\r\n        conversion.downloadCount++;\r\n        \r\n        const fileName = conversion.fileName.replace('.mpp', '.xml');\r\n        \r\n        res.download(conversion.outputPath, fileName, (err) => {\r\n            if (err) {\r\n                console.error('Erro no download:', err);\r\n                res.status(500).json({ error: 'Erro ao baixar arquivo' });\r\n            }\r\n        });\r\n        \r\n    } catch (error) {\r\n        console.error('Erro no download:', error);\r\n        res.status(500).json({ error: 'Erro interno do servidor' });\r\n    }\r\n});\r\n\r\n// Status da conversÃ£o\r\napp.get('/api/conversion/status/:conversionId', async (req, res) => {\r\n    try {\r\n        const { conversionId } = req.params;\r\n        \r\n        const conversion = await ConversionManager.getConversion(conversionId);\r\n        if (!conversion) {\r\n            return res.status(404).json({ error: 'ConversÃ£o nÃ£o encontrada' });\r\n        }\r\n        \r\n        res.json({\r\n            status: conversion.status,\r\n            fileName: conversion.fileName,\r\n            createdAt: conversion.createdAt,\r\n            updatedAt: conversion.updatedAt\r\n        });\r\n        \r\n    } catch (error) {\r\n        console.error('Erro ao obter status da conversÃ£o:', error);\r\n        res.status(500).json({ error: 'Erro interno do servidor' });\r\n    }\r\n});\r\n\r\n// Rota para obter estatÃ­sticas de analytics (admin)\r\napp.get('/api/admin/analytics', async (req, res) => {\r\n    try {\r\n        const stats = AnalyticsManager.getDashboardStats();\r\n        res.json(stats);\r\n    } catch (error) {\r\n        console.error('Erro ao obter analytics:', error);\r\n        res.status(500).json({ error: 'Erro interno do servidor' });\r\n    }\r\n});\r\n\r\n// Rota para contador simples de visualizaÃ§Ãµes\r\napp.get('/api/analytics/counter', async (req, res) => {\r\n    try {\r\n        const today = new Date().toISOString().split('T')[0];\r\n        const todayStats = database.analytics.dailyStats.get(today);\r\n        \r\n        res.json({\r\n            totalViews: database.analytics.pageViews,\r\n            uniqueVisitors: database.analytics.uniqueVisitors.size,\r\n            todayViews: todayStats?.views || 0,\r\n            todayUniqueVisitors: todayStats?.uniqueVisitors.size || 0\r\n        });\r\n    } catch (error) {\r\n        console.error('Erro ao obter contador:', error);\r\n        res.status(500).json({ error: 'Erro interno do servidor' });\r\n    }\r\n});\r\n\r\n// Rota para servir o frontend\r\napp.get('*', (req, res) => {\r\n    res.sendFile(path.join(__dirname, '../public', 'index.html'));\r\n});\r\n\r\n// Middleware de tratamento de erros\r\napp.use((error, req, res, next) => {\r\n    console.error('Erro:', error);\r\n    \r\n    if (error instanceof multer.MulterError) {\r\n        if (error.code === 'LIMIT_FILE_SIZE') {\r\n            return res.status(400).json({ error: 'Arquivo muito grande. Tamanho mÃ¡ximo: 50MB' });\r\n        }\r\n    }\r\n    \r\n    res.status(500).json({ error: 'Erro interno do servidor' });\r\n});\r\n\r\n// Limpeza periÃ³dica de arquivos antigos\r\nsetInterval(async () => {\r\n    try {\r\n        const now = new Date();\r\n        const dayAgo = new Date(now - 24 * 60 * 60 * 1000);\r\n        \r\n        for (const [id, conversion] of database.conversions.entries()) {\r\n            if (conversion.createdAt < dayAgo) {\r\n                // Deletar arquivos\r\n                try {\r\n                    await fs.unlink(conversion.filePath);\r\n                    if (conversion.outputPath) {\r\n                        await fs.unlink(conversion.outputPath);\r\n                    }\r\n                } catch (e) {\r\n                    console.error('Erro ao deletar arquivo:', e);\r\n                }\r\n                \r\n                // Remover do banco de dados\r\n                database.conversions.delete(id);\r\n            }\r\n        }\r\n        \r\n        for (const [id, payment] of database.payments.entries()) {\r\n            if (payment.createdAt < dayAgo) {\r\n                database.payments.delete(id);\r\n            }\r\n        }\r\n        \r\n        console.log('Limpeza de arquivos antigos concluÃ­da');\r\n    } catch (error) {\r\n        console.error('Erro na limpeza:', error);\r\n    }\r\n}, 60 * 60 * 1000); // A cada hora\r\n\r\n// ðŸ¥ ROTA DE HEALTH CHECK\r\napp.get('/health', (req, res) => {\r\n    res.json({ status: 'ok' });\r\n});\r\n\r\n// ðŸ“Š ROTA DE STATUS DE JOB\r\napp.get('/api/status/:jobId', async (req, res) => {\r\n    try {\r\n        const { jobId } = req.params;\r\n        const status = await fileQueue.getJobStatus(jobId);\r\n        res.json(status);\r\n    } catch (error) {\r\n        console.error('âŒ Erro ao obter status do job:', error);\r\n        res.status(500).json({\r\n            error: 'Erro interno do servidor',\r\n            code: 'STATUS_ERROR'\r\n        });\r\n    }\r\n});\r\n\r\n// ðŸ“¥ ROTA SEGURA DE DOWNLOAD\r\napp.get('/api/download/:token', async (req, res) => {\r\n    try {\r\n        const { token } = req.params;\r\n        \r\n        // Validar token\r\n        const payload = downloadToken.validarToken(token);\r\n        if (!payload) {\r\n            return res.status(401).json({\r\n                error: 'Token invÃ¡lido ou expirado',\r\n                code: 'INVALID_TOKEN'\r\n            });\r\n        }\r\n\r\n        const filename = payload.filename;\r\n        const filePath = path.join('uploads/converted', filename);\r\n        \r\n        // Verificar se arquivo existe\r\n        try {\r\n            await fs.access(filePath);\r\n        } catch {\r\n            return res.status(404).json({\r\n                error: 'Arquivo nÃ£o encontrado',\r\n                code: 'FILE_NOT_FOUND'\r\n            });\r\n        }\r\n\r\n        // Log de download autorizado\r\n        console.log(`ðŸ“¥ Download autorizado: ${filename} | Token: ${token.substring(0, 20)}...`);\r\n\r\n        // Configurar headers para download\r\n        const originalName = payload.metadata?.originalName || filename;\r\n        res.setHeader('Content-Disposition', `attachment; filename=\"${originalName}\"`);\r\n        res.setHeader('Content-Type', 'application/xml');\r\n\r\n        // Enviar arquivo\r\n        res.sendFile(path.resolve(filePath));\r\n\r\n    } catch (error) {\r\n        console.error('âŒ Erro no download:', error);\r\n        res.status(500).json({\r\n            error: 'Erro interno do servidor',\r\n            code: 'DOWNLOAD_ERROR'\r\n        });\r\n    }\r\n});\r\n\r\n// ðŸ“Š ROTA DE ESTATÃSTICAS DA FILA\r\napp.get('/api/queue/stats', async (req, res) => {\r\n    try {\r\n        const stats = await fileQueue.getActiveJobs();\r\n        res.json(stats);\r\n    } catch (error) {\r\n        console.error('âŒ Erro ao obter estatÃ­sticas:', error);\r\n        res.status(500).json({\r\n            error: 'Erro interno do servidor',\r\n            code: 'STATS_ERROR'\r\n        });\r\n    }\r\n});\r\n\r\napp.listen(PORT, () => {\r\n    console.log(`Servidor rodando na porta ${PORT}`);\r\n    console.log(`Acesse: http://localhost:${PORT}`);\r\n    console.log(`Health check: http://localhost:${PORT}/health`);\r\n});","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rafae\\Desktop\\PROJETOS DE ESTUDOS\\CONVERSOR MPP XML\\api\\upload-utils.js","messages":[{"ruleId":"security/detect-non-literal-fs-filename","severity":1,"message":"Found mkdir from package \"fs\" with non literal argument at index 0","line":58,"column":15,"nodeType":"CallExpression","endLine":58,"endColumn":53},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":61,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":61,"endColumn":22,"suggestions":[{"fix":{"range":[1504,1564],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":105,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":105,"endColumn":16,"suggestions":[{"fix":{"range":[2643,2701],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const crypto = require('crypto');\r\nconst path = require('path');\r\nconst fs = require('fs').promises;\r\n\r\n// ExtensÃµes permitidas\r\nconst ALLOWED_EXTENSIONS = new Set(['.mpp', '.xml']);\r\n\r\n// Tamanho mÃ¡ximo (50MB)\r\nconst MAX_FILE_SIZE = 50 * 1024 * 1024;\r\n\r\n/**\r\n * Verifica se a extensÃ£o do arquivo Ã© permitida\r\n */\r\nfunction isAllowedFile(filename) {\r\n    if (!filename) return false;\r\n    const ext = path.extname(filename).toLowerCase();\r\n    return ALLOWED_EXTENSIONS.has(ext);\r\n}\r\n\r\n/**\r\n * Gera um nome de arquivo seguro com UUID\r\n */\r\nfunction generateSafeFilename(originalFilename) {\r\n    if (!originalFilename) {\r\n        throw new Error('Nome do arquivo Ã© obrigatÃ³rio');\r\n    }\r\n    \r\n    const ext = path.extname(originalFilename).toLowerCase();\r\n    const uuid = crypto.randomUUID();\r\n    return `${uuid}${ext}`;\r\n}\r\n\r\n/**\r\n * Sanitiza o nome original do arquivo\r\n */\r\nfunction sanitizeFilename(filename) {\r\n    if (!filename) return '';\r\n    \r\n    // Remove caracteres perigosos e mantÃ©m apenas alfanumÃ©ricos, pontos, hÃ­fens e underscores\r\n    return filename\r\n        .replace(/[^a-zA-Z0-9.\\-_]/g, '_')\r\n        .replace(/_{2,}/g, '_')\r\n        .trim();\r\n}\r\n\r\n/**\r\n * Valida o tamanho do arquivo\r\n */\r\nfunction validateFileSize(size) {\r\n    return size && size <= MAX_FILE_SIZE;\r\n}\r\n\r\n/**\r\n * Garante que o diretÃ³rio existe\r\n */\r\nasync function ensureDirectory(dirPath) {\r\n    try {\r\n        await fs.mkdir(dirPath, { recursive: true });\r\n        return true;\r\n    } catch (error) {\r\n        console.error(`Erro ao criar diretÃ³rio ${dirPath}:`, error);\r\n        return false;\r\n    }\r\n}\r\n\r\n/**\r\n * Valida completamente um arquivo de upload\r\n */\r\nfunction validateUpload(file) {\r\n    const errors = [];\r\n    \r\n    if (!file) {\r\n        errors.push('Arquivo nÃ£o fornecido');\r\n        return { valid: false, errors };\r\n    }\r\n    \r\n    if (!file.originalname) {\r\n        errors.push('Nome do arquivo Ã© obrigatÃ³rio');\r\n    } else if (!isAllowedFile(file.originalname)) {\r\n        errors.push('Tipo de arquivo nÃ£o permitido. Use apenas .mpp ou .xml');\r\n    }\r\n    \r\n    if (!validateFileSize(file.size)) {\r\n        errors.push(`Arquivo muito grande. MÃ¡ximo ${MAX_FILE_SIZE / 1024 / 1024}MB`);\r\n    }\r\n    \r\n    return {\r\n        valid: errors.length === 0,\r\n        errors\r\n    };\r\n}\r\n\r\n/**\r\n * Registra informaÃ§Ãµes de upload de forma segura\r\n */\r\nfunction logUploadInfo(file, safeFilename) {\r\n    const logData = {\r\n        timestamp: new Date().toISOString(),\r\n        originalName: sanitizeFilename(file.originalname),\r\n        safeFilename: safeFilename,\r\n        size: file.size,\r\n        mimetype: file.mimetype\r\n    };\r\n    \r\n    console.log('ðŸ“ Upload seguro:', JSON.stringify(logData));\r\n    return logData;\r\n}\r\n\r\nmodule.exports = {\r\n    ALLOWED_EXTENSIONS,\r\n    MAX_FILE_SIZE,\r\n    isAllowedFile,\r\n    generateSafeFilename,\r\n    sanitizeFilename,\r\n    validateFileSize,\r\n    ensureDirectory,\r\n    validateUpload,\r\n    logUploadInfo\r\n};","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rafae\\Desktop\\PROJETOS DE ESTUDOS\\CONVERSOR MPP XML\\config\\2fa-config.js","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":63,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":63,"endColumn":24,"suggestions":[{"fix":{"range":[2584,2643],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":66,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":66,"endColumn":26,"suggestions":[{"fix":{"range":[2710,2762],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":101,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":101,"endColumn":24,"suggestions":[{"fix":{"range":[4332,4395],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":104,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":104,"endColumn":26,"suggestions":[{"fix":{"range":[4462,4511],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * 2FA Email Configuration\r\n * Para implementaÃ§Ã£o futura em produÃ§Ã£o\r\n */\r\n\r\nconst nodemailer = require('nodemailer');\r\n\r\nclass TwoFactorAuth {\r\n    constructor() {\r\n        this.transporter = null;\r\n        this.initializeTransporter();\r\n    }\r\n\r\n    initializeTransporter() {\r\n        // ConfiguraÃ§Ã£o para Outlook/Hotmail\r\n        this.transporter = nodemailer.createTransporter({\r\n            host: 'smtp-mail.outlook.com',\r\n            port: 587,\r\n            secure: false,\r\n            auth: {\r\n                user: process.env.ADMIN_EMAIL || 'rafaelcannalonga2@hotmail.com',\r\n                pass: process.env.EMAIL_PASSWORD || 'senha_do_email_aqui'\r\n            }\r\n        });\r\n    }\r\n\r\n    async sendLoginNotification(userEmail, loginDetails) {\r\n        const mailOptions = {\r\n            from: process.env.ADMIN_EMAIL,\r\n            to: userEmail,\r\n            subject: 'ðŸ” Acesso Admin - MPP Converter',\r\n            html: `\r\n                <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\r\n                    <h2 style=\"color: #3b82f6;\">ðŸ›¡ï¸ NotificaÃ§Ã£o de Acesso Admin</h2>\r\n                    \r\n                    <p>OlÃ¡ <strong>Alcap0ne</strong>,</p>\r\n                    \r\n                    <p>Um novo login foi realizado no painel administrativo do MPP Converter.</p>\r\n                    \r\n                    <div style=\"background: #f8fafc; padding: 1rem; border-radius: 8px; margin: 1rem 0;\">\r\n                        <h3 style=\"color: #374151; margin: 0 0 0.5rem 0;\">Detalhes do Login:</h3>\r\n                        <p><strong>Data/Hora:</strong> ${loginDetails.timestamp}</p>\r\n                        <p><strong>IP:</strong> ${loginDetails.ip || 'localhost'}</p>\r\n                        <p><strong>User-Agent:</strong> ${loginDetails.userAgent || 'N/A'}</p>\r\n                    </div>\r\n                    \r\n                    <p style=\"color: #10b981;\"><strong>âœ… Login autorizado com sucesso!</strong></p>\r\n                    \r\n                    <p>Se vocÃª nÃ£o fez este login, entre em contato imediatamente.</p>\r\n                    \r\n                    <hr style=\"border: 1px solid #e5e7eb; margin: 2rem 0;\">\r\n                    \r\n                    <p style=\"color: #6b7280; font-size: 0.875rem;\">\r\n                        Esta Ã© uma mensagem automÃ¡tica do sistema MPP Converter.<br>\r\n                        Sistema de seguranÃ§a 2FA ativo.\r\n                    </p>\r\n                </div>\r\n            `\r\n        };\r\n\r\n        try {\r\n            await this.transporter.sendMail(mailOptions);\r\n            console.log('ðŸ“§ NotificaÃ§Ã£o 2FA enviada para:', userEmail);\r\n            return true;\r\n        } catch (error) {\r\n            console.error('âŒ Erro ao enviar email 2FA:', error);\r\n            return false;\r\n        }\r\n    }\r\n\r\n    async sendSecurityAlert(userEmail, alertType, details) {\r\n        const mailOptions = {\r\n            from: process.env.ADMIN_EMAIL,\r\n            to: userEmail,\r\n            subject: 'âš ï¸ Alerta de SeguranÃ§a - MPP Converter',\r\n            html: `\r\n                <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\r\n                    <h2 style=\"color: #ef4444;\">âš ï¸ Alerta de SeguranÃ§a</h2>\r\n                    \r\n                    <p>OlÃ¡ <strong>Alcap0ne</strong>,</p>\r\n                    \r\n                    <p>Detectamos uma atividade suspeita em seu sistema MPP Converter.</p>\r\n                    \r\n                    <div style=\"background: #fef2f2; border: 1px solid #fecaca; padding: 1rem; border-radius: 8px; margin: 1rem 0;\">\r\n                        <h3 style=\"color: #dc2626; margin: 0 0 0.5rem 0;\">Tipo de Alerta: ${alertType}</h3>\r\n                        <p><strong>Detalhes:</strong> ${details}</p>\r\n                        <p><strong>Data/Hora:</strong> ${new Date().toLocaleString('pt-BR')}</p>\r\n                    </div>\r\n                    \r\n                    <p>Recomendamos que verifique imediatamente o painel administrativo.</p>\r\n                    \r\n                    <p style=\"color: #6b7280; font-size: 0.875rem;\">\r\n                        Sistema de monitoramento automÃ¡tico ativo.\r\n                    </p>\r\n                </div>\r\n            `\r\n        };\r\n\r\n        try {\r\n            await this.transporter.sendMail(mailOptions);\r\n            console.log('ðŸš¨ Alerta de seguranÃ§a enviado para:', userEmail);\r\n            return true;\r\n        } catch (error) {\r\n            console.error('âŒ Erro ao enviar alerta:', error);\r\n            return false;\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = TwoFactorAuth;\r\n\r\n// Uso no servidor:\r\n// const TwoFactorAuth = require('./2fa-config');\r\n// const twoFA = new TwoFactorAuth();\r\n// \r\n// // No login bem-sucedido:\r\n// await twoFA.sendLoginNotification(ADMIN_EMAIL, {\r\n//     timestamp: new Date().toLocaleString('pt-BR'),\r\n//     ip: req.ip,\r\n//     userAgent: req.get('User-Agent')\r\n// });","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rafae\\Desktop\\PROJETOS DE ESTUDOS\\CONVERSOR MPP XML\\converters\\mppToXml.js","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":21,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":21,"endColumn":24,"suggestions":[{"fix":{"range":[595,668],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"security/detect-non-literal-fs-filename","severity":1,"message":"Found stat from package \"fs\" with non literal argument at index 0","line":30,"column":33,"nodeType":"CallExpression","endLine":30,"endColumn":51},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":33,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":33,"endColumn":24,"suggestions":[{"fix":{"range":[1107,1156],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"security/detect-non-literal-fs-filename","severity":1,"message":"Found mkdir from package \"fs\" with non literal argument at index 0","line":44,"column":19,"nodeType":"CallExpression","endLine":44,"endColumn":59},{"ruleId":"security/detect-non-literal-fs-filename","severity":1,"message":"Found writeFile from package \"fs\" with non literal argument at index 0","line":47,"column":19,"nodeType":"CallExpression","endLine":47,"endColumn":63},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":59,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":59,"endColumn":24,"suggestions":[{"fix":{"range":[2157,2224],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":63,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":63,"endColumn":26,"suggestions":[{"fix":{"range":[2295,2340],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'stats' is defined but never used.","line":74,"column":41,"nodeType":"Identifier","messageId":"unusedVar","endLine":74,"endColumn":46,"suggestions":[{"messageId":"removeVar","data":{"varName":"stats"},"fix":{"range":[2611,2618],"text":""},"desc":"Remove unused variable 'stats'."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const fs = require('fs').promises;\r\nconst path = require('path');\r\n\r\n/**\r\n * Conversor de arquivos MPP para XML\r\n * Por enquanto implementa um mock que cria XML estruturado\r\n */\r\nclass MPPToXMLConverter {\r\n    constructor() {\r\n        this.supportedExtensions = ['.mpp'];\r\n    }\r\n\r\n    /**\r\n     * Converte arquivo MPP para XML\r\n     * @param {string} inputPath - Caminho do arquivo MPP\r\n     * @param {string} outputPath - Caminho de saÃ­da do XML\r\n     * @returns {Promise<object>} Resultado da conversÃ£o\r\n     */\r\n    async convertMPPtoXML(inputPath, outputPath) {\r\n        try {\r\n            console.log(`ðŸ”„ Iniciando conversÃ£o: ${path.basename(inputPath)} â†’ XML`);\r\n            \r\n            // Verificar se arquivo de entrada existe\r\n            const inputExists = await this.fileExists(inputPath);\r\n            if (!inputExists) {\r\n                throw new Error(`Arquivo de entrada nÃ£o encontrado: ${inputPath}`);\r\n            }\r\n\r\n            // Obter informaÃ§Ãµes do arquivo\r\n            const stats = await fs.stat(inputPath);\r\n            const fileSize = stats.size;\r\n            \r\n            console.log(`ðŸ“Š Arquivo MPP: ${fileSize} bytes`);\r\n\r\n            // Simular tempo de processamento baseado no tamanho\r\n            const processingTime = Math.min(Math.max(fileSize / 1000000, 1), 10);\r\n            await this.simulateProcessing(processingTime);\r\n\r\n            // Gerar XML estruturado\r\n            const xmlContent = await this.generateXMLFromMPP(inputPath, stats);\r\n            \r\n            // Garantir que diretÃ³rio de saÃ­da existe\r\n            const outputDir = path.dirname(outputPath);\r\n            await fs.mkdir(outputDir, { recursive: true });\r\n            \r\n            // Salvar XML\r\n            await fs.writeFile(outputPath, xmlContent, 'utf8');\r\n            \r\n            const result = {\r\n                success: true,\r\n                inputFile: inputPath,\r\n                outputFile: outputPath,\r\n                inputSize: fileSize,\r\n                outputSize: xmlContent.length,\r\n                processingTime: processingTime,\r\n                timestamp: new Date().toISOString()\r\n            };\r\n\r\n            console.log(`âœ… ConversÃ£o concluÃ­da: ${path.basename(outputPath)}`);\r\n            return result;\r\n\r\n        } catch (error) {\r\n            console.error(`âŒ Erro na conversÃ£o:`, error);\r\n            throw error;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gera XML estruturado a partir do arquivo MPP\r\n     * @param {string} inputPath \r\n     * @param {object} stats \r\n     * @returns {Promise<string>} ConteÃºdo XML\r\n     */\r\n    async generateXMLFromMPP(inputPath, stats) {\r\n        const fileName = path.basename(inputPath, '.mpp');\r\n        const timestamp = new Date().toISOString();\r\n        \r\n        // XML estruturado com informaÃ§Ãµes do projeto\r\n        const xmlContent = `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<Project xmlns=\"http://schemas.microsoft.com/project\">\r\n    <SaveVersion>14</SaveVersion>\r\n    <Name>${fileName}</Name>\r\n    <Title>Projeto Convertido - ${fileName}</Title>\r\n    <Subject>ConversÃ£o de arquivo MPP para XML</Subject>\r\n    <Category>ConstruÃ§Ã£o</Category>\r\n    <Company>MPP Converter</Company>\r\n    <Manager>Sistema AutomÃ¡tico</Manager>\r\n    <Author>MPP to XML Converter</Author>\r\n    <CreationDate>${timestamp}</CreationDate>\r\n    <LastSaved>${timestamp}</LastSaved>\r\n    <ScheduleFromStart>1</ScheduleFromStart>\r\n    <StartDate>${new Date().toISOString().split('T')[0]}T08:00:00</StartDate>\r\n    <FinishDate>${new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0]}T17:00:00</FinishDate>\r\n    \r\n    <CalendarUID>1</CalendarUID>\r\n    <DefaultStartTime>08:00:00</DefaultStartTime>\r\n    <DefaultFinishTime>17:00:00</DefaultFinTime>\r\n    <MinutesPerDay>480</MinutesPerDay>\r\n    <MinutesPerWeek>2400</MinutesPerWeek>\r\n    <DaysPerMonth>20</DaysPerMonth>\r\n    \r\n    <Calendars>\r\n        <Calendar>\r\n            <UID>1</UID>\r\n            <Name>PadrÃ£o</Name>\r\n            <IsBaseCalendar>1</IsBaseCalendar>\r\n            <BaseCalendarUID>-1</BaseCalendarUID>\r\n            <WeekDays>\r\n                <WeekDay>\r\n                    <DayType>1</DayType>\r\n                    <DayWorking>0</DayWorking>\r\n                </WeekDay>\r\n                <WeekDay>\r\n                    <DayType>2</DayType>\r\n                    <DayWorking>1</DayWorking>\r\n                    <WorkingTimes>\r\n                        <WorkingTime>\r\n                            <FromTime>08:00:00</FromTime>\r\n                            <ToTime>12:00:00</ToTime>\r\n                        </WorkingTime>\r\n                        <WorkingTime>\r\n                            <FromTime>13:00:00</FromTime>\r\n                            <ToTime>17:00:00</ToTime>\r\n                        </WorkingTime>\r\n                    </WorkingTimes>\r\n                </WeekDay>\r\n                <WeekDay>\r\n                    <DayType>3</DayType>\r\n                    <DayWorking>1</DayWorking>\r\n                    <WorkingTimes>\r\n                        <WorkingTime>\r\n                            <FromTime>08:00:00</FromTime>\r\n                            <ToTime>12:00:00</ToTime>\r\n                        </WorkingTime>\r\n                        <WorkingTime>\r\n                            <FromTime>13:00:00</FromTime>\r\n                            <ToTime>17:00:00</ToTime>\r\n                        </WorkingTime>\r\n                    </WorkingTimes>\r\n                </WeekDay>\r\n                <WeekDay>\r\n                    <DayType>4</DayType>\r\n                    <DayWorking>1</DayWorking>\r\n                    <WorkingTimes>\r\n                        <WorkingTime>\r\n                            <FromTime>08:00:00</FromTime>\r\n                            <ToTime>12:00:00</ToTime>\r\n                        </WorkingTime>\r\n                        <WorkingTime>\r\n                            <FromTime>13:00:00</FromTime>\r\n                            <ToTime>17:00:00</ToTime>\r\n                        </WorkingTime>\r\n                    </WorkingTimes>\r\n                </WeekDay>\r\n                <WeekDay>\r\n                    <DayType>5</DayType>\r\n                    <DayWorking>1</DayWorking>\r\n                    <WorkingTimes>\r\n                        <WorkingTime>\r\n                            <FromTime>08:00:00</FromTime>\r\n                            <ToTime>12:00:00</ToTime>\r\n                        </WorkingTime>\r\n                        <WorkingTime>\r\n                            <FromTime>13:00:00</FromTime>\r\n                            <ToTime>17:00:00</ToTime>\r\n                        </WorkingTime>\r\n                    </WorkingTimes>\r\n                </WeekDay>\r\n                <WeekDay>\r\n                    <DayType>6</DayType>\r\n                    <DayWorking>1</DayWorking>\r\n                    <WorkingTimes>\r\n                        <WorkingTime>\r\n                            <FromTime>08:00:00</FromTime>\r\n                            <ToTime>12:00:00</ToTime>\r\n                        </WorkingTime>\r\n                    </WorkingTimes>\r\n                </WeekDay>\r\n                <WeekDay>\r\n                    <DayType>7</DayType>\r\n                    <DayWorking>0</DayWorking>\r\n                </WeekDay>\r\n            </WeekDays>\r\n        </Calendar>\r\n    </Calendars>\r\n    \r\n    <Tasks>\r\n        <Task>\r\n            <UID>0</UID>\r\n            <ID>0</ID>\r\n            <Name>Projeto ${fileName}</Name>\r\n            <Type>1</Type>\r\n            <IsNull>0</IsNull>\r\n            <CreateDate>${timestamp}</CreateDate>\r\n            <Contact>MPP Converter</Contact>\r\n            <WBS>0</WBS>\r\n            <OutlineLevel>0</OutlineLevel>\r\n            <OutlineNumber>1</OutlineNumber>\r\n            <Priority>500</Priority>\r\n            <Start>${new Date().toISOString()}</Start>\r\n            <Finish>${new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString()}</Finish>\r\n            <Duration>PT240H0M0S</Duration>\r\n            <ManualStart>${new Date().toISOString()}</ManualStart>\r\n            <ManualFinish>${new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString()}</ManualFinish>\r\n            <ManualDuration>PT240H0M0S</ManualDuration>\r\n            <Work>PT240H0M0S</Work>\r\n            <IsManual>0</IsManual>\r\n            <Summary>1</Summary>\r\n        </Task>\r\n        <Task>\r\n            <UID>1</UID>\r\n            <ID>1</ID>\r\n            <Name>Fase 1 - Planejamento</Name>\r\n            <Type>0</Type>\r\n            <IsNull>0</IsNull>\r\n            <CreateDate>${timestamp}</CreateDate>\r\n            <WBS>1</WBS>\r\n            <OutlineLevel>1</OutlineLevel>\r\n            <OutlineNumber>1.1</OutlineNumber>\r\n            <Priority>500</Priority>\r\n            <Start>${new Date().toISOString()}</Start>\r\n            <Finish>${new Date(Date.now() + 10 * 24 * 60 * 60 * 1000).toISOString()}</Finish>\r\n            <Duration>PT80H0M0S</Duration>\r\n            <Work>PT80H0M0S</Work>\r\n            <IsManual>0</IsManual>\r\n        </Task>\r\n        <Task>\r\n            <UID>2</UID>\r\n            <ID>2</ID>\r\n            <Name>Fase 2 - ExecuÃ§Ã£o</Name>\r\n            <Type>0</Type>\r\n            <IsNull>0</IsNull>\r\n            <CreateDate>${timestamp}</CreateDate>\r\n            <WBS>2</WBS>\r\n            <OutlineLevel>1</OutlineLevel>\r\n            <OutlineNumber>1.2</OutlineNumber>\r\n            <Priority>500</Priority>\r\n            <Start>${new Date(Date.now() + 10 * 24 * 60 * 60 * 1000).toISOString()}</Start>\r\n            <Finish>${new Date(Date.now() + 25 * 24 * 60 * 60 * 1000).toISOString()}</Finish>\r\n            <Duration>PT120H0M0S</Duration>\r\n            <Work>PT120H0M0S</Work>\r\n            <IsManual>0</IsManual>\r\n        </Task>\r\n        <Task>\r\n            <UID>3</UID>\r\n            <ID>3</ID>\r\n            <Name>Fase 3 - FinalizaÃ§Ã£o</Name>\r\n            <Type>0</Type>\r\n            <IsNull>0</IsNull>\r\n            <CreateDate>${timestamp}</CreateDate>\r\n            <WBS>3</WBS>\r\n            <OutlineLevel>1</OutlineLevel>\r\n            <OutlineNumber>1.3</OutlineNumber>\r\n            <Priority>500</Priority>\r\n            <Start>${new Date(Date.now() + 25 * 24 * 60 * 60 * 1000).toISOString()}</Start>\r\n            <Finish>${new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString()}</Finish>\r\n            <Duration>PT40H0M0S</Duration>\r\n            <Work>PT40H0M0S</Work>\r\n            <IsManual>0</IsManual>\r\n        </Task>\r\n    </Tasks>\r\n    \r\n    <Resources>\r\n        <Resource>\r\n            <UID>1</UID>\r\n            <ID>1</ID>\r\n            <Name>Gerente de Projeto</Name>\r\n            <Type>1</Type>\r\n            <IsNull>0</IsNull>\r\n            <MaxUnits>1.0</MaxUnits>\r\n            <PeakUnits>1.0</PeakUnits>\r\n            <OverAllocated>0</OverAllocated>\r\n            <StandardRate>100</StandardRate>\r\n            <OvertimeRate>150</OvertimeRate>\r\n        </Resource>\r\n        <Resource>\r\n            <UID>2</UID>\r\n            <ID>2</ID>\r\n            <Name>Equipe TÃ©cnica</Name>\r\n            <Type>1</Type>\r\n            <IsNull>0</IsNull>\r\n            <MaxUnits>3.0</MaxUnits>\r\n            <PeakUnits>3.0</PeakUnits>\r\n            <OverAllocated>0</OverAllocated>\r\n            <StandardRate>80</StandardRate>\r\n            <OvertimeRate>120</OvertimeRate>\r\n        </Resource>\r\n    </Resources>\r\n    \r\n    <Assignments>\r\n        <Assignment>\r\n            <UID>1</UID>\r\n            <TaskUID>1</TaskUID>\r\n            <ResourceUID>1</ResourceUID>\r\n            <Units>1.0</Units>\r\n            <Work>PT80H0M0S</Work>\r\n            <Start>${new Date().toISOString()}</Start>\r\n            <Finish>${new Date(Date.now() + 10 * 24 * 60 * 60 * 1000).toISOString()}</Finish>\r\n        </Assignment>\r\n        <Assignment>\r\n            <UID>2</UID>\r\n            <TaskUID>2</TaskUID>\r\n            <ResourceUID>2</ResourceUID>\r\n            <Units>3.0</Units>\r\n            <Work>PT120H0M0S</Work>\r\n            <Start>${new Date(Date.now() + 10 * 24 * 60 * 60 * 1000).toISOString()}</Start>\r\n            <Finish>${new Date(Date.now() + 25 * 24 * 60 * 60 * 1000).toISOString()}</Finish>\r\n        </Assignment>\r\n        <Assignment>\r\n            <UID>3</UID>\r\n            <TaskUID>3</TaskUID>\r\n            <ResourceUID>1</ResourceUID>\r\n            <Units>1.0</Units>\r\n            <Work>PT40H0M0S</Work>\r\n            <Start>${new Date(Date.now() + 25 * 24 * 60 * 60 * 1000).toISOString()}</Start>\r\n            <Finish>${new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString()}</Finish>\r\n        </Assignment>\r\n    </Assignments>\r\n    \r\n    <ExtendedAttributes>\r\n        <ExtendedAttribute>\r\n            <FieldID>188744001</FieldID>\r\n            <FieldName>Text1</FieldName>\r\n            <Alias>ObservaÃ§Ãµes</Alias>\r\n        </ExtendedAttribute>\r\n    </ExtendedAttributes>\r\n    \r\n</Project>`;\r\n\r\n        return xmlContent;\r\n    }\r\n\r\n    /**\r\n     * Simula tempo de processamento\r\n     * @param {number} seconds \r\n     */\r\n    async simulateProcessing(seconds) {\r\n        return new Promise(resolve => {\r\n            setTimeout(resolve, seconds * 1000);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Verifica se arquivo existe\r\n     * @param {string} filePath \r\n     * @returns {Promise<boolean>}\r\n     */\r\n    async fileExists(filePath) {\r\n        try {\r\n            await fs.access(filePath);\r\n            return true;\r\n        } catch {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Valida se arquivo Ã© MPP\r\n     * @param {string} filePath \r\n     * @returns {boolean}\r\n     */\r\n    isValidMPPFile(filePath) {\r\n        const ext = path.extname(filePath).toLowerCase();\r\n        return this.supportedExtensions.includes(ext);\r\n    }\r\n}\r\n\r\nmodule.exports = new MPPToXMLConverter();","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rafae\\Desktop\\PROJETOS DE ESTUDOS\\CONVERSOR MPP XML\\ecosystem.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rafae\\Desktop\\PROJETOS DE ESTUDOS\\CONVERSOR MPP XML\\eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rafae\\Desktop\\PROJETOS DE ESTUDOS\\CONVERSOR MPP XML\\healthcheck.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rafae\\Desktop\\PROJETOS DE ESTUDOS\\CONVERSOR MPP XML\\public\\js\\app_clean_new.js","messages":[{"ruleId":null,"nodeType":null,"fatal":true,"severity":2,"message":"Parsing error: Identifier 'setupFileUpload' has already been declared","line":352,"column":10}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// MPP Converter - VersÃ£o Limpa e Funcional\r\nconsole.log('ðŸš€ Carregando conversor...');\r\n\r\n// Estado da aplicaÃ§Ã£o\r\nlet currentFile = null;\r\n\r\n// InicializaÃ§Ã£o quando DOM estiver pronto\r\ndocument.addEventListener('DOMContentLoaded', function() {\r\n    console.log('ðŸ“‹ DOM carregado, configurando...');\r\n    \r\n    // Setup de elementos\r\n    setupFileUpload();\r\n    setupConversionButtons();\r\n    \r\n    console.log('âœ… ConfiguraÃ§Ã£o concluÃ­da');\r\n});\r\n\r\nfunction setupFileUpload() {\r\n    const uploadArea = document.getElementById('uploadArea');\r\n    const fileInput = document.getElementById('fileInput');\r\n    \r\n    if (!uploadArea || !fileInput) {\r\n        console.log('âŒ Elementos de upload nÃ£o encontrados');\r\n        return;\r\n    }\r\n    \r\n    // Click na Ã¡rea de upload\r\n    uploadArea.addEventListener('click', () => {\r\n        fileInput.click();\r\n    });\r\n    \r\n    // Arquivo selecionado\r\n    fileInput.addEventListener('change', function(e) {\r\n        const file = e.target.files[0];\r\n        if (!file) return;\r\n        \r\n        console.log('ðŸ“„ Arquivo selecionado:', file.name);\r\n        \r\n        // Mostrar arquivo selecionado\r\n        showFileSelected(file);\r\n        \r\n        // Validar extensÃ£o\r\n        if (!file.name.toLowerCase().endsWith('.mpp')) {\r\n            alert('âŒ Selecione um arquivo .mpp vÃ¡lido');\r\n            fileInput.value = '';\r\n            hideFileSelected();\r\n            return;\r\n        }\r\n        \r\n        // Arquivo vÃ¡lido\r\n        currentFile = file;\r\n        enableConvertButton();\r\n        console.log('âœ… Arquivo vÃ¡lido carregado:', file.name);\r\n    });\r\n    \r\n    console.log('âœ… Upload configurado');\r\n}\r\n\r\nfunction setupConversionButtons() {\r\n    const convertBtn = document.getElementById('convertBtn');\r\n    const changeFileBtn = document.getElementById('changeFileBtn');\r\n    \r\n    if (convertBtn) {\r\n        convertBtn.addEventListener('click', startConversion);\r\n    }\r\n    \r\n    if (changeFileBtn) {\r\n        changeFileBtn.addEventListener('click', () => {\r\n            const fileInput = document.getElementById('fileInput');\r\n            if (fileInput) {\r\n                fileInput.value = '';\r\n                currentFile = null;\r\n                hideFileSelected();\r\n            }\r\n        });\r\n    }\r\n    \r\n    console.log('âœ… BotÃ£o de conversÃ£o configurado');\r\n}\r\n\r\nfunction showFileSelected(file) {\r\n    const uploadWrapper = document.querySelector('.upload-wrapper');\r\n    const fileSelectedDiv = document.getElementById('fileSelected');\r\n    const selectedFileName = document.getElementById('selectedFileName');\r\n    const selectedFileSize = document.getElementById('selectedFileSize');\r\n    \r\n    if (uploadWrapper && uploadWrapper.querySelector('.upload-area')) {\r\n        uploadWrapper.querySelector('.upload-area').style.display = 'none';\r\n    }\r\n    \r\n    if (fileSelectedDiv) {\r\n        fileSelectedDiv.style.display = 'block';\r\n    }\r\n    \r\n    if (selectedFileName) {\r\n        selectedFileName.textContent = file.name;\r\n    }\r\n    \r\n    if (selectedFileSize) {\r\n        selectedFileSize.textContent = (file.size / 1048576).toFixed(2) + ' MB';\r\n    }\r\n    \r\n    console.log('âœ… Arquivo mostrado na interface');\r\n}\r\n\r\nfunction hideFileSelected() {\r\n    const uploadWrapper = document.querySelector('.upload-wrapper');\r\n    const fileSelectedDiv = document.getElementById('fileSelected');\r\n    \r\n    if (uploadWrapper && uploadWrapper.querySelector('.upload-area')) {\r\n        uploadWrapper.querySelector('.upload-area').style.display = 'block';\r\n    }\r\n    \r\n    if (fileSelectedDiv) {\r\n        fileSelectedDiv.style.display = 'none';\r\n    }\r\n}\r\n\r\nfunction enableConvertButton() {\r\n    const convertBtn = document.getElementById('convertBtn');\r\n    \r\n    if (convertBtn) {\r\n        convertBtn.disabled = false;\r\n        convertBtn.style.opacity = '1';\r\n        convertBtn.style.cursor = 'pointer';\r\n    }\r\n    \r\n    console.log('âœ… BotÃ£o habilitado');\r\n}\r\n\r\nfunction startConversion() {\r\n    console.log('ðŸ”„ Iniciando conversÃ£o...');\r\n    \r\n    if (!currentFile) {\r\n        alert('âŒ Selecione um arquivo .mpp primeiro!');\r\n        return;\r\n    }\r\n    \r\n    console.log('ðŸ“„ Convertendo:', currentFile.name);\r\n    \r\n    // Mostrar progresso\r\n    showProgressState();\r\n    \r\n    // Fazer upload\r\n    uploadFile(currentFile)\r\n        .then(result => {\r\n            console.log('âœ… ConversÃ£o concluÃ­da:', result);\r\n            showSuccessState(result);\r\n        })\r\n        .catch(error => {\r\n            console.error('âŒ Erro na conversÃ£o:', error);\r\n            showErrorState(error.message);\r\n        });\r\n}\r\n\r\nfunction hideProgressBar() {\r\n    const progressWrapper = document.getElementById('progressWrapper');\r\n    if (progressWrapper) {\r\n        progressWrapper.style.display = 'none';\r\n    }\r\n    console.log('ðŸ“Š Barra de progresso ocultada');\r\n}\r\n\r\nfunction resetButtons() {\r\n    const convertBtn = document.getElementById('convertBtn');\r\n    const fileInput = document.getElementById('fileInput');\r\n    \r\n    if (convertBtn) {\r\n        convertBtn.disabled = false;\r\n        convertBtn.textContent = 'Converter Arquivo';\r\n        convertBtn.style.backgroundColor = '';\r\n    }\r\n    \r\n    if (fileInput) {\r\n        fileInput.value = '';\r\n    }\r\n    \r\n    console.log('ðŸ”„ BotÃµes resetados');\r\n}\r\n\r\nfunction showProgressState() {\r\n    const fileSelected = document.getElementById('fileSelected');\r\n    const progressWrapper = document.getElementById('progressWrapper');\r\n    \r\n    if (fileSelected) fileSelected.style.display = 'none';\r\n    if (progressWrapper) progressWrapper.style.display = 'block';\r\n    \r\n    console.log('ðŸ”„ Estado de progresso ativado');\r\n}\r\n\r\nfunction showSuccessState(result) {\r\n    const progressWrapper = document.getElementById('progressWrapper');\r\n    const successWrapper = document.getElementById('successWrapper');\r\n    const downloadBtn = document.getElementById('downloadBtn');\r\n    const newConversionBtn = document.getElementById('newConversionBtn');\r\n    \r\n    if (progressWrapper) progressWrapper.style.display = 'none';\r\n    if (successWrapper) successWrapper.style.display = 'block';\r\n    \r\n    // Configurar botÃ£o de download\r\n    if (downloadBtn && result.xmlContent) {\r\n        downloadBtn.onclick = () => downloadXML(result.xmlContent, currentFile.name);\r\n    }\r\n    \r\n    // Configurar botÃ£o de nova conversÃ£o\r\n    if (newConversionBtn) {\r\n        newConversionBtn.onclick = () => {\r\n            location.reload();\r\n        };\r\n    }\r\n    \r\n    console.log('âœ… Estado de sucesso ativado');\r\n}\r\n\r\nfunction showErrorState(errorMessage) {\r\n    const progressWrapper = document.getElementById('progressWrapper');\r\n    const errorWrapper = document.getElementById('errorWrapper');\r\n    const errorMessageEl = document.getElementById('errorMessage');\r\n    const retryBtn = document.getElementById('retryBtn');\r\n    \r\n    if (progressWrapper) progressWrapper.style.display = 'none';\r\n    if (errorWrapper) errorWrapper.style.display = 'block';\r\n    \r\n    if (errorMessageEl) {\r\n        errorMessageEl.textContent = errorMessage;\r\n    }\r\n    \r\n    if (retryBtn) {\r\n        retryBtn.onclick = () => {\r\n            errorWrapper.style.display = 'none';\r\n            showFileSelected(currentFile);\r\n        };\r\n    }\r\n    \r\n    console.log('âŒ Estado de erro ativado');\r\n}\r\n\r\nasync function uploadFile(file) {\r\n    console.log('ðŸ“¤ Enviando arquivo...', `${(file.size / 1024 / 1024).toFixed(2)}MB`);\r\n    \r\n    const formData = new FormData();\r\n    formData.append('file', file);\r\n    \r\n    updateProgress(30, 'Enviando arquivo...');\r\n    \r\n    try {\r\n        const timeoutMs = Math.max(30000, file.size / 1000);\r\n        console.log(`â±ï¸ Timeout configurado: ${timeoutMs}ms`);\r\n        \r\n        const controller = new AbortController();\r\n        const timeoutId = setTimeout(() => controller.abort(), timeoutMs);\r\n        \r\n        const response = await fetch('/api/upload', {\r\n            method: 'POST',\r\n            body: formData,\r\n            signal: controller.signal\r\n        });\r\n        \r\n        clearTimeout(timeoutId);\r\n        updateProgress(60, 'Processando...');\r\n        \r\n        if (!response.ok) {\r\n            throw new Error(`Erro ${response.status}: ${response.statusText}`);\r\n        }\r\n        \r\n        updateProgress(80, 'Convertendo...');\r\n        \r\n        const result = await response.json();\r\n        \r\n        updateProgress(95, 'Finalizando...');\r\n        updateProgress(100, 'ConversÃ£o concluÃ­da!');\r\n        \r\n        return result;\r\n        \r\n    } catch (error) {\r\n        if (error.name === 'AbortError') {\r\n            console.error('â±ï¸ Upload cancelado por timeout');\r\n            throw new Error('Upload cancelado - arquivo muito grande ou conexÃ£o lenta');\r\n        } else if (error.message.includes('Failed to fetch')) {\r\n            console.error('ðŸŒ Erro de conexÃ£o');\r\n            throw new Error('Erro de conexÃ£o - verifique se o servidor estÃ¡ rodando');\r\n        }\r\n        console.error('âŒ Erro no upload:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\nfunction downloadXML(xmlContent, originalName) {\r\n    console.log('ðŸ“¥ Baixando XML...');\r\n    \r\n    try {\r\n        // Criar blob com tipo MIME correto\r\n        const blob = new Blob([xmlContent], { \r\n            type: 'application/xml;charset=utf-8' \r\n        });\r\n        \r\n        const url = window.URL.createObjectURL(blob);\r\n        const fileName = originalName.replace('.mpp', '_convertido.xml').replace(/[^a-zA-Z0-9.-]/g, '_');\r\n        \r\n        const link = document.createElement('a');\r\n        link.href = url;\r\n        link.download = fileName;\r\n        link.style.display = 'none';\r\n        \r\n        document.body.appendChild(link);\r\n        link.click();\r\n        document.body.removeChild(link);\r\n        \r\n        setTimeout(() => {\r\n            window.URL.revokeObjectURL(url);\r\n        }, 1000);\r\n        \r\n        console.log('âœ… Download concluÃ­do:', fileName);\r\n        \r\n    } catch (error) {\r\n        console.error('âŒ Erro no download:', error);\r\n        alert('Erro ao baixar o arquivo XML. Tente novamente.');\r\n    }\r\n}\r\n\r\nfunction updateProgress(percent, message) {\r\n    const progressFill = document.getElementById('progressFill');\r\n    const progressSteps = document.querySelectorAll('.progress-step');\r\n    \r\n    // Atualizar barra de progresso\r\n    if (progressFill) {\r\n        progressFill.style.width = percent + '%';\r\n    }\r\n    \r\n    // Atualizar passos\r\n    if (progressSteps.length > 0) {\r\n        progressSteps.forEach((step, index) => {\r\n            const stepPercent = (index + 1) * 33.33; // 3 passos\r\n            \r\n            if (percent >= stepPercent) {\r\n                step.classList.add('completed');\r\n                step.classList.remove('active');\r\n            } else if (percent >= stepPercent - 33.33) {\r\n                step.classList.add('active');\r\n                step.classList.remove('completed');\r\n            } else {\r\n                step.classList.remove('active', 'completed');\r\n            }\r\n        });\r\n    }\r\n    \r\n    console.log(`ðŸ“Š ${percent}% - ${message}`);\r\n}\r\n\r\nconsole.log('âœ… Script carregado com sucesso');\r\n\r\nfunction setupFileUpload() {\r\n    const uploadArea = document.getElementById('uploadArea');\r\n    const fileInput = document.getElementById('fileInput');\r\n    \r\n    if (!uploadArea || !fileInput) {\r\n        console.log('âŒ Elementos de upload nÃ£o encontrados');\r\n        return;\r\n    }\r\n    \r\n    // Click na Ã¡rea de upload\r\n    uploadArea.addEventListener('click', () => {\r\n        fileInput.click();\r\n    });\r\n    \r\n    // Arquivo selecionado\r\n    fileInput.addEventListener('change', function(e) {\r\n        const file = e.target.files[0];\r\n        if (!file) return;\r\n        \r\n        console.log('ðŸ“„ Arquivo selecionado:', file.name);\r\n        \r\n        // Mostrar arquivo selecionado\r\n        showFileSelected(file);\r\n        \r\n        // Validar extensÃ£o\r\n        if (!file.name.toLowerCase().endsWith('.mpp')) {\r\n            alert('âŒ Selecione um arquivo .mpp vÃ¡lido');\r\n            fileInput.value = '';\r\n            hideFileSelected();\r\n            return;\r\n        }\r\n        \r\n        // Arquivo vÃ¡lido\r\n        currentFile = file;\r\n        enableConvertButton();\r\n        console.log('âœ… Arquivo vÃ¡lido carregado:', file.name);\r\n    });\r\n    \r\n    console.log('âœ… Upload configurado');\r\n}\r\n\r\nfunction setupConversionButtons() {\r\n    const convertBtn = document.getElementById('convertBtn');\r\n    const changeFileBtn = document.getElementById('changeFileBtn');\r\n    \r\n    if (convertBtn) {\r\n        convertBtn.addEventListener('click', startConversion);\r\n    }\r\n    \r\n    if (changeFileBtn) {\r\n        changeFileBtn.addEventListener('click', () => {\r\n            const fileInput = document.getElementById('fileInput');\r\n            if (fileInput) {\r\n                fileInput.value = '';\r\n                currentFile = null;\r\n                hideFileSelected();\r\n            }\r\n        });\r\n    }\r\n    \r\n    console.log('âœ… BotÃ£o de conversÃ£o configurado para teste');\r\n}\r\n\r\nfunction showFileSelected(file) {\r\n    // Esconder upload area e mostrar arquivo selecionado\r\n    const uploadWrapper = document.querySelector('.upload-wrapper');\r\n    const fileSelectedDiv = document.getElementById('fileSelected');\r\n    const selectedFileName = document.getElementById('selectedFileName');\r\n    const selectedFileSize = document.getElementById('selectedFileSize');\r\n    \r\n    if (uploadWrapper && uploadWrapper.querySelector('.upload-area')) {\r\n        uploadWrapper.querySelector('.upload-area').style.display = 'none';\r\n    }\r\n    \r\n    if (fileSelectedDiv) {\r\n        fileSelectedDiv.style.display = 'block';\r\n    }\r\n    \r\n    if (selectedFileName) {\r\n        selectedFileName.textContent = file.name;\r\n    }\r\n    \r\n    if (selectedFileSize) {\r\n        selectedFileSize.textContent = (file.size / 1048576).toFixed(2) + ' MB';\r\n    }\r\n    \r\n    console.log('âœ… Preview exibido');\r\n}\r\n\r\nfunction hideFileSelected() {\r\n    const uploadWrapper = document.querySelector('.upload-wrapper');\r\n    const fileSelectedDiv = document.getElementById('fileSelected');\r\n    \r\n    if (uploadWrapper && uploadWrapper.querySelector('.upload-area')) {\r\n        uploadWrapper.querySelector('.upload-area').style.display = 'block';\r\n    }\r\n    \r\n    if (fileSelectedDiv) {\r\n        fileSelectedDiv.style.display = 'none';\r\n    }\r\n}\r\n\r\nfunction showFileStatus(status) {\r\n    const fileStatus = document.getElementById('fileStatus');\r\n    if (!fileStatus) return;\r\n    \r\n    // Limpar status anterior\r\n    fileStatus.innerHTML = '';\r\n    \r\n    let statusHTML = '';\r\n    \r\n    switch(status) {\r\n        case 'success':\r\n            // Quando sucesso, nÃ£o mostrar nenhum Ã­cone - arquivo OK nÃ£o precisa de indicador\r\n            statusHTML = '';\r\n            break;\r\n        case 'error':\r\n            statusHTML = `\r\n                <div class=\"status-error\">\r\n                    <div class=\"loading-spinner error-spinner\">\r\n                        <div class=\"loading-dot\"></div>\r\n                        <div class=\"loading-dot\"></div>\r\n                        <div class=\"loading-dot\"></div>\r\n                        <div class=\"loading-dot\"></div>\r\n                        <div class=\"loading-dot\"></div>\r\n                        <div class=\"loading-dot\"></div>\r\n                        <div class=\"loading-dot\"></div>\r\n                        <div class=\"loading-dot\"></div>\r\n                    </div>\r\n                </div>`;\r\n            break;\r\n        case 'loading':\r\n            statusHTML = `\r\n                <div class=\"status-loading\">\r\n                    <div class=\"loading-spinner\">\r\n                        <div class=\"loading-dot\"></div>\r\n                        <div class=\"loading-dot\"></div>\r\n                        <div class=\"loading-dot\"></div>\r\n                        <div class=\"loading-dot\"></div>\r\n                        <div class=\"loading-dot\"></div>\r\n                        <div class=\"loading-dot\"></div>\r\n                        <div class=\"loading-dot\"></div>\r\n                        <div class=\"loading-dot\"></div>\r\n                    </div>\r\n                </div>`;\r\n            break;\r\n    }\r\n    \r\n    fileStatus.innerHTML = statusHTML;\r\n    console.log(`ðŸ“Š Status do arquivo: ${status}`);\r\n}\r\n\r\nfunction enableButtons() {\r\n    const convertBtn = document.getElementById('convertBtn');\r\n    \r\n    if (convertBtn) {\r\n        convertBtn.disabled = false;\r\n        convertBtn.style.opacity = '1';\r\n        convertBtn.style.cursor = 'pointer';\r\n    }\r\n    \r\n    console.log('âœ… BotÃ£o habilitado');\r\n}\r\n\r\nfunction enableConvertButton() {\r\n    enableButtons();\r\n}\r\n\r\nfunction showProgressState() {\r\n    const uploadWrapper = document.querySelector('.upload-wrapper');\r\n    const fileSelected = document.getElementById('fileSelected');\r\n    const progressWrapper = document.getElementById('progressWrapper');\r\n    \r\n    if (fileSelected) fileSelected.style.display = 'none';\r\n    if (progressWrapper) progressWrapper.style.display = 'block';\r\n    \r\n    console.log('ðŸ”„ Estado de progresso ativado');\r\n}\r\n\r\nfunction showSuccessState(result) {\r\n    const progressWrapper = document.getElementById('progressWrapper');\r\n    const successWrapper = document.getElementById('successWrapper');\r\n    const downloadBtn = document.getElementById('downloadBtn');\r\n    const newConversionBtn = document.getElementById('newConversionBtn');\r\n    \r\n    if (progressWrapper) progressWrapper.style.display = 'none';\r\n    if (successWrapper) successWrapper.style.display = 'block';\r\n    \r\n    // Configurar botÃ£o de download\r\n    if (downloadBtn && result.xmlContent) {\r\n        downloadBtn.onclick = () => downloadXML(result.xmlContent, currentFile.name);\r\n    }\r\n    \r\n    // Configurar botÃ£o de nova conversÃ£o\r\n    if (newConversionBtn) {\r\n        newConversionBtn.onclick = () => {\r\n            location.reload();\r\n        };\r\n    }\r\n    \r\n    console.log('âœ… Estado de sucesso ativado');\r\n}\r\n\r\nfunction showErrorState(errorMessage) {\r\n    const progressWrapper = document.getElementById('progressWrapper');\r\n    const errorWrapper = document.getElementById('errorWrapper');\r\n    const errorMessageEl = document.getElementById('errorMessage');\r\n    const retryBtn = document.getElementById('retryBtn');\r\n    \r\n    if (progressWrapper) progressWrapper.style.display = 'none';\r\n    if (errorWrapper) errorWrapper.style.display = 'block';\r\n    \r\n    if (errorMessageEl) {\r\n        errorMessageEl.textContent = errorMessage;\r\n    }\r\n    \r\n    if (retryBtn) {\r\n        retryBtn.onclick = () => {\r\n            errorWrapper.style.display = 'none';\r\n            showFileSelected(currentFile);\r\n        };\r\n    }\r\n    \r\n    console.log('âŒ Estado de erro ativado');\r\n}\r\n\r\nfunction startConversion() {\r\n    console.log('ðŸ”„ Iniciando conversÃ£o...');\r\n    \r\n    if (!currentFile) {\r\n        alert('âŒ Selecione um arquivo .mpp primeiro!');\r\n        return;\r\n    }\r\n    \r\n    console.log('ðŸ“„ Convertendo:', currentFile.name);\r\n    \r\n    // Mostrar progresso\r\n    showProgressState();\r\n    \r\n    // Fazer upload real\r\n    uploadFile(currentFile)\r\n        .then(result => {\r\n            console.log('âœ… ConversÃ£o concluÃ­da:', result);\r\n            showSuccessState(result);\r\n        })\r\n        .catch(error => {\r\n            console.error('âŒ Erro na conversÃ£o:', error);\r\n            showErrorState(error.message);\r\n        });\r\n    if (convertBtn) {\r\n        convertBtn.textContent = 'Convertendo...';\r\n        convertBtn.disabled = true;\r\n    }\r\n    \r\n    // Fazer upload\r\n    uploadFile(currentFile)\r\n        .then(result => {\r\n            console.log('âœ… Sucesso:', result);\r\n            updateProgress(100, 'ConversÃ£o concluÃ­da!');\r\n            \r\n            if (result.xml) {\r\n                console.log('ðŸŽ‰ XML gerado com sucesso!');\r\n                \r\n                // Configurar download direto\r\n                setTimeout(() => {\r\n                    const downloadBtn = document.getElementById('downloadBtn');\r\n                    if (downloadBtn) {\r\n                        downloadBtn.onclick = () => downloadXML(result.xml, currentFile.name);\r\n                        console.log('âœ… BotÃ£o de download configurado');\r\n                    }\r\n                }, 500);\r\n                \r\n            } else {\r\n                console.error('âŒ XML nÃ£o recebido na resposta');\r\n                alert('Erro: XML nÃ£o foi gerado na conversÃ£o');\r\n            }\r\n            \r\n            setTimeout(() => {\r\n                hideProgressBar();\r\n                resetButtons();\r\n            }, 2000);\r\n        })\r\n        .catch(error => {\r\n            console.error('âŒ Erro:', error);\r\n            updateProgress(0, 'Erro na conversÃ£o');\r\n            alert('Erro: ' + error.message);\r\n            \r\n            setTimeout(() => {\r\n                hideProgressBar();\r\n                resetButtons();\r\n            }, 2000);\r\n        });\r\n}\r\n\r\nasync function uploadFile(file) {\r\n    console.log('ðŸ“¤ Enviando arquivo...', `${(file.size / 1024 / 1024).toFixed(2)}MB`);\r\n    \r\n    const formData = new FormData();\r\n    formData.append('file', file);\r\n    \r\n    updateProgress(30, 'Enviando arquivo...');\r\n    \r\n    try {\r\n        // Timeout maior para arquivos grandes\r\n        const timeoutMs = Math.max(30000, file.size / 1000); // 1ms por KB, mÃ­nimo 30s\r\n        console.log(`â±ï¸ Timeout configurado: ${timeoutMs}ms`);\r\n        \r\n        const controller = new AbortController();\r\n        const timeoutId = setTimeout(() => controller.abort(), timeoutMs);\r\n        \r\n        const response = await fetch('/api/upload', {\r\n            method: 'POST',\r\n            body: formData,\r\n            signal: controller.signal\r\n        });\r\n        \r\n        clearTimeout(timeoutId);\r\n        updateProgress(60, 'Processando...');\r\n        \r\n        if (!response.ok) {\r\n            throw new Error(`Erro ${response.status}: ${response.statusText}`);\r\n        }\r\n        \r\n        updateProgress(80, 'Convertendo...');\r\n        \r\n        let result;\r\n        try {\r\n            result = await response.json();\r\n        } catch (jsonError) {\r\n            console.warn('âš ï¸ Erro ao parsear JSON, tentando texto:', jsonError);\r\n            const text = await response.text();\r\n            console.log('ðŸ“„ Resposta como texto:', text.substring(0, 200) + '...');\r\n            throw new Error('Resposta invÃ¡lida do servidor');\r\n        }\r\n        \r\n        updateProgress(95, 'Finalizando...');\r\n        return result;\r\n        \r\n    } catch (error) {\r\n        if (error.name === 'AbortError') {\r\n            console.error('â±ï¸ Upload cancelado por timeout');\r\n            throw new Error('Upload cancelado - arquivo muito grande ou conexÃ£o lenta');\r\n        } else if (error.message.includes('Failed to fetch')) {\r\n            console.error('ðŸŒ Erro de conexÃ£o');\r\n            throw new Error('Erro de conexÃ£o - verifique se o servidor estÃ¡ rodando');\r\n        }\r\n        console.error('âŒ Erro no upload:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\nfunction downloadXML(xmlContent, originalName) {\r\n    console.log('ðŸ“¥ Baixando XML...');\r\n    \r\n    try {\r\n        // Validar e limpar o conteÃºdo XML\r\n        const cleanXML = validateAndCleanXML(xmlContent);\r\n        \r\n        // Criar blob com tipo MIME correto e encoding\r\n        const blob = new Blob([cleanXML], { \r\n            type: 'application/xml;charset=utf-8' \r\n        });\r\n        \r\n        const url = window.URL.createObjectURL(blob);\r\n        const fileName = originalName.replace('.mpp', '_convertido.xml').replace(/[^a-zA-Z0-9.-]/g, '_');\r\n        \r\n        const link = document.createElement('a');\r\n        link.href = url;\r\n        link.download = fileName;\r\n        link.setAttribute('type', 'application/xml');\r\n        link.setAttribute('rel', 'noopener noreferrer');\r\n        \r\n        // Adicionar ao DOM temporariamente\r\n        document.body.appendChild(link);\r\n        \r\n        // Simular clique de forma segura\r\n        link.dispatchEvent(new MouseEvent('click', {\r\n            bubbles: true,\r\n            cancelable: true,\r\n            view: window\r\n        }));\r\n        \r\n        // Limpar apÃ³s delay\r\n        setTimeout(() => {\r\n            document.body.removeChild(link);\r\n            window.URL.revokeObjectURL(url);\r\n        }, 100);\r\n        \r\n        console.log('âœ… Download iniciado com seguranÃ§a');\r\n        \r\n    } catch (error) {\r\n        console.error('âŒ Erro no download:', error);\r\n        alert('Erro ao baixar o arquivo XML. Tente novamente.');\r\n    }\r\n}\r\n\r\nfunction validateAndCleanXML(xmlContent) {\r\n    // Garantir que o XML tenha declaraÃ§Ã£o correta\r\n    let cleanXML = xmlContent.trim();\r\n    \r\n    // Adicionar declaraÃ§Ã£o XML se nÃ£o existir\r\n    if (!cleanXML.startsWith('<?xml')) {\r\n        cleanXML = '<?xml version=\"1.0\" encoding=\"UTF-8\"?>\\n' + cleanXML;\r\n    }\r\n    \r\n    // Escapar caracteres perigosos\r\n    cleanXML = cleanXML\r\n        .replace(/&(?!(?:amp|lt|gt|quot|apos);)/g, '&amp;')\r\n        .replace(/</g, '&lt;')\r\n        .replace(/>/g, '&gt;')\r\n        // Restaurar tags XML vÃ¡lidas\r\n        .replace(/&lt;\\?xml/g, '<?xml')\r\n        .replace(/\\?&gt;/g, '?>')\r\n        .replace(/&lt;(\\/?[a-zA-Z][a-zA-Z0-9]*(?:\\s[^&gt;]*)?)\\s*&gt;/g, '<$1>');\r\n    \r\n    return cleanXML;\r\n}\r\n\r\nfunction showPaymentModal() {\r\n    if (!currentFile) {\r\n        alert('âŒ Selecione um arquivo .mpp primeiro!');\r\n        return;\r\n    }\r\n    \r\n    const modal = document.getElementById('paymentModal');\r\n    const paymentFileName = document.getElementById('paymentFileName');\r\n    \r\n    if (paymentFileName) {\r\n        paymentFileName.textContent = currentFile.name;\r\n    }\r\n    \r\n    if (modal) {\r\n        modal.style.display = 'flex';\r\n        \r\n        // Simular geraÃ§Ã£o de QR Code PIX\r\n        setTimeout(() => {\r\n            generatePixQRCode();\r\n        }, 1000);\r\n        \r\n        // Simular confirmaÃ§Ã£o de pagamento para desenvolvimento\r\n        setTimeout(() => {\r\n            console.log('ðŸ’° Pagamento confirmado (simulaÃ§Ã£o)');\r\n            modal.style.display = 'none';\r\n            startConversion();\r\n        }, 5000); // 5 segundos para ver o modal\r\n    }\r\n}\r\n\r\nfunction generatePixQRCode() {\r\n    if (!currentFile) return;\r\n    \r\n    const qrCode = document.getElementById('qrCode');\r\n    if (!qrCode) return;\r\n    \r\n    // Mostrar loading\r\n    qrCode.innerHTML = `\r\n        <div style=\"text-align: center; padding: 20px;\">\r\n            <div style=\"font-size: 40px;\">â³</div>\r\n            <p>Gerando QR Code PIX...</p>\r\n        </div>\r\n    `;\r\n    \r\n    // Fazer requisiÃ§Ã£o para gerar QR Code real\r\n    fetch('/api/payment/pix', {\r\n        method: 'POST',\r\n        headers: {\r\n            'Content-Type': 'application/json'\r\n        },\r\n        body: JSON.stringify({\r\n            fileName: currentFile.name,\r\n            amount: 10.00\r\n        })\r\n    })\r\n    .then(response => response.json())\r\n    .then(data => {\r\n        if (data.success) {\r\n            // Mostrar QR Code real\r\n            qrCode.innerHTML = `\r\n                <div style=\"background: #fff; padding: 20px; border-radius: 10px; border: 2px solid #ddd; text-align: center;\">\r\n                    <img src=\"${data.qrCode}\" alt=\"QR Code PIX\" style=\"width: 200px; height: 200px; margin-bottom: 10px;\">\r\n                    <p style=\"margin: 10px 0; font-weight: bold;\">QR Code PIX - R$ ${data.amount.toFixed(2)}</p>\r\n                    <p style=\"font-size: 12px; color: #666;\">Escaneie com seu app bancÃ¡rio</p>\r\n                    <p style=\"font-size: 10px; color: #888; margin-top: 10px;\">PIX: ${data.pixKey}</p>\r\n                </div>\r\n            `;\r\n            \r\n            console.log('âœ… QR Code PIX gerado com sucesso');\r\n        } else {\r\n            throw new Error(data.error);\r\n        }\r\n    })\r\n    .catch(error => {\r\n        console.error('âŒ Erro ao gerar QR Code:', error);\r\n        qrCode.innerHTML = `\r\n            <div style=\"background: #ffebee; padding: 20px; border-radius: 10px; border: 2px solid #f44336; text-align: center;\">\r\n                <div style=\"font-size: 40px; color: #f44336;\">âŒ</div>\r\n                <p style=\"color: #f44336; margin: 10px 0;\">Erro ao gerar QR Code</p>\r\n                <p style=\"font-size: 12px; color: #666;\">Tente novamente</p>\r\n            </div>\r\n        `;\r\n    });\r\n}\r\n\r\nfunction showDownloadOptions(xmlContent, fileId, originalName) {\r\n    console.log('ðŸ“‹ Mostrando opÃ§Ãµes de download');\r\n    \r\n    // Usar o botÃ£o de download existente em vez de modal\r\n    const downloadBtn = document.getElementById('downloadBtn');\r\n    if (downloadBtn) {\r\n        downloadBtn.onclick = () => downloadXML(xmlContent, originalName);\r\n    }\r\n    \r\n    console.log('âœ… Download configurado para:', originalName);\r\n}\r\n\r\nfunction downloadSecureXML(fileId, originalName) {\r\n    console.log('ðŸ”’ Download seguro ZIP iniciado');\r\n    const url = `/download/${fileId}`;\r\n    window.open(url, '_blank');\r\n}\r\n\r\nfunction closeDownloadModal() {\r\n    const modal = document.querySelector('.download-modal');\r\n    if (modal) {\r\n        modal.remove();\r\n    }\r\n}\r\n\r\nfunction downloadDirectXML(xmlContent, originalName) {\r\n    console.log('ðŸ“¥ Baixando XML...');\r\n    \r\n    try {\r\n        // Criar blob com tipo MIME correto\r\n        const blob = new Blob([xmlContent], { \r\n            type: 'application/xml;charset=utf-8' \r\n        });\r\n        \r\n        const url = window.URL.createObjectURL(blob);\r\n        const fileName = originalName.replace('.mpp', '_convertido.xml').replace(/[^a-zA-Z0-9.-]/g, '_');\r\n        \r\n        const link = document.createElement('a');\r\n        link.href = url;\r\n        link.download = fileName;\r\n        link.style.display = 'none';\r\n        \r\n        document.body.appendChild(link);\r\n        link.click();\r\n        document.body.removeChild(link);\r\n        \r\n        setTimeout(() => {\r\n            window.URL.revokeObjectURL(url);\r\n        }, 1000);\r\n        \r\n        console.log('âœ… Download concluÃ­do:', fileName);\r\n        \r\n    } catch (error) {\r\n        console.error('âŒ Erro no download:', error);\r\n        alert('Erro ao baixar o arquivo XML. Tente novamente.');\r\n    }\r\n}\r\n\r\nconsole.log('âœ… Script carregado com sucesso');","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rafae\\Desktop\\PROJETOS DE ESTUDOS\\CONVERSOR MPP XML\\queue\\queue.js","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":53,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":53,"endColumn":24,"suggestions":[{"fix":{"range":[1618,1683],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":61,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":61,"endColumn":26,"suggestions":[{"fix":{"range":[1909,1954],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":93,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":93,"endColumn":26,"suggestions":[{"fix":{"range":[2969,3024],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":117,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":117,"endColumn":26,"suggestions":[{"fix":{"range":[3831,3878],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":127,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":127,"endColumn":24,"suggestions":[{"fix":{"range":[4097,4161],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":131,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":131,"endColumn":26,"suggestions":[{"fix":{"range":[4239,4295],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":135,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":135,"endColumn":24,"suggestions":[{"fix":{"range":[4380,4436],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":146,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":146,"endColumn":24,"suggestions":[{"fix":{"range":[4705,4743],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":148,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":148,"endColumn":26,"suggestions":[{"fix":{"range":[4784,4835],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const { Queue } = require('bullmq');\r\nconst Redis = require('ioredis');\r\n\r\n// ConfiguraÃ§Ã£o do Redis\r\nconst redisConnection = new Redis(process.env.REDIS_URL || 'redis://localhost:6379', {\r\n    maxRetriesPerRequest: 3,\r\n    retryDelayOnFailover: 100,\r\n    enableReadyCheck: false,\r\n    lazyConnect: true\r\n});\r\n\r\n// CriaÃ§Ã£o da fila de conversÃ£o\r\nconst convertQueue = new Queue('file-conversion', {\r\n    connection: redisConnection,\r\n    defaultJobOptions: {\r\n        removeOnComplete: 10, // Manter apenas 10 jobs completos\r\n        removeOnFail: 20,     // Manter 20 jobs falhos para debug\r\n        attempts: 3,          // Tentar 3 vezes em caso de falha\r\n        backoff: {\r\n            type: 'exponential',\r\n            delay: 2000\r\n        }\r\n    }\r\n});\r\n\r\nclass FileConversionQueue {\r\n    constructor() {\r\n        this.queue = convertQueue;\r\n        this.setupEventHandlers();\r\n    }\r\n\r\n    /**\r\n     * Adiciona job de conversÃ£o Ã  fila\r\n     * @param {string} filename - Nome do arquivo\r\n     * @param {object} metadata - Metadados do arquivo\r\n     * @returns {Promise<object>} Job criado\r\n     */\r\n    async addConversionJob(filename, metadata = {}) {\r\n        try {\r\n            const jobData = {\r\n                filename,\r\n                originalName: metadata.originalName,\r\n                size: metadata.size,\r\n                uploadedAt: new Date().toISOString(),\r\n                userId: metadata.userId || 'anonymous'\r\n            };\r\n\r\n            const job = await this.queue.add('convert-mpp-to-xml', jobData, {\r\n                priority: 1,\r\n                delay: 0\r\n            });\r\n\r\n            console.log(`ðŸ“‹ Job criado: ${job.id} para arquivo ${filename}`);\r\n            return {\r\n                jobId: job.id,\r\n                status: 'queued',\r\n                filename,\r\n                createdAt: new Date().toISOString()\r\n            };\r\n        } catch (error) {\r\n            console.error('âŒ Erro ao criar job:', error);\r\n            throw error;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * ObtÃ©m status de um job\r\n     * @param {string} jobId - ID do job\r\n     * @returns {Promise<object>} Status do job\r\n     */\r\n    async getJobStatus(jobId) {\r\n        try {\r\n            const job = await this.queue.getJob(jobId);\r\n            \r\n            if (!job) {\r\n                return { status: 'not_found' };\r\n            }\r\n\r\n            const state = await job.getState();\r\n            const progress = job.progress;\r\n            \r\n            return {\r\n                id: job.id,\r\n                status: state,\r\n                progress,\r\n                data: job.data,\r\n                createdAt: new Date(job.timestamp).toISOString(),\r\n                processedOn: job.processedOn ? new Date(job.processedOn).toISOString() : null,\r\n                finishedOn: job.finishedOn ? new Date(job.finishedOn).toISOString() : null,\r\n                failedReason: job.failedReason || null\r\n            };\r\n        } catch (error) {\r\n            console.error('âŒ Erro ao obter status do job:', error);\r\n            return { status: 'error', error: error.message };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Lista todos os jobs ativos\r\n     * @returns {Promise<Array>} Lista de jobs\r\n     */\r\n    async getActiveJobs() {\r\n        try {\r\n            const waiting = await this.queue.getWaiting();\r\n            const active = await this.queue.getActive();\r\n            const completed = await this.queue.getCompleted();\r\n            const failed = await this.queue.getFailed();\r\n\r\n            return {\r\n                waiting: waiting.length,\r\n                active: active.length,\r\n                completed: completed.length,\r\n                failed: failed.length,\r\n                total: waiting.length + active.length + completed.length + failed.length\r\n            };\r\n        } catch (error) {\r\n            console.error('âŒ Erro ao listar jobs:', error);\r\n            return { error: error.message };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Configura handlers de eventos da fila\r\n     */\r\n    setupEventHandlers() {\r\n        this.queue.on('completed', (job) => {\r\n            console.log(`âœ… Job ${job.id} completado: ${job.data.filename}`);\r\n        });\r\n\r\n        this.queue.on('failed', (job, err) => {\r\n            console.error(`âŒ Job ${job.id} falhou: ${err.message}`);\r\n        });\r\n\r\n        this.queue.on('progress', (job, progress) => {\r\n            console.log(`ðŸ“Š Job ${job.id} progresso: ${progress}%`);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Limpa jobs antigos\r\n     */\r\n    async cleanOldJobs() {\r\n        try {\r\n            await this.queue.clean(24 * 60 * 60 * 1000, 0, 'completed');\r\n            await this.queue.clean(24 * 60 * 60 * 1000, 0, 'failed');\r\n            console.log('ðŸ§¹ Jobs antigos limpos');\r\n        } catch (error) {\r\n            console.error('âŒ Erro na limpeza de jobs:', error);\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = new FileConversionQueue();","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rafae\\Desktop\\PROJETOS DE ESTUDOS\\CONVERSOR MPP XML\\queue\\worker.js","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":39,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":39,"endColumn":20,"suggestions":[{"fix":{"range":[1024,1076],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":54,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":54,"endColumn":20,"suggestions":[{"fix":{"range":[1467,1514],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":65,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":65,"endColumn":24,"suggestions":[{"fix":{"range":[1741,1798],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"security/detect-non-literal-fs-filename","severity":1,"message":"Found rename from package \"fs\" with non literal argument at index 0,1","line":84,"column":19,"nodeType":"CallExpression","endLine":84,"endColumn":58},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":85,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":85,"endColumn":24,"suggestions":[{"fix":{"range":[2628,2690],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":90,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":90,"endColumn":24,"suggestions":[{"fix":{"range":[2797,2848],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"security/detect-non-literal-fs-filename","severity":1,"message":"Found unlink from package \"fs\" with non literal argument at index 0","line":96,"column":19,"nodeType":"CallExpression","endLine":96,"endColumn":44},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":97,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":97,"endColumn":24,"suggestions":[{"fix":{"range":[3115,3178],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":110,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":110,"endColumn":24,"suggestions":[{"fix":{"range":[3558,3646],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":114,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":114,"endColumn":26,"suggestions":[{"fix":{"range":[3717,3766],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"security/detect-non-literal-fs-filename","severity":1,"message":"Found rename from package \"fs\" with non literal argument at index 0,1","line":134,"column":23,"nodeType":"CallExpression","endLine":134,"endColumn":64},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":135,"column":17,"nodeType":"MemberExpression","messageId":"unexpected","endLine":135,"endColumn":28,"suggestions":[{"fix":{"range":[4444,4506],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":138,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":138,"endColumn":26,"suggestions":[{"fix":{"range":[4562,4619],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":161,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":161,"endColumn":24,"suggestions":[{"fix":{"range":[5089,5139],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":165,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":165,"endColumn":26,"suggestions":[{"fix":{"range":[5218,5281],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":169,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":169,"endColumn":24,"suggestions":[{"fix":{"range":[5367,5431],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":173,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":173,"endColumn":26,"suggestions":[{"fix":{"range":[5504,5542],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":177,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":177,"endColumn":24,"suggestions":[{"fix":{"range":[5612,5664],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":185,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":185,"endColumn":20,"suggestions":[{"fix":{"range":[5770,5806],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":187,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":187,"endColumn":20,"suggestions":[{"fix":{"range":[5852,5883],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":193,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":193,"endColumn":16,"suggestions":[{"fix":{"range":[5993,6047],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":199,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":199,"endColumn":20,"suggestions":[{"fix":{"range":[6183,6233],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":205,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":205,"endColumn":20,"suggestions":[{"fix":{"range":[6351,6397],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":23,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const { Worker } = require('bullmq');\r\nconst Redis = require('ioredis');\r\nconst path = require('path');\r\nconst fs = require('fs').promises;\r\nrequire('dotenv').config();\r\n\r\nconst converter = require('../converters/mppToXml');\r\nconst uploadUtils = require('../api/upload-utils');\r\n\r\n// ConfiguraÃ§Ã£o do Redis\r\nconst redisConnection = new Redis(process.env.REDIS_URL || 'redis://localhost:6379', {\r\n    maxRetriesPerRequest: 3,\r\n    retryDelayOnFailover: 100,\r\n    enableReadyCheck: false,\r\n    lazyConnect: true\r\n});\r\n\r\nclass FileConversionWorker {\r\n    constructor() {\r\n        this.setupDirectories();\r\n        this.createWorker();\r\n    }\r\n\r\n    /**\r\n     * Configura diretÃ³rios necessÃ¡rios\r\n     */\r\n    async setupDirectories() {\r\n        const dirs = [\r\n            'uploads/incoming',\r\n            'uploads/processing', \r\n            'uploads/converted',\r\n            'uploads/quarantine'\r\n        ];\r\n\r\n        for (const dir of dirs) {\r\n            await uploadUtils.ensureDirectory(dir);\r\n        }\r\n        \r\n        console.log('ðŸ“ DiretÃ³rios de upload configurados');\r\n    }\r\n\r\n    /**\r\n     * Cria o worker\r\n     */\r\n    createWorker() {\r\n        this.worker = new Worker('file-conversion', this.processJob.bind(this), {\r\n            connection: redisConnection,\r\n            concurrency: 2, // Processar atÃ© 2 jobs simultaneamente\r\n            removeOnComplete: 10,\r\n            removeOnFail: 20\r\n        });\r\n\r\n        this.setupEventHandlers();\r\n        console.log('ðŸ”§ Worker de conversÃ£o iniciado');\r\n    }\r\n\r\n    /**\r\n     * Processa job de conversÃ£o\r\n     * @param {object} job - Job do BullMQ\r\n     */\r\n    async processJob(job) {\r\n        const { filename, originalName } = job.data;\r\n        \r\n        try {\r\n            console.log(`ðŸ”„ Processando job ${job.id}: ${filename}`);\r\n            \r\n            // Atualizar progresso\r\n            await job.updateProgress(10);\r\n            \r\n            // Caminhos dos arquivos\r\n            const incomingPath = path.join('uploads/incoming', filename);\r\n            const processingPath = path.join('uploads/processing', filename);\r\n            const convertedPath = path.join('uploads/converted', filename.replace('.mpp', '.xml'));\r\n            \r\n            // Verificar se arquivo existe em incoming\r\n            const fileExists = await this.fileExists(incomingPath);\r\n            if (!fileExists) {\r\n                throw new Error(`Arquivo nÃ£o encontrado em incoming: ${filename}`);\r\n            }\r\n\r\n            await job.updateProgress(20);\r\n\r\n            // Mover para processing\r\n            await fs.rename(incomingPath, processingPath);\r\n            console.log(`ðŸ“‚ Arquivo movido para processing: ${filename}`);\r\n            \r\n            await job.updateProgress(40);\r\n\r\n            // Converter arquivo\r\n            console.log(`ðŸ”„ Iniciando conversÃ£o: ${filename}`);\r\n            const conversionResult = await converter.convertMPPtoXML(processingPath, convertedPath);\r\n            \r\n            await job.updateProgress(80);\r\n\r\n            // Remover arquivo de processing\r\n            await fs.unlink(processingPath);\r\n            console.log(`ðŸ—‘ï¸ Arquivo removido de processing: ${filename}`);\r\n\r\n            await job.updateProgress(100);\r\n\r\n            const result = {\r\n                success: true,\r\n                originalFile: filename,\r\n                convertedFile: path.basename(convertedPath),\r\n                originalName: originalName,\r\n                conversionResult,\r\n                completedAt: new Date().toISOString()\r\n            };\r\n\r\n            console.log(`âœ… Job ${job.id} concluÃ­do: ${filename} â†’ ${path.basename(convertedPath)}`);\r\n            return result;\r\n\r\n        } catch (error) {\r\n            console.error(`âŒ Erro no job ${job.id}:`, error);\r\n            \r\n            // Mover arquivo para quarentena em caso de erro\r\n            await this.quarantineFile(filename);\r\n            \r\n            throw error;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Move arquivo para quarentena\r\n     * @param {string} filename \r\n     */\r\n    async quarantineFile(filename) {\r\n        try {\r\n            const processingPath = path.join('uploads/processing', filename);\r\n            const quarantinePath = path.join('uploads/quarantine', filename);\r\n            \r\n            const exists = await this.fileExists(processingPath);\r\n            if (exists) {\r\n                await fs.rename(processingPath, quarantinePath);\r\n                console.log(`ðŸš¨ Arquivo movido para quarentena: ${filename}`);\r\n            }\r\n        } catch (error) {\r\n            console.error('âŒ Erro ao mover para quarentena:', error);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Verifica se arquivo existe\r\n     * @param {string} filePath \r\n     * @returns {Promise<boolean>}\r\n     */\r\n    async fileExists(filePath) {\r\n        try {\r\n            await fs.access(filePath);\r\n            return true;\r\n        } catch {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Configura handlers de eventos\r\n     */\r\n    setupEventHandlers() {\r\n        this.worker.on('completed', (job) => {\r\n            console.log(`âœ… Worker: Job ${job.id} completado`);\r\n        });\r\n\r\n        this.worker.on('failed', (job, err) => {\r\n            console.error(`âŒ Worker: Job ${job?.id} falhou:`, err.message);\r\n        });\r\n\r\n        this.worker.on('progress', (job, progress) => {\r\n            console.log(`ðŸ“Š Worker: Job ${job.id} progresso: ${progress}%`);\r\n        });\r\n\r\n        this.worker.on('error', (err) => {\r\n            console.error('âŒ Worker error:', err);\r\n        });\r\n\r\n        this.worker.on('ready', () => {\r\n            console.log('ðŸŸ¢ Worker pronto para processar jobs');\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Para o worker graciosamente\r\n     */\r\n    async stop() {\r\n        console.log('â¹ï¸ Parando worker...');\r\n        await this.worker.close();\r\n        console.log('âœ… Worker parado');\r\n    }\r\n}\r\n\r\n// Inicializar worker se arquivo for executado diretamente\r\nif (require.main === module) {\r\n    console.log('ðŸš€ Iniciando File Conversion Worker...');\r\n    \r\n    const worker = new FileConversionWorker();\r\n    \r\n    // Graceful shutdown\r\n    process.on('SIGINT', async () => {\r\n        console.log('\\nðŸ“‹ Sinal de interrupÃ§Ã£o recebido');\r\n        await worker.stop();\r\n        process.exit(0);\r\n    });\r\n\r\n    process.on('SIGTERM', async () => {\r\n        console.log('\\nðŸ“‹ Sinal de tÃ©rmino recebido');\r\n        await worker.stop();\r\n        process.exit(0);\r\n    });\r\n}\r\n\r\nmodule.exports = FileConversionWorker;","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rafae\\Desktop\\PROJETOS DE ESTUDOS\\CONVERSOR MPP XML\\scripts\\final-check.js","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":11,"column":1,"nodeType":"MemberExpression","messageId":"unexpected","endLine":11,"endColumn":12,"suggestions":[{"fix":{"range":[252,310],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":12,"column":1,"nodeType":"MemberExpression","messageId":"unexpected","endLine":12,"endColumn":12,"suggestions":[{"fix":{"range":[312,341],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":29,"column":1,"nodeType":"MemberExpression","messageId":"unexpected","endLine":29,"endColumn":12,"suggestions":[{"fix":{"range":[703,744],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"security/detect-non-literal-fs-filename","severity":1,"message":"Found existsSync from package \"fs\" with non literal argument at index 0","line":34,"column":9,"nodeType":"CallExpression","endLine":34,"endColumn":32},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":35,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":35,"endColumn":20,"suggestions":[{"fix":{"range":[907,932],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":37,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":37,"endColumn":20,"suggestions":[{"fix":{"range":[956,993],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":53,"column":1,"nodeType":"MemberExpression","messageId":"unexpected","endLine":53,"endColumn":12,"suggestions":[{"fix":{"range":[1247,1292],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"security/detect-non-literal-fs-filename","severity":1,"message":"Found existsSync from package \"fs\" with non literal argument at index 0","line":56,"column":9,"nodeType":"CallExpression","endLine":56,"endColumn":32},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":57,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":57,"endColumn":20,"suggestions":[{"fix":{"range":[1427,1452],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":59,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":59,"endColumn":20,"suggestions":[{"fix":{"range":[1476,1535],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":64,"column":1,"nodeType":"MemberExpression","messageId":"unexpected","endLine":64,"endColumn":12,"suggestions":[{"fix":{"range":[1578,1621],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"security/detect-object-injection","severity":2,"message":"Generic Object Injection Sink","line":85,"column":13,"nodeType":"MemberExpression","endLine":85,"endColumn":42},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":86,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":86,"endColumn":24,"suggestions":[{"fix":{"range":[2115,2139],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":88,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":88,"endColumn":24,"suggestions":[{"fix":{"range":[2171,2207],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":92,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":92,"endColumn":15},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":93,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":93,"endColumn":16,"suggestions":[{"fix":{"range":[2258,2300],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":97,"column":1,"nodeType":"MemberExpression","messageId":"unexpected","endLine":97,"endColumn":12,"suggestions":[{"fix":{"range":[2341,2382],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"security/detect-object-injection","severity":2,"message":"Generic Object Injection Sink","line":114,"column":13,"nodeType":"MemberExpression","endLine":114,"endColumn":40},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":115,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":115,"endColumn":24,"suggestions":[{"fix":{"range":[2759,2794],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":117,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":117,"endColumn":24,"suggestions":[{"fix":{"range":[2826,2873],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":120,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":120,"endColumn":15},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":121,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":121,"endColumn":16,"suggestions":[{"fix":{"range":[2918,2961],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":125,"column":1,"nodeType":"MemberExpression","messageId":"unexpected","endLine":125,"endColumn":12,"suggestions":[{"fix":{"range":[2988,3024],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":128,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":128,"endColumn":16,"suggestions":[{"fix":{"range":[3059,3106],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":129,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":129,"endColumn":16,"suggestions":[{"fix":{"range":[3112,3128],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":130,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":130,"endColumn":16,"suggestions":[{"fix":{"range":[3134,3169],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":131,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":131,"endColumn":16,"suggestions":[{"fix":{"range":[3175,3226],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":132,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":132,"endColumn":16,"suggestions":[{"fix":{"range":[3232,3262],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":133,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":133,"endColumn":16,"suggestions":[{"fix":{"range":[3268,3316],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":134,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":134,"endColumn":16,"suggestions":[{"fix":{"range":[3322,3375],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":135,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":135,"endColumn":16,"suggestions":[{"fix":{"range":[3381,3430],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":136,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":136,"endColumn":16,"suggestions":[{"fix":{"range":[3436,3452],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":137,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":137,"endColumn":16,"suggestions":[{"fix":{"range":[3458,3509],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":140,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":140,"endColumn":16,"suggestions":[{"fix":{"range":[3531,3568],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":141,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":141,"endColumn":16,"suggestions":[{"fix":{"range":[3574,3624],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":142,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":142,"endColumn":16,"suggestions":[{"fix":{"range":[3630,3690],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":145,"column":1,"nodeType":"MemberExpression","messageId":"unexpected","endLine":145,"endColumn":12,"suggestions":[{"fix":{"range":[3697,3731],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":146,"column":1,"nodeType":"MemberExpression","messageId":"unexpected","endLine":146,"endColumn":12,"suggestions":[{"fix":{"range":[3733,3779],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":147,"column":1,"nodeType":"MemberExpression","messageId":"unexpected","endLine":147,"endColumn":12,"suggestions":[{"fix":{"range":[3781,3825],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":148,"column":1,"nodeType":"MemberExpression","messageId":"unexpected","endLine":148,"endColumn":12,"suggestions":[{"fix":{"range":[3828,3861],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":149,"column":1,"nodeType":"MemberExpression","messageId":"unexpected","endLine":149,"endColumn":12,"suggestions":[{"fix":{"range":[3863,3901],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":37,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Script de VerificaÃ§Ã£o Final do Sistema\r\n * \r\n * Este script verifica se todos os componentes da arquitetura enterprise\r\n * estÃ£o corretamente implementados e prontos para uso.\r\n */\r\n\r\nconst fs = require('fs');\r\nconst path = require('path');\r\n\r\nconsole.log('ðŸ” VERIFICAÃ‡ÃƒO FINAL DO SISTEMA ENTERPRISE');\r\nconsole.log('=' .repeat(50));\r\n\r\n// Verificar arquivos principais\r\nconst criticalFiles = [\r\n    'api/server.js',\r\n    'api/security.js', \r\n    'api/upload-utils.js',\r\n    'queue/queue.js',\r\n    'queue/worker.js',\r\n    'utils/downloadToken.js',\r\n    'converters/mppToXml.js',\r\n    'public/index.html',\r\n    'public/js/app_clean_new.js',\r\n    'ecosystem.config.js',\r\n    'package.json'\r\n];\r\n\r\nconsole.log('\\nðŸ“ ARQUIVOS PRINCIPAIS:');\r\nlet missingFiles = 0;\r\n\r\ncriticalFiles.forEach(file => {\r\n    const fullPath = path.resolve(__dirname, '..', file);\r\n    if (fs.existsSync(fullPath)) {\r\n        console.log(`âœ… ${file}`);\r\n    } else {\r\n        console.log(`âŒ ${file} - FALTANDO!`);\r\n        missingFiles++;\r\n    }\r\n});\r\n\r\n// Verificar diretÃ³rios\r\nconst requiredDirs = [\r\n    'uploads/incoming',\r\n    'uploads/processing', \r\n    'uploads/converted',\r\n    'uploads/quarantine',\r\n    'uploads/expired',\r\n    'logs',\r\n    'scripts'\r\n];\r\n\r\nconsole.log('\\nðŸ“‚ ESTRUTURA DE DIRETÃ“RIOS:');\r\nrequiredDirs.forEach(dir => {\r\n    const fullPath = path.resolve(__dirname, '..', dir);\r\n    if (fs.existsSync(fullPath)) {\r\n        console.log(`âœ… ${dir}/`);\r\n    } else {\r\n        console.log(`âš ï¸  ${dir}/ - Criar com: npm run setup-dirs`);\r\n    }\r\n});\r\n\r\n// Verificar package.json\r\nconsole.log('\\nðŸ“¦ DEPENDÃŠNCIAS CRÃTICAS:');\r\ntry {\r\n    const packageJson = JSON.parse(fs.readFileSync(\r\n        path.resolve(__dirname, '..', 'package.json'), \r\n        'utf8'\r\n    ));\r\n    \r\n    const criticalDeps = [\r\n        'express',\r\n        'multer',\r\n        'helmet', \r\n        'express-rate-limit',\r\n        'cors',\r\n        'uuid',\r\n        'validator',\r\n        'jsonwebtoken',\r\n        'bullmq',\r\n        'ioredis'\r\n    ];\r\n    \r\n    criticalDeps.forEach(dep => {\r\n        if (packageJson.dependencies[dep]) {\r\n            console.log(`âœ… ${dep}`);\r\n        } else {\r\n            console.log(`âŒ ${dep} - FALTANDO!`);\r\n        }\r\n    });\r\n    \r\n} catch (error) {\r\n    console.log('âŒ Erro ao ler package.json');\r\n}\r\n\r\n// Verificar scripts importantes\r\nconsole.log('\\nðŸ”§ SCRIPTS DISPONÃVEIS:');\r\nconst importantScripts = [\r\n    'start',\r\n    'dev', \r\n    'worker',\r\n    'pm2:start',\r\n    'syntax-check',\r\n    'doctor'\r\n];\r\n\r\ntry {\r\n    const packageJson = JSON.parse(fs.readFileSync(\r\n        path.resolve(__dirname, '..', 'package.json'), \r\n        'utf8'\r\n    ));\r\n    \r\n    importantScripts.forEach(script => {\r\n        if (packageJson.scripts[script]) {\r\n            console.log(`âœ… npm run ${script}`);\r\n        } else {\r\n            console.log(`âŒ npm run ${script} - FALTANDO!`);\r\n        }\r\n    });\r\n} catch (error) {\r\n    console.log('âŒ Erro ao verificar scripts');\r\n}\r\n\r\n// Resultado final\r\nconsole.log('\\n' + '=' .repeat(50));\r\n\r\nif (missingFiles === 0) {\r\n    console.log('ðŸŽ‰ SISTEMA ENTERPRISE COMPLETO!');\r\n    console.log('');\r\n    console.log('ðŸ“‹ PRÃ“XIMOS PASSOS:');\r\n    console.log('1. Instalar Node.js (se necessÃ¡rio)');\r\n    console.log('2. npm install');\r\n    console.log('3. npm run dev (desenvolvimento)');\r\n    console.log('4. npm run worker (em outro terminal)');\r\n    console.log('5. Acessar: http://localhost:3000');\r\n    console.log('');\r\n    console.log('ðŸš€ Para produÃ§Ã£o: npm run pm2:start');\r\n    \r\n} else {\r\n    console.log('âŒ SISTEMA INCOMPLETO!');\r\n    console.log(`Arquivos faltando: ${missingFiles}`);\r\n    console.log('Verifique os arquivos marcados como FALTANDO');\r\n}\r\n\r\nconsole.log('\\nðŸ“š DOCUMENTAÃ‡ÃƒO:');\r\nconsole.log('- README: ENTERPRISE_README.md');\r\nconsole.log('- Node.js: INSTALL_NODEJS.md'); \r\nconsole.log('- Setup: setup.sh');\r\nconsole.log('- Config: .env.example');\r\n\r\nprocess.exit(missingFiles === 0 ? 0 : 1);","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rafae\\Desktop\\PROJETOS DE ESTUDOS\\CONVERSOR MPP XML\\scripts\\syntax-check.js","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":23,"column":1,"nodeType":"MemberExpression","messageId":"unexpected","endLine":23,"endColumn":12,"suggestions":[{"fix":{"range":[549,605],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"security/detect-non-literal-fs-filename","severity":1,"message":"Found readFileSync from package \"fs\" with non literal argument at index 0","line":30,"column":25,"nodeType":"CallExpression","endLine":30,"endColumn":58},{"ruleId":"no-new-func","severity":2,"message":"The Function constructor is eval.","line":33,"column":9,"nodeType":"NewExpression","messageId":"noFunctionConstructor","endLine":33,"endColumn":30},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":35,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":35,"endColumn":20,"suggestions":[{"fix":{"range":[915,976],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":37,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":37,"endColumn":20,"suggestions":[{"fix":{"range":[1009,1072],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":38,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":38,"endColumn":20,"suggestions":[{"fix":{"range":[1082,1119],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":43,"column":1,"nodeType":"MemberExpression","messageId":"unexpected","endLine":43,"endColumn":12,"suggestions":[{"fix":{"range":[1162,1197],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":45,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":45,"endColumn":16,"suggestions":[{"fix":{"range":[1221,1297],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":48,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":48,"endColumn":16,"suggestions":[{"fix":{"range":[1335,1394],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Script de VerificaÃ§Ã£o de Sintaxe JavaScript\r\n * \r\n * Este script verifica se todos os arquivos JavaScript do projeto\r\n * possuem sintaxe vÃ¡lida antes do deployment.\r\n */\r\n\r\nconst fs = require('fs');\r\nconst path = require('path');\r\n\r\n// Lista de arquivos para verificar\r\nconst filesToCheck = [\r\n    '../api/server.js',\r\n    '../api/security.js',\r\n    '../api/upload-utils.js',\r\n    '../queue/queue.js',\r\n    '../queue/worker.js',\r\n    '../utils/downloadToken.js',\r\n    '../converters/mppToXml.js',\r\n    '../public/js/app_clean_new.js'\r\n];\r\n\r\nconsole.log('ðŸ” Iniciando verificaÃ§Ã£o de sintaxe...\\n');\r\n\r\nlet hasErrors = false;\r\n\r\nfilesToCheck.forEach(filePath => {\r\n    try {\r\n        const fullPath = path.resolve(__dirname, filePath);\r\n        const content = fs.readFileSync(fullPath, 'utf8');\r\n        \r\n        // Tentar fazer parse do cÃ³digo JavaScript\r\n        new Function(content);\r\n        \r\n        console.log(`âœ… ${path.basename(filePath)} - Sintaxe vÃ¡lida`);\r\n    } catch (error) {\r\n        console.log(`âŒ ${path.basename(filePath)} - Erro de sintaxe:`);\r\n        console.log(`   ${error.message}\\n`);\r\n        hasErrors = true;\r\n    }\r\n});\r\n\r\nconsole.log('\\n' + '='.repeat(50));\r\nif (hasErrors) {\r\n    console.log('âŒ Encontrados erros de sintaxe. Corrija antes de prosseguir.');\r\n    process.exit(1);\r\n} else {\r\n    console.log('âœ… Todos os arquivos possuem sintaxe vÃ¡lida!');\r\n    process.exit(0);\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rafae\\Desktop\\PROJETOS DE ESTUDOS\\CONVERSOR MPP XML\\utils\\downloadToken.js","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":49,"column":17,"nodeType":"MemberExpression","messageId":"unexpected","endLine":49,"endColumn":28,"suggestions":[{"fix":{"range":[1485,1534],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":56,"column":17,"nodeType":"MemberExpression","messageId":"unexpected","endLine":56,"endColumn":28,"suggestions":[{"fix":{"range":[1710,1743],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":58,"column":17,"nodeType":"MemberExpression","messageId":"unexpected","endLine":58,"endColumn":28,"suggestions":[{"fix":{"range":[1823,1858],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":60,"column":17,"nodeType":"MemberExpression","messageId":"unexpected","endLine":60,"endColumn":30,"suggestions":[{"fix":{"range":[1898,1952],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const crypto = require('crypto');\r\nconst jwt = require('jsonwebtoken');\r\n\r\nclass DownloadTokenManager {\r\n    constructor() {\r\n        this.secretKey = process.env.SECRET_KEY || 'fallback-secret-key-change-me';\r\n        this.expiryMinutes = parseInt(process.env.DOWNLOAD_TOKEN_EXPIRY) || 15;\r\n    }\r\n\r\n    /**\r\n     * Gera token temporÃ¡rio seguro para download\r\n     * @param {string} filename - Nome do arquivo\r\n     * @param {object} metadata - Metadados opcionais\r\n     * @returns {string} Token JWT assinado\r\n     */\r\n    gerarToken(filename, metadata = {}) {\r\n        const payload = {\r\n            filename,\r\n            metadata,\r\n            type: 'download',\r\n            timestamp: Date.now()\r\n        };\r\n\r\n        const options = {\r\n            expiresIn: `${this.expiryMinutes}m`,\r\n            issuer: 'mpp-converter',\r\n            subject: 'file-download'\r\n        };\r\n\r\n        return jwt.sign(payload, this.secretKey, options);\r\n    }\r\n\r\n    /**\r\n     * Valida token de download\r\n     * @param {string} token - Token JWT\r\n     * @returns {object} Payload decodificado ou null se invÃ¡lido\r\n     */\r\n    validarToken(token) {\r\n        try {\r\n            const options = {\r\n                issuer: 'mpp-converter',\r\n                subject: 'file-download'\r\n            };\r\n\r\n            const payload = jwt.verify(token, this.secretKey, options);\r\n            \r\n            // VerificaÃ§Ã£o adicional de tipo\r\n            if (payload.type !== 'download') {\r\n                console.log('âš ï¸ Token invÃ¡lido: tipo incorreto');\r\n                return null;\r\n            }\r\n\r\n            return payload;\r\n        } catch (error) {\r\n            if (error.name === 'TokenExpiredError') {\r\n                console.log('âš ï¸ Token expirado');\r\n            } else if (error.name === 'JsonWebTokenError') {\r\n                console.log('âš ï¸ Token malformado');\r\n            } else {\r\n                console.error('âŒ Erro na validaÃ§Ã£o do token:', error);\r\n            }\r\n            return null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gera hash seguro para validaÃ§Ã£o adicional\r\n     * @param {string} filename \r\n     * @returns {string} Hash SHA256\r\n     */\r\n    generateFileHash(filename) {\r\n        return crypto\r\n            .createHash('sha256')\r\n            .update(filename + this.secretKey)\r\n            .digest('hex')\r\n            .substring(0, 16);\r\n    }\r\n\r\n    /**\r\n     * Valida hash de arquivo\r\n     * @param {string} filename \r\n     * @param {string} hash \r\n     * @returns {boolean}\r\n     */\r\n    validateFileHash(filename, hash) {\r\n        const expectedHash = this.generateFileHash(filename);\r\n        return hash === expectedHash;\r\n    }\r\n}\r\n\r\nmodule.exports = new DownloadTokenManager();","usedDeprecatedRules":[]}]